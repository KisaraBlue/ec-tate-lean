<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href="../../.././style.css"></link><link rel="stylesheet" href="../../.././src/pygments.css"></link><link rel="shortcut icon" href="../../.././favicon.ico"></link><link rel="prefetch" href="../../.././/declarations/declaration-data.bmp" as="image"></link><title>Lean.Compiler.LCNF.Level</title><script defer="true" src="../../.././mathjax-config.js"></script><script defer="true" src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT="../../.././";</script><script>const MODULE_NAME="Lean.Compiler.LCNF.Level";</script><script type="module" src="../../.././nav.js"></script><script type="module" src="../../.././search.js"></script><script type="module" src="../../.././how-about.js"></script><script type="module" src="../../.././instances.js"></script><script type="module" src="../../.././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label>Documentation</h1><p class="header_filename break_within">Lean.Compiler.LCNF.Level</p><form action="https://google.com/search" method="get" id="search_form"><input type="hidden" name="sitesearch" value="https://leanprover-community.github.io/mathlib_docs"></input><input type="text" name="q" autocomplete="off"></input><button>Google site search</button></form></header><nav class="internal_nav"><h3><a class="break_within" href="#top">Lean.Compiler.LCNF.Level</a></h3><p class="gh_nav_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/Level.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href="../../.././Init.html">Init</a></li><li><a href="../../.././Lean/Util/CollectLevelParams.html">Lean.Util.CollectLevelParams</a></li><li><a href="../../.././Lean/Compiler/LCNF/Basic.html">Lean.Compiler.LCNF.Basic</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Lean.Compiler.LCNF.Level" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.NormLevelParam.State">Lean.Compiler.LCNF.NormLevelParam.State</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.NormLevelParam.M">Lean.Compiler.LCNF.NormLevelParam.M</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.NormLevelParam.normLevel">Lean.Compiler.LCNF.NormLevelParam.normLevel</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.NormLevelParam.normExpr">Lean.Compiler.LCNF.NormLevelParam.normExpr</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.normLevelParams">Lean.Compiler.LCNF.normLevelParams</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.CollectLevelParams.visitParam">Lean.Compiler.LCNF.CollectLevelParams.visitParam</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.CollectLevelParams.visitParams">Lean.Compiler.LCNF.CollectLevelParams.visitParams</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.CollectLevelParams.visitAlt">Lean.Compiler.LCNF.CollectLevelParams.visitAlt</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.CollectLevelParams.visitAlts">Lean.Compiler.LCNF.CollectLevelParams.visitAlts</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.CollectLevelParams.visitCode">Lean.Compiler.LCNF.CollectLevelParams.visitCode</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.Decl.setLevelParams">Lean.Compiler.LCNF.Decl.setLevelParams</a></div></nav><main>
<div class="mod_doc"><h1 class="markdown-heading" id="Universe-level-utilities-for-the-code-generator">Universe level utilities for the code generator <a class="hover-link" href="#Universe-level-utilities-for-the-code-generator">#</a></h1></div><div class="mod_doc"><h2 class="markdown-heading" id="Universe-level-parameter-normalizer">Universe level parameter normalizer <a class="hover-link" href="#Universe-level-parameter-normalizer">#</a></h2><p>The specializer creates "keys" for a function specialization. The key is an expression
containing the function being specialized and the argument values used for the specialization.
The key does not contain free variables, and function parameter names are irrelevant due to alpha
equivalence. The universe level normalizer ensures the universe parameter names are irrelevant
when comparing keys.</p></div><div class="decl" id="Lean.Compiler.LCNF.NormLevelParam.State"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/Level.lean#L28-L34">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/Level.html#Lean.Compiler.LCNF.NormLevelParam.State">Lean.Compiler.LCNF.NormLevelParam.State</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.Compiler.LCNF.NormLevelParam.State.mk"><li id="Lean.Compiler.LCNF.NormLevelParam.State.nextIdx" class="structure_field"><div class="structure_field_doc"><p>Counter for generating new (normalized) universe parameter names.</p></div><div class="structure_field_info">nextIdx : <a href="../../.././Init/Prelude.html#Nat">Nat</a></div></li><li id="Lean.Compiler.LCNF.NormLevelParam.State.map" class="structure_field"><div class="structure_field_doc"><p>Mapping from existing universe parameter names to the new ones.</p></div><div class="structure_field_info">map : <span class="fn"><a href="../../.././Lean/Data/HashMap.html#Lean.HashMap">Lean.HashMap</a> <a href="../../.././Init/Prelude.html#Lean.Name">Lean.Name</a> <a href="../../.././Lean/Level.html#Lean.Level">Lean.Level</a></span></div></li><li id="Lean.Compiler.LCNF.NormLevelParam.State.paramNames" class="structure_field"><div class="structure_field_doc"><p>Parameters that have been normalized.</p></div><div class="structure_field_info">paramNames : <span class="fn"><a href="../../.././Init/Prelude.html#Array">Array</a> <a href="../../.././Init/Prelude.html#Lean.Name">Lean.Name</a></span></div></li></ul><p>State for the universe level normalizer monad.</p><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.Compiler.LCNF.NormLevelParam.State" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.NormLevelParam.M"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/Level.lean#L37-L37">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/Level.html#Lean.Compiler.LCNF.NormLevelParam.M">Lean.Compiler.LCNF.NormLevelParam.M</a></span><span class="decl_args">
<span class="fn">(α : <span class="fn">Type</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><p>Monad for the universe leve normalizer</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/Level.html#Lean.Compiler.LCNF.NormLevelParam.M">Lean.Compiler.LCNF.NormLevelParam.M</a> <a href="../../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../../.././Init/Control/State.html#StateM">StateM</a> <a href="../../.././Lean/Compiler/LCNF/Level.html#Lean.Compiler.LCNF.NormLevelParam.State">Lean.Compiler.LCNF.NormLevelParam.State</a></span></span></li></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.NormLevelParam.normLevel"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/Level.lean#L42-L57">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/Level.html#Lean.Compiler.LCNF.NormLevelParam.normLevel">Lean.Compiler.LCNF.NormLevelParam.normLevel</a></span><span class="decl_args">
<span class="fn">(u : <a href="../../.././Lean/Level.html#Lean.Level">Lean.Level</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/Level.html#Lean.Compiler.LCNF.NormLevelParam.M">Lean.Compiler.LCNF.NormLevelParam.M</a> <a href="../../.././Lean/Level.html#Lean.Level">Lean.Level</a></span></div></div><p>Normalize universe level parameter names in the given universe level.</p></div></div><div class="decl" id="Lean.Compiler.LCNF.NormLevelParam.normExpr"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/Level.lean#L62-L75">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/Level.html#Lean.Compiler.LCNF.NormLevelParam.normExpr">Lean.Compiler.LCNF.NormLevelParam.normExpr</a></span><span class="decl_args">
<span class="fn">(e : <a href="../../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/Level.html#Lean.Compiler.LCNF.NormLevelParam.M">Lean.Compiler.LCNF.NormLevelParam.M</a> <a href="../../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></div></div><p>Normalize universe level parameter names in the given expression.</p></div></div><div class="decl" id="Lean.Compiler.LCNF.normLevelParams"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/Level.lean#L83-L85">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/Level.html#Lean.Compiler.LCNF.normLevelParams">Lean.Compiler.LCNF.normLevelParams</a></span><span class="decl_args">
<span class="fn">(e : <a href="../../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a> <a href="../../.././Init/Prelude.html#Prod">×</a> <span class="fn"><a href="../../.././Init/Prelude.html#List">List</a> <a href="../../.././Init/Prelude.html#Lean.Name">Lean.Name</a></span></span></div></div><p>Normalize universe level parameter names in the given expression.
The function also returns the list of universe level parameter names that have been normalized.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="mod_doc"><h2 class="markdown-heading" id="Universe-level-collector">Universe level collector <a class="hover-link" href="#Universe-level-collector">#</a></h2><p>This module extends support for <code>Code</code>. See <code>Lean.Util.CollectLevelParams.lean</code></p><p>In the code specializer, we create new auxiliary declarations and the
universe level parameter collector is used to setup the new auxiliary declarations.</p><p>See <code><a href="../../.././Lean/Compiler/LCNF/Level.html#Lean.Compiler.LCNF.Decl.setLevelParams">Decl.setLevelParams</a></code>.</p></div><div class="decl" id="Lean.Compiler.LCNF.CollectLevelParams.visitParam"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/Level.lean#L100-L101">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/Level.html#Lean.Compiler.LCNF.CollectLevelParams.visitParam">Lean.Compiler.LCNF.CollectLevelParams.visitParam</a></span><span class="decl_args">
<span class="fn">(p : <a href="../../.././Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Param">Lean.Compiler.LCNF.Param</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../../.././Lean/Util/CollectLevelParams.html#Lean.CollectLevelParams.Visitor">Lean.CollectLevelParams.Visitor</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/Level.html#Lean.Compiler.LCNF.CollectLevelParams.visitParam">Lean.Compiler.LCNF.CollectLevelParams.visitParam</a> <span class="fn">p</span></span> <a href="../../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../../.././Lean/Util/CollectLevelParams.html#Lean.CollectLevelParams.visitExpr">Lean.CollectLevelParams.visitExpr</a> <span class="fn"><span class="fn">p</span>.type</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.CollectLevelParams.visitParams"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/Level.lean#L103-L104">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/Level.html#Lean.Compiler.LCNF.CollectLevelParams.visitParams">Lean.Compiler.LCNF.CollectLevelParams.visitParams</a></span><span class="decl_args">
<span class="fn">(ps : <span class="fn"><a href="../../.././Init/Prelude.html#Array">Array</a> <a href="../../.././Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Param">Lean.Compiler.LCNF.Param</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../../.././Lean/Util/CollectLevelParams.html#Lean.CollectLevelParams.Visitor">Lean.CollectLevelParams.Visitor</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/Level.html#Lean.Compiler.LCNF.CollectLevelParams.visitParams">Lean.Compiler.LCNF.CollectLevelParams.visitParams</a> <span class="fn">ps</span> <span class="fn">s</span></span> <a href="../../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../../.././Init/Data/Array/Basic.html#Array.foldl">Array.foldl</a> (<span class="fn">fun <span class="fn">s</span> <span class="fn">p</span> =&gt <span class="fn"><a href="../../.././Lean/Compiler/LCNF/Level.html#Lean.Compiler.LCNF.CollectLevelParams.visitParam">Lean.Compiler.LCNF.CollectLevelParams.visitParam</a> <span class="fn">p</span> <span class="fn">s</span></span></span>) <span class="fn">s</span> <span class="fn">ps</span> <span class="fn">0</span> (<span class="fn"><a href="../../.././Init/Prelude.html#Array.size">Array.size</a> <span class="fn">ps</span></span>)</span></span></li></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.CollectLevelParams.visitAlt"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/Level.lean#L107-L110">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/Level.html#Lean.Compiler.LCNF.CollectLevelParams.visitAlt">Lean.Compiler.LCNF.CollectLevelParams.visitAlt</a></span><span class="decl_args">
<span class="fn">(alt : <a href="../../.././Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Alt">Lean.Compiler.LCNF.Alt</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../../.././Lean/Util/CollectLevelParams.html#Lean.CollectLevelParams.Visitor">Lean.CollectLevelParams.Visitor</a></div></div></div></div><div class="decl" id="Lean.Compiler.LCNF.CollectLevelParams.visitAlts"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/Level.lean#L112-L113">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/Level.html#Lean.Compiler.LCNF.CollectLevelParams.visitAlts">Lean.Compiler.LCNF.CollectLevelParams.visitAlts</a></span><span class="decl_args">
<span class="fn">(alts : <span class="fn"><a href="../../.././Init/Prelude.html#Array">Array</a> <a href="../../.././Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Alt">Lean.Compiler.LCNF.Alt</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../../.././Lean/Util/CollectLevelParams.html#Lean.CollectLevelParams.Visitor">Lean.CollectLevelParams.Visitor</a></div></div></div></div><div class="decl" id="Lean.Compiler.LCNF.CollectLevelParams.visitCode"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/Level.lean#L115-L121">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/Level.html#Lean.Compiler.LCNF.CollectLevelParams.visitCode">Lean.Compiler.LCNF.CollectLevelParams.visitCode</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Code">Lean.Compiler.LCNF.Code</a> → <a href="../../.././Lean/Util/CollectLevelParams.html#Lean.CollectLevelParams.Visitor">Lean.CollectLevelParams.Visitor</a></span></div></div></div></div><div class="decl" id="Lean.Compiler.LCNF.Decl.setLevelParams"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/Level.lean#L133-L135">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/Level.html#Lean.Compiler.LCNF.Decl.setLevelParams">Lean.Compiler.LCNF.Decl.setLevelParams</a></span><span class="decl_args">
<span class="fn">(decl : <a href="../../.././Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Decl">Lean.Compiler.LCNF.Decl</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../../.././Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Decl">Lean.Compiler.LCNF.Decl</a></div></div><p>Collect universe level parameters collecting in the type, parameters, and value, and then
set <code>decl.levelParams</code> with the resulting value.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div></main>
<nav class="nav"><iframe src="../../.././/navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>