<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href="../../.././style.css"></link><link rel="stylesheet" href="../../.././src/pygments.css"></link><link rel="shortcut icon" href="../../.././favicon.ico"></link><link rel="prefetch" href="../../.././/declarations/declaration-data.bmp" as="image"></link><title>Lean.Compiler.LCNF.FloatLetIn</title><script defer="true" src="../../.././mathjax-config.js"></script><script defer="true" src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT="../../.././";</script><script>const MODULE_NAME="Lean.Compiler.LCNF.FloatLetIn";</script><script type="module" src="../../.././nav.js"></script><script type="module" src="../../.././search.js"></script><script type="module" src="../../.././how-about.js"></script><script type="module" src="../../.././instances.js"></script><script type="module" src="../../.././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label>Documentation</h1><p class="header_filename break_within">Lean.Compiler.LCNF.FloatLetIn</p><form action="https://google.com/search" method="get" id="search_form"><input type="hidden" name="sitesearch" value="https://leanprover-community.github.io/mathlib_docs"></input><input type="text" name="q" autocomplete="off"></input><button>Google site search</button></form></header><nav class="internal_nav"><h3><a class="break_within" href="#top">Lean.Compiler.LCNF.FloatLetIn</a></h3><p class="gh_nav_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href="../../.././Init.html">Init</a></li><li><a href="../../.././Lean/Compiler/LCNF/CompilerM.html">Lean.Compiler.LCNF.CompilerM</a></li><li><a href="../../.././Lean/Compiler/LCNF/FVarUtil.html">Lean.Compiler.LCNF.FVarUtil</a></li><li><a href="../../.././Lean/Compiler/LCNF/PassManager.html">Lean.Compiler.LCNF.PassManager</a></li><li><a href="../../.././Lean/Compiler/LCNF/Types.html">Lean.Compiler.LCNF.Types</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Lean.Compiler.LCNF.FloatLetIn" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.FloatLetIn.Decision">Lean.Compiler.LCNF.FloatLetIn.Decision</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.FloatLetIn.instHashableDecision">Lean.Compiler.LCNF.FloatLetIn.instHashableDecision</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.FloatLetIn.instBEqDecision">Lean.Compiler.LCNF.FloatLetIn.instBEqDecision</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.FloatLetIn.instInhabitedDecision">Lean.Compiler.LCNF.FloatLetIn.instInhabitedDecision</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.FloatLetIn.instReprDecision">Lean.Compiler.LCNF.FloatLetIn.instReprDecision</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.FloatLetIn.Decision.ofAlt">Lean.Compiler.LCNF.FloatLetIn.Decision.ofAlt</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.FloatLetIn.BaseFloatContext">Lean.Compiler.LCNF.FloatLetIn.BaseFloatContext</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.FloatLetIn.FloatState">Lean.Compiler.LCNF.FloatLetIn.FloatState</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.FloatLetIn.BaseFloatM">Lean.Compiler.LCNF.FloatLetIn.BaseFloatM</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.FloatLetIn.FloatM">Lean.Compiler.LCNF.FloatLetIn.FloatM</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.FloatLetIn.withNewCandidate">Lean.Compiler.LCNF.FloatLetIn.withNewCandidate</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.FloatLetIn.withNewScope">Lean.Compiler.LCNF.FloatLetIn.withNewScope</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.FloatLetIn.ignore?">Lean.Compiler.LCNF.FloatLetIn.ignore?</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.FloatLetIn.initialDecisions">Lean.Compiler.LCNF.FloatLetIn.initialDecisions</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.FloatLetIn.initialDecisions.goFVar">Lean.Compiler.LCNF.FloatLetIn.initialDecisions.goFVar</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.FloatLetIn.initialDecisions.goAlt">Lean.Compiler.LCNF.FloatLetIn.initialDecisions.goAlt</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.FloatLetIn.initialDecisions.goCases">Lean.Compiler.LCNF.FloatLetIn.initialDecisions.goCases</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.FloatLetIn.initialNewArms">Lean.Compiler.LCNF.FloatLetIn.initialNewArms</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.FloatLetIn.dontFloat">Lean.Compiler.LCNF.FloatLetIn.dontFloat</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.FloatLetIn.dontFloat.goFVar">Lean.Compiler.LCNF.FloatLetIn.dontFloat.goFVar</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.FloatLetIn.float">Lean.Compiler.LCNF.FloatLetIn.float</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.FloatLetIn.float.goFVar">Lean.Compiler.LCNF.FloatLetIn.float.goFVar</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.FloatLetIn.floatLetIn">Lean.Compiler.LCNF.FloatLetIn.floatLetIn</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.FloatLetIn.floatLetIn.goCases">Lean.Compiler.LCNF.FloatLetIn.floatLetIn.goCases</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.FloatLetIn.floatLetIn.go">Lean.Compiler.LCNF.FloatLetIn.floatLetIn.go</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.Decl.floatLetIn">Lean.Compiler.LCNF.Decl.floatLetIn</a></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.floatLetIn">Lean.Compiler.LCNF.floatLetIn</a></div></nav><main>
<div class="decl" id="Lean.Compiler.LCNF.FloatLetIn.Decision"><div class="inductive"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean#L18-L38">source</a></div><div class="decl_header"><span class="decl_kind">inductive</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.Decision">Lean.Compiler.LCNF.FloatLetIn.Decision</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="constructors"><li class="constructor" id="Lean.Compiler.LCNF.FloatLetIn.Decision.arm"><div class="inductive_ctor_doc"><p>Push into the arm with name <code>name</code>.</p></div>arm: <span class="fn"><a href="../../.././Init/Prelude.html#Lean.Name">Lean.Name</a> → <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.Decision">Lean.Compiler.LCNF.FloatLetIn.Decision</a></span></li><li class="constructor" id="Lean.Compiler.LCNF.FloatLetIn.Decision.default"><div class="inductive_ctor_doc"><p>Push into the default arm.</p></div>default: <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.Decision">Lean.Compiler.LCNF.FloatLetIn.Decision</a></li><li class="constructor" id="Lean.Compiler.LCNF.FloatLetIn.Decision.dont"><div class="inductive_ctor_doc"><p>Dont move this declaration it is needed where it is right now.</p></div>dont: <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.Decision">Lean.Compiler.LCNF.FloatLetIn.Decision</a></li><li class="constructor" id="Lean.Compiler.LCNF.FloatLetIn.Decision.unknown"><div class="inductive_ctor_doc"><p>No decision has been made yet.</p></div>unknown: <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.Decision">Lean.Compiler.LCNF.FloatLetIn.Decision</a></li></ul><p>The decision of the float mechanism.</p><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.Compiler.LCNF.FloatLetIn.Decision" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.FloatLetIn.instHashableDecision"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean#L38-L38">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.instHashableDecision">Lean.Compiler.LCNF.FloatLetIn.instHashableDecision</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Prelude.html#Hashable">Hashable</a> <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.Decision">Lean.Compiler.LCNF.FloatLetIn.Decision</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.instHashableDecision">Lean.Compiler.LCNF.FloatLetIn.instHashableDecision</a> <a href="../../.././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">hash</span> := <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#_private.Lean.Compiler.LCNF.FloatLetIn.0.Lean.Compiler.LCNF.FloatLetIn.hashDecision._@.Lean.Compiler.LCNF.FloatLetIn._hyg.14">Lean.Compiler.LCNF.FloatLetIn.hashDecision✝</a> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.FloatLetIn.instBEqDecision"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean#L38-L38">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.instBEqDecision">Lean.Compiler.LCNF.FloatLetIn.instBEqDecision</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Prelude.html#BEq">BEq</a> <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.Decision">Lean.Compiler.LCNF.FloatLetIn.Decision</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.instBEqDecision">Lean.Compiler.LCNF.FloatLetIn.instBEqDecision</a> <a href="../../.././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">beq</span> := <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#_private.Lean.Compiler.LCNF.FloatLetIn.0.Lean.Compiler.LCNF.FloatLetIn.beqDecision._@.Lean.Compiler.LCNF.FloatLetIn._hyg.71">Lean.Compiler.LCNF.FloatLetIn.beqDecision✝</a> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.FloatLetIn.instInhabitedDecision"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean#L38-L38">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.instInhabitedDecision">Lean.Compiler.LCNF.FloatLetIn.instInhabitedDecision</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Prelude.html#Inhabited">Inhabited</a> <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.Decision">Lean.Compiler.LCNF.FloatLetIn.Decision</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.instInhabitedDecision">Lean.Compiler.LCNF.FloatLetIn.instInhabitedDecision</a> <a href="../../.././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">default</span> := <span class="fn"><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.Decision.arm">Lean.Compiler.LCNF.FloatLetIn.Decision.arm</a> <span class="fn">default</span></span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.FloatLetIn.instReprDecision"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean#L38-L38">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.instReprDecision">Lean.Compiler.LCNF.FloatLetIn.instReprDecision</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Data/Repr.html#Repr">Repr</a> <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.Decision">Lean.Compiler.LCNF.FloatLetIn.Decision</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.instReprDecision">Lean.Compiler.LCNF.FloatLetIn.instReprDecision</a> <a href="../../.././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">reprPrec</span> := <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#_private.Lean.Compiler.LCNF.FloatLetIn.0.Lean.Compiler.LCNF.FloatLetIn.reprDecision._@.Lean.Compiler.LCNF.FloatLetIn._hyg.187">Lean.Compiler.LCNF.FloatLetIn.reprDecision✝</a> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.FloatLetIn.Decision.ofAlt"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean#L40-L42">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.Decision.ofAlt">Lean.Compiler.LCNF.FloatLetIn.Decision.ofAlt</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Alt">Lean.Compiler.LCNF.Alt</a> → <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.Decision">Lean.Compiler.LCNF.FloatLetIn.Decision</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.FloatLetIn.BaseFloatContext"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean#L47-L52">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.BaseFloatContext">Lean.Compiler.LCNF.FloatLetIn.BaseFloatContext</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.Compiler.LCNF.FloatLetIn.BaseFloatContext.mk"><li id="Lean.Compiler.LCNF.FloatLetIn.BaseFloatContext.decls" class="structure_field"><div class="structure_field_doc"><p>All the declarations that were collected in the current LCNF basic
block up to the current statement (in reverse order for efficiency).</p></div><div class="structure_field_info">decls : <span class="fn"><a href="../../.././Init/Prelude.html#List">List</a> <a href="../../.././Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.CodeDecl">Lean.Compiler.LCNF.CodeDecl</a></span></div></li></ul><p>The context for <code><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.BaseFloatM">BaseFloatM</a></code>.</p><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.Compiler.LCNF.FloatLetIn.BaseFloatContext" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.FloatLetIn.FloatState"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean#L57-L69">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.FloatState">Lean.Compiler.LCNF.FloatLetIn.FloatState</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.Compiler.LCNF.FloatLetIn.FloatState.mk"><li id="Lean.Compiler.LCNF.FloatLetIn.FloatState.decision" class="structure_field"><div class="structure_field_doc"><p>A map from identifiers of declarations to their current decision.</p></div><div class="structure_field_info">decision : <span class="fn"><a href="../../.././Lean/Data/HashMap.html#Lean.HashMap">Lean.HashMap</a> <a href="../../.././Lean/Expr.html#Lean.FVarId">Lean.FVarId</a> <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.Decision">Lean.Compiler.LCNF.FloatLetIn.Decision</a></span></div></li><li id="Lean.Compiler.LCNF.FloatLetIn.FloatState.newArms" class="structure_field"><div class="structure_field_doc"><p>A map from decisions (excluding <code>unknown</code>) to the declarations with
these decisions (in correct order). Basically:</p><ul>
<li>Which declarations do we not move</li>
<li>Which declarations do we move into a certain arm</li>
<li>Which declarations do we move into the default arm</li>
</ul></div><div class="structure_field_info">newArms : <span class="fn"><a href="../../.././Lean/Data/HashMap.html#Lean.HashMap">Lean.HashMap</a> <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.Decision">Lean.Compiler.LCNF.FloatLetIn.Decision</a> (<span class="fn"><a href="../../.././Init/Prelude.html#List">List</a> <a href="../../.././Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.CodeDecl">Lean.Compiler.LCNF.CodeDecl</a></span>)</span></div></li></ul><p>The state for <code><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.FloatM">FloatM</a></code></p><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.Compiler.LCNF.FloatLetIn.FloatState" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.FloatLetIn.BaseFloatM"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean#L74-L74">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.BaseFloatM">Lean.Compiler.LCNF.FloatLetIn.BaseFloatM</a></span><span class="decl_args">
<span class="fn">(α : <span class="fn">Type</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><p>Use to collect relevant declarations for the floating mechanism.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.BaseFloatM">Lean.Compiler.LCNF.FloatLetIn.BaseFloatM</a> <a href="../../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../../.././Init/Prelude.html#ReaderT">ReaderT</a> <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.BaseFloatContext">Lean.Compiler.LCNF.FloatLetIn.BaseFloatContext</a> <a href="../../.././Lean/Compiler/LCNF/CompilerM.html#Lean.Compiler.LCNF.CompilerM">Lean.Compiler.LCNF.CompilerM</a></span></span></li></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.FloatLetIn.FloatM"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean#L79-L79">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.FloatM">Lean.Compiler.LCNF.FloatLetIn.FloatM</a></span><span class="decl_args">
<span class="fn">(α : <span class="fn">Type</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><p>Use to compute the actual floating.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.FloatM">Lean.Compiler.LCNF.FloatLetIn.FloatM</a> <a href="../../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../../.././Init/Control/StateRef.html#StateRefT'">StateRefT'</a> <a href="../../.././Init/System/IO.html#IO.RealWorld">IO.RealWorld</a> <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.FloatState">Lean.Compiler.LCNF.FloatLetIn.FloatState</a> <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.BaseFloatM">Lean.Compiler.LCNF.FloatLetIn.BaseFloatM</a></span></span></li></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.FloatLetIn.withNewCandidate"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean#L84-L86">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.withNewCandidate">Lean.Compiler.LCNF.FloatLetIn.withNewCandidate</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="decl_args">
<span class="fn">(decl : <a href="../../.././Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.CodeDecl">Lean.Compiler.LCNF.CodeDecl</a>)</span></span>
<span class="decl_args">
<span class="fn">(x : <span class="fn"><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.BaseFloatM">Lean.Compiler.LCNF.FloatLetIn.BaseFloatM</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.BaseFloatM">Lean.Compiler.LCNF.FloatLetIn.BaseFloatM</a> <span class="fn">α</span></span></div></div><p>Add <code>decl</code> to the list of declarations and run <code>x</code> with that updated context.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.withNewCandidate">Lean.Compiler.LCNF.FloatLetIn.withNewCandidate</a> <span class="fn">decl</span> <span class="fn">x</span></span> <a href="../../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../../.././Init/Prelude.html#MonadWithReader.withReader">withReader</a> (<span class="fn">fun <span class="fn">r</span> =&gt <span class="fn">{ <span class="fn">decls</span> := <span class="fn"><span class="fn">decl</span> <a href="../../.././Init/Prelude.html#List.cons">::</a> <span class="fn"><span class="fn">r</span>.decls</span></span> }</span></span>) <span class="fn">x</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.FloatLetIn.withNewScope"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean#L91-L93">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.withNewScope">Lean.Compiler.LCNF.FloatLetIn.withNewScope</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="decl_args">
<span class="fn">(x : <span class="fn"><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.BaseFloatM">Lean.Compiler.LCNF.FloatLetIn.BaseFloatM</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.BaseFloatM">Lean.Compiler.LCNF.FloatLetIn.BaseFloatM</a> <span class="fn">α</span></span></div></div><p>Run <code>x</code> with an empty list of declarations.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.withNewScope">Lean.Compiler.LCNF.FloatLetIn.withNewScope</a> <span class="fn">x</span></span> <a href="../../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../../.././Init/Prelude.html#MonadWithReader.withReader">withReader</a> (<span class="fn">fun <span class="fn">x</span> =&gt <span class="fn">{ <span class="fn">decls</span> := <span class="fn">[]</span> }</span></span>) <span class="fn">x</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.FloatLetIn.ignore?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean#L100-L106">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.ignore?">Lean.Compiler.LCNF.FloatLetIn.ignore?</a></span><span class="decl_args">
<span class="fn">(decl : <a href="../../.././Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.LetDecl">Lean.Compiler.LCNF.LetDecl</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.BaseFloatM">Lean.Compiler.LCNF.FloatLetIn.BaseFloatM</a> <a href="../../.././Init/Prelude.html#Bool">Bool</a></span></div></div><p>Whether to ignore <code>decl</code> for the floating mechanism. We want to do this if:</p><ul>
<li><code>decl</code>' is storing a typeclass instance</li>
<li><code>decl</code> is a projection from a variable that is storing a typeclass instance</li>
</ul><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.FloatLetIn.initialDecisions"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean#L118-L143">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.initialDecisions">Lean.Compiler.LCNF.FloatLetIn.initialDecisions</a></span><span class="decl_args">
<span class="fn">(cs : <a href="../../.././Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Cases">Lean.Compiler.LCNF.Cases</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.BaseFloatM">Lean.Compiler.LCNF.FloatLetIn.BaseFloatM</a> (<span class="fn"><a href="../../.././Lean/Data/HashMap.html#Lean.HashMap">Lean.HashMap</a> <a href="../../.././Lean/Expr.html#Lean.FVarId">Lean.FVarId</a> <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.Decision">Lean.Compiler.LCNF.FloatLetIn.Decision</a></span>)</span></div></div><p>Compute the initial decision for all declarations that <code><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.BaseFloatM">BaseFloatM</a></code> collected
up to this point, with respect to <code>cs</code>. The initial decisions are:</p><ul>
<li><code>dont</code> if the declaration is detected by <code><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.ignore?">ignore?</a></code></li>
<li><code>dont</code> if the declaration is the discriminant of <code>cs</code> since we obviously need
the discriminant to be computed before the match.</li>
<li><code>dont</code> if we see the declaration being used in more than one cases arm</li>
<li><code>arm</code> or <code>default</code> if we see the declaration only being used in exactly one cases arm</li>
<li><code>unknown</code> otherwise</li>
</ul><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.FloatLetIn.initialDecisions.goFVar"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean#L132-L137">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.initialDecisions.goFVar">Lean.Compiler.LCNF.FloatLetIn.initialDecisions.goFVar</a></span><span class="decl_args">
<span class="fn">(plannedDecision : <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.Decision">Lean.Compiler.LCNF.FloatLetIn.Decision</a>)</span></span>
<span class="decl_args">
<span class="fn">(var : <a href="../../.././Lean/Expr.html#Lean.FVarId">Lean.FVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Control/StateRef.html#StateRefT'">StateRefT'</a> <a href="../../.././Init/System/IO.html#IO.RealWorld">IO.RealWorld</a> (<span class="fn"><a href="../../.././Lean/Data/HashMap.html#Lean.HashMap">Lean.HashMap</a> <a href="../../.././Lean/Expr.html#Lean.FVarId">Lean.FVarId</a> <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.Decision">Lean.Compiler.LCNF.FloatLetIn.Decision</a></span>)
  <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.BaseFloatM">Lean.Compiler.LCNF.FloatLetIn.BaseFloatM</a> <a href="../../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.FloatLetIn.initialDecisions.goAlt"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean#L140-L141">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.initialDecisions.goAlt">Lean.Compiler.LCNF.FloatLetIn.initialDecisions.goAlt</a></span><span class="decl_args">
<span class="fn">(alt : <a href="../../.././Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Alt">Lean.Compiler.LCNF.Alt</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Control/StateRef.html#StateRefT'">StateRefT'</a> <a href="../../.././Init/System/IO.html#IO.RealWorld">IO.RealWorld</a> (<span class="fn"><a href="../../.././Lean/Data/HashMap.html#Lean.HashMap">Lean.HashMap</a> <a href="../../.././Lean/Expr.html#Lean.FVarId">Lean.FVarId</a> <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.Decision">Lean.Compiler.LCNF.FloatLetIn.Decision</a></span>)
  <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.BaseFloatM">Lean.Compiler.LCNF.FloatLetIn.BaseFloatM</a> <a href="../../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.FloatLetIn.initialDecisions.goCases"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean#L142-L143">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.initialDecisions.goCases">Lean.Compiler.LCNF.FloatLetIn.initialDecisions.goCases</a></span><span class="decl_args">
<span class="fn">(cs : <a href="../../.././Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Cases">Lean.Compiler.LCNF.Cases</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Control/StateRef.html#StateRefT'">StateRefT'</a> <a href="../../.././Init/System/IO.html#IO.RealWorld">IO.RealWorld</a> (<span class="fn"><a href="../../.././Lean/Data/HashMap.html#Lean.HashMap">Lean.HashMap</a> <a href="../../.././Lean/Expr.html#Lean.FVarId">Lean.FVarId</a> <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.Decision">Lean.Compiler.LCNF.FloatLetIn.Decision</a></span>)
  <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.BaseFloatM">Lean.Compiler.LCNF.FloatLetIn.BaseFloatM</a> <a href="../../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.initialDecisions.goCases">Lean.Compiler.LCNF.FloatLetIn.initialDecisions.goCases</a> <span class="fn">cs</span></span> <a href="../../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../../.././Init/Data/Array/Basic.html#Array.forM">Array.forM</a> <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.initialDecisions.goAlt">Lean.Compiler.LCNF.FloatLetIn.initialDecisions.goAlt</a> <span class="fn"><span class="fn">cs</span>.alts</span> <span class="fn">0</span> (<span class="fn"><a href="../../.././Init/Prelude.html#Array.size">Array.size</a> <span class="fn"><span class="fn">cs</span>.alts</span></span>)</span></span></li></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.FloatLetIn.initialNewArms"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean#L149-L152">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.initialNewArms">Lean.Compiler.LCNF.FloatLetIn.initialNewArms</a></span><span class="decl_args">
<span class="fn">(cs : <a href="../../.././Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Cases">Lean.Compiler.LCNF.Cases</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Lean/Data/HashMap.html#Lean.HashMap">Lean.HashMap</a> <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.Decision">Lean.Compiler.LCNF.FloatLetIn.Decision</a> (<span class="fn"><a href="../../.././Init/Prelude.html#List">List</a> <a href="../../.././Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.CodeDecl">Lean.Compiler.LCNF.CodeDecl</a></span>)</span></div></div><p>Compute the initial new arms. This will just set up a map from all arms of
<code>cs</code> to empty <code><a href="../../.././Init/Prelude.html#Array">Array</a></code>s, plus one additional entry for <code>dont</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.FloatLetIn.dontFloat"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean#L170-L176">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.dontFloat">Lean.Compiler.LCNF.FloatLetIn.dontFloat</a></span><span class="decl_args">
<span class="fn">(decl : <a href="../../.././Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.CodeDecl">Lean.Compiler.LCNF.CodeDecl</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.FloatM">Lean.Compiler.LCNF.FloatLetIn.FloatM</a> <a href="../../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Will:</p><ul>
<li>put <code>decl</code> into the <code>dont</code> arm</li>
<li>decide that any free variable that occurs in <code>decl</code> and is a declaration
of interest as not getting moved either.</li>
</ul><pre><code>let x := ...
let y := ...
let z := x + y
cases z with
| n => z * x
| m => z * y
</code></pre><p>Here <code>x</code> and <code>y</code> are originally marked as getting floated into <code>n</code> and <code>m</code>
respectively but since <code>z</code> can't be moved we don't want that to move <code>x</code> and <code>y</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.FloatLetIn.dontFloat.goFVar"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean#L174-L176">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.dontFloat.goFVar">Lean.Compiler.LCNF.FloatLetIn.dontFloat.goFVar</a></span><span class="decl_args">
<span class="fn">(fvar : <a href="../../.././Lean/Expr.html#Lean.FVarId">Lean.FVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.FloatM">Lean.Compiler.LCNF.FloatLetIn.FloatM</a> <a href="../../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.FloatLetIn.float"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean#L224-L234">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.float">Lean.Compiler.LCNF.FloatLetIn.float</a></span><span class="decl_args">
<span class="fn">(decl : <a href="../../.././Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.CodeDecl">Lean.Compiler.LCNF.CodeDecl</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.FloatM">Lean.Compiler.LCNF.FloatLetIn.FloatM</a> <a href="../../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Will:</p><ul>
<li>put <code>decl</code> into the arm it is marked to be moved into</li>
<li>for any variables that might occur in <code>decl</code> and are of interest:
<ul>
<li>if they are already meant to be floated into the same arm or not at all leave them untouched:
<pre><code>let x := ...
let y := x + z
cases z with
| n => x * y
| m => z
</code></pre>
If we are at <code>y</code> <code>x</code> is alreayd marked to be floated into <code>n</code> as well.</li>
<li>if there hasn't be a decision yet, that is they are marked with <code>.unknown</code> we float
them into the same arm as the current value:
<pre><code>let x := ..
let y := x + 2
cases z with
| n => y
| m => z
</code></pre>
Here <code>x</code> is initially marked as <code>.unknown</code> since it occurs in no branch, however
since we want to move <code>y</code> into the <code>n</code> branch we can also decide to move <code>x</code>
into the <code>n</code> branch. Note that this decision might be revoked later on in the case of:
<pre><code>let x := ..
let a := x + 1
let y := x + 2
cases z with
| n => y
| m => a
</code></pre>
When we visit <code>a</code> <code>x</code> is now marked as getting moved into <code>n</code> but since it also occurs
in <code>a</code> which wants to be moved somewhere else we will instead decide to not move <code>x</code>
at all.</li>
<li>if they are meant to be floated somewhere else decide that they wont get floated:
<pre><code>let x := ...
let y := x + z
cases z with
| n => y
| m => x
</code></pre>
If we are at <code>y</code> <code>x</code> is still marked to be moved but we don't want that.</li>
</ul>
</li>
</ul><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.FloatLetIn.float.goFVar"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean#L229-L234">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.float.goFVar">Lean.Compiler.LCNF.FloatLetIn.float.goFVar</a></span><span class="decl_args">
<span class="fn">(fvar : <a href="../../.././Lean/Expr.html#Lean.FVarId">Lean.FVarId</a>)</span></span>
<span class="decl_args">
<span class="fn">(arm : <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.Decision">Lean.Compiler.LCNF.FloatLetIn.Decision</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.FloatM">Lean.Compiler.LCNF.FloatLetIn.FloatM</a> <a href="../../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.FloatLetIn.floatLetIn"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean#L240-L298">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.floatLetIn">Lean.Compiler.LCNF.FloatLetIn.floatLetIn</a></span><span class="decl_args">
<span class="fn">(decl : <a href="../../.././Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Decl">Lean.Compiler.LCNF.Decl</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/CompilerM.html#Lean.Compiler.LCNF.CompilerM">Lean.Compiler.LCNF.CompilerM</a> <a href="../../.././Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Decl">Lean.Compiler.LCNF.Decl</a></span></div></div><p>Iterate throgh <code>decl</code>, pushing local declarations that are only used in one
control flow arm into said arm in order to avoid useless computations.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.FloatLetIn.floatLetIn.goCases"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean#L249-L261">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.floatLetIn.goCases">Lean.Compiler.LCNF.FloatLetIn.floatLetIn.goCases</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.FloatM">Lean.Compiler.LCNF.FloatLetIn.FloatM</a> <a href="../../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Iterate through the collected declarations,
determining from the bottom up whether they (and the declarations they refer to)
should get moved down into the arms of the cases statement or not.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.FloatLetIn.floatLetIn.go"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean#L263-L298">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.floatLetIn.go">Lean.Compiler.LCNF.FloatLetIn.floatLetIn.go</a></span><span class="decl_args">
<span class="fn">(code : <a href="../../.././Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Code">Lean.Compiler.LCNF.Code</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.BaseFloatM">Lean.Compiler.LCNF.FloatLetIn.BaseFloatM</a> <a href="../../.././Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Code">Lean.Compiler.LCNF.Code</a></span></div></div></div></div><div class="decl" id="Lean.Compiler.LCNF.Decl.floatLetIn"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean#L302-L303">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.Decl.floatLetIn">Lean.Compiler.LCNF.Decl.floatLetIn</a></span><span class="decl_args">
<span class="fn">(decl : <a href="../../.././Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Decl">Lean.Compiler.LCNF.Decl</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/CompilerM.html#Lean.Compiler.LCNF.CompilerM">Lean.Compiler.LCNF.CompilerM</a> <a href="../../.././Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Decl">Lean.Compiler.LCNF.Decl</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.Decl.floatLetIn">Lean.Compiler.LCNF.Decl.floatLetIn</a> <span class="fn">decl</span></span> <a href="../../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.FloatLetIn.floatLetIn">Lean.Compiler.LCNF.FloatLetIn.floatLetIn</a> <span class="fn">decl</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Compiler.LCNF.floatLetIn"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Compiler/LCNF/FloatLetIn.lean#L305-L306">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.floatLetIn">Lean.Compiler.LCNF.floatLetIn</a></span><span class="decl_args">
<span class="fn">(phase : <span class="fn"><a href="../../.././Init/Prelude.html#optParam">optParam</a> <a href="../../.././Lean/Compiler/LCNF/CompilerM.html#Lean.Compiler.LCNF.Phase">Lean.Compiler.LCNF.Phase</a> <a href="../../.././Lean/Compiler/LCNF/CompilerM.html#Lean.Compiler.LCNF.Phase.base">Lean.Compiler.LCNF.Phase.base</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(occurrence : <span class="fn"><a href="../../.././Init/Prelude.html#optParam">optParam</a> <a href="../../.././Init/Prelude.html#Nat">Nat</a> <span class="fn">0</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../../.././Lean/Compiler/LCNF/PassManager.html#Lean.Compiler.LCNF.Pass">Lean.Compiler.LCNF.Pass</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.floatLetIn">Lean.Compiler.LCNF.floatLetIn</a> <span class="fn">phase</span> <span class="fn">occurrence</span></span> <a href="../../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../../.././Lean/Compiler/LCNF/PassManager.html#Lean.Compiler.LCNF.Pass.mkPerDeclaration">Lean.Compiler.LCNF.Pass.mkPerDeclaration</a> <span class="fn">`floatLetIn</span> <a href="../../.././Lean/Compiler/LCNF/FloatLetIn.html#Lean.Compiler.LCNF.Decl.floatLetIn">Lean.Compiler.LCNF.Decl.floatLetIn</a> <span class="fn">phase</span> <span class="fn">occurrence</span></span></span></li></ul></details></div></div></main>
<nav class="nav"><iframe src="../../.././/navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>