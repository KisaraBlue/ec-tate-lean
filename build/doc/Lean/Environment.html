<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href=".././style.css"></link><link rel="stylesheet" href=".././src/pygments.css"></link><link rel="shortcut icon" href=".././favicon.ico"></link><link rel="prefetch" href=".././/declarations/declaration-data.bmp" as="image"></link><title>Lean.Environment</title><script defer="true" src=".././mathjax-config.js"></script><script defer="true" src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT=".././";</script><script>const MODULE_NAME="Lean.Environment";</script><script type="module" src=".././nav.js"></script><script type="module" src=".././search.js"></script><script type="module" src=".././how-about.js"></script><script type="module" src=".././instances.js"></script><script type="module" src=".././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label>Documentation</h1><p class="header_filename break_within">Lean.Environment</p><form action="https://google.com/search" method="get" id="search_form"><input type="hidden" name="sitesearch" value="https://leanprover-community.github.io/mathlib_docs"></input><input type="text" name="q" autocomplete="off"></input><button>Google site search</button></form></header><nav class="internal_nav"><h3><a class="break_within" href="#top">Lean.Environment</a></h3><p class="gh_nav_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href=".././Init.html">Init</a></li><li><a href=".././Lean/Declaration.html">Lean.Declaration</a></li><li><a href=".././Lean/ImportingFlag.html">Lean.ImportingFlag</a></li><li><a href=".././Lean/LocalContext.html">Lean.LocalContext</a></li><li><a href=".././Lean/Data/HashMap.html">Lean.Data.HashMap</a></li><li><a href=".././Lean/Data/SMap.html">Lean.Data.SMap</a></li><li><a href=".././Lean/Util/FindExpr.html">Lean.Util.FindExpr</a></li><li><a href=".././Lean/Util/InstantiateLevelParams.html">Lean.Util.InstantiateLevelParams</a></li><li><a href=".././Lean/Util/Path.html">Lean.Util.Path</a></li><li><a href=".././Lean/Util/Profile.html">Lean.Util.Profile</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Lean.Environment" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionStateSpec">Lean.EnvExtensionStateSpec</a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionState">Lean.EnvExtensionState</a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedEnvExtensionState">Lean.instInhabitedEnvExtensionState</a></div><div class="nav_link"><a class="break_within" href="#Lean.ModuleIdx">Lean.ModuleIdx</a></div><div class="nav_link"><a class="break_within" href="#Lean.ModuleIdx.toNat">Lean.ModuleIdx.toNat</a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedModuleIdx">Lean.instInhabitedModuleIdx</a></div><div class="nav_link"><a class="break_within" href="#Lean.ConstMap">Lean.ConstMap</a></div><div class="nav_link"><a class="break_within" href="#Lean.Import">Lean.Import</a></div><div class="nav_link"><a class="break_within" href="#Lean.instToStringImport">Lean.instToStringImport</a></div><div class="nav_link"><a class="break_within" href="#Lean.CompactedRegion">Lean.CompactedRegion</a></div><div class="nav_link"><a class="break_within" href="#Lean.CompactedRegion.isMemoryMapped">Lean.CompactedRegion.isMemoryMapped</a></div><div class="nav_link"><a class="break_within" href="#Lean.CompactedRegion.free">Lean.CompactedRegion.free</a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionEntrySpec">Lean.EnvExtensionEntrySpec</a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionEntry">Lean.EnvExtensionEntry</a></div><div class="nav_link"><a class="break_within" href="#Lean.instNonemptyEnvExtensionEntry">Lean.instNonemptyEnvExtensionEntry</a></div><div class="nav_link"><a class="break_within" href="#Lean.ModuleData">Lean.ModuleData</a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedModuleData">Lean.instInhabitedModuleData</a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvironmentHeader">Lean.EnvironmentHeader</a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedEnvironmentHeader">Lean.instInhabitedEnvironmentHeader</a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment">Lean.Environment</a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedEnvironment">Lean.instInhabitedEnvironment</a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.addAux">Lean.Environment.addAux</a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.addExtraName">Lean.Environment.addExtraName</a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.find?">Lean.Environment.find?</a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.contains">Lean.Environment.contains</a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.imports">Lean.Environment.imports</a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.allImportedModuleNames">Lean.Environment.allImportedModuleNames</a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.setMainModule">Lean.Environment.setMainModule</a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.mainModule">Lean.Environment.mainModule</a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.getModuleIdxFor?">Lean.Environment.getModuleIdxFor?</a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.isConstructor">Lean.Environment.isConstructor</a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.getModuleIdx?">Lean.Environment.getModuleIdx?</a></div><div class="nav_link"><a class="break_within" href="#Lean.KernelException">Lean.KernelException</a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.addDecl">Lean.Environment.addDecl</a></div><div class="nav_link"><a class="break_within" href="#Lean.ConstantInfo.instantiateTypeLevelParams">Lean.ConstantInfo.instantiateTypeLevelParams</a></div><div class="nav_link"><a class="break_within" href="#Lean.ConstantInfo.instantiateValueLevelParams!">Lean.ConstantInfo.instantiateValueLevelParams!</a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionInterface">Lean.EnvExtensionInterface</a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedEnvExtensionInterface">Lean.instInhabitedEnvExtensionInterface</a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionInterfaceUnsafe.Ext">Lean.EnvExtensionInterfaceUnsafe.Ext</a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionInterfaceUnsafe.instInhabitedExt">Lean.EnvExtensionInterfaceUnsafe.instInhabitedExt</a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionInterfaceUnsafe.ensureExtensionsArraySize">Lean.EnvExtensionInterfaceUnsafe.ensureExtensionsArraySize</a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionInterfaceUnsafe.ensureExtensionsArraySize.loop">Lean.EnvExtensionInterfaceUnsafe.ensureExtensionsArraySize.loop</a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionInterfaceUnsafe.setState">Lean.EnvExtensionInterfaceUnsafe.setState</a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionInterfaceUnsafe.modifyState">Lean.EnvExtensionInterfaceUnsafe.modifyState</a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionInterfaceUnsafe.getState">Lean.EnvExtensionInterfaceUnsafe.getState</a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionInterfaceUnsafe.registerExt">Lean.EnvExtensionInterfaceUnsafe.registerExt</a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionInterfaceUnsafe.mkInitialExtStates">Lean.EnvExtensionInterfaceUnsafe.mkInitialExtStates</a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionInterfaceUnsafe.imp">Lean.EnvExtensionInterfaceUnsafe.imp</a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionInterfaceImp">Lean.EnvExtensionInterfaceImp</a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtension">Lean.EnvExtension</a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtension.instInhabitedEnvExtension">Lean.EnvExtension.instInhabitedEnvExtension</a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtension.setState">Lean.EnvExtension.setState</a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtension.modifyState">Lean.EnvExtension.modifyState</a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtension.getState">Lean.EnvExtension.getState</a></div><div class="nav_link"><a class="break_within" href="#Lean.registerEnvExtension">Lean.registerEnvExtension</a></div><div class="nav_link"><a class="break_within" href="#Lean.mkEmptyEnvironment">Lean.mkEmptyEnvironment</a></div><div class="nav_link"><a class="break_within" href="#Lean.PersistentEnvExtensionState">Lean.PersistentEnvExtensionState</a></div><div class="nav_link"><a class="break_within" href="#Lean.ImportM.Context">Lean.ImportM.Context</a></div><div class="nav_link"><a class="break_within" href="#Lean.ImportM">Lean.ImportM</a></div><div class="nav_link"><a class="break_within" href="#Lean.PersistentEnvExtension">Lean.PersistentEnvExtension</a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedPersistentEnvExtensionState">Lean.instInhabitedPersistentEnvExtensionState</a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedPersistentEnvExtension">Lean.instInhabitedPersistentEnvExtension</a></div><div class="nav_link"><a class="break_within" href="#Lean.PersistentEnvExtension.getModuleEntries">Lean.PersistentEnvExtension.getModuleEntries</a></div><div class="nav_link"><a class="break_within" href="#Lean.PersistentEnvExtension.addEntry">Lean.PersistentEnvExtension.addEntry</a></div><div class="nav_link"><a class="break_within" href="#Lean.PersistentEnvExtension.getState">Lean.PersistentEnvExtension.getState</a></div><div class="nav_link"><a class="break_within" href="#Lean.PersistentEnvExtension.setState">Lean.PersistentEnvExtension.setState</a></div><div class="nav_link"><a class="break_within" href="#Lean.PersistentEnvExtension.modifyState">Lean.PersistentEnvExtension.modifyState</a></div><div class="nav_link"><a class="break_within" href="#Lean.persistentEnvExtensionsRef">Lean.persistentEnvExtensionsRef</a></div><div class="nav_link"><a class="break_within" href="#Lean.PersistentEnvExtensionDescr">Lean.PersistentEnvExtensionDescr</a></div><div class="nav_link"><a class="break_within" href="#Lean.registerPersistentEnvExtensionUnsafe">Lean.registerPersistentEnvExtensionUnsafe</a></div><div class="nav_link"><a class="break_within" href="#Lean.registerPersistentEnvExtension">Lean.registerPersistentEnvExtension</a></div><div class="nav_link"><a class="break_within" href="#Lean.SimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension</a></div><div class="nav_link"><a class="break_within" href="#Lean.mkStateFromImportedEntries">Lean.mkStateFromImportedEntries</a></div><div class="nav_link"><a class="break_within" href="#Lean.SimplePersistentEnvExtensionDescr">Lean.SimplePersistentEnvExtensionDescr</a></div><div class="nav_link"><a class="break_within" href="#Lean.registerSimplePersistentEnvExtension">Lean.registerSimplePersistentEnvExtension</a></div><div class="nav_link"><a class="break_within" href="#Lean.SimplePersistentEnvExtension.instInhabitedSimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension.instInhabitedSimplePersistentEnvExtension</a></div><div class="nav_link"><a class="break_within" href="#Lean.SimplePersistentEnvExtension.getEntries">Lean.SimplePersistentEnvExtension.getEntries</a></div><div class="nav_link"><a class="break_within" href="#Lean.SimplePersistentEnvExtension.getState">Lean.SimplePersistentEnvExtension.getState</a></div><div class="nav_link"><a class="break_within" href="#Lean.SimplePersistentEnvExtension.setState">Lean.SimplePersistentEnvExtension.setState</a></div><div class="nav_link"><a class="break_within" href="#Lean.SimplePersistentEnvExtension.modifyState">Lean.SimplePersistentEnvExtension.modifyState</a></div><div class="nav_link"><a class="break_within" href="#Lean.TagDeclarationExtension">Lean.TagDeclarationExtension</a></div><div class="nav_link"><a class="break_within" href="#Lean.mkTagDeclarationExtension">Lean.mkTagDeclarationExtension</a></div><div class="nav_link"><a class="break_within" href="#Lean.TagDeclarationExtension.instInhabitedTagDeclarationExtension">Lean.TagDeclarationExtension.instInhabitedTagDeclarationExtension</a></div><div class="nav_link"><a class="break_within" href="#Lean.TagDeclarationExtension.tag">Lean.TagDeclarationExtension.tag</a></div><div class="nav_link"><a class="break_within" href="#Lean.TagDeclarationExtension.isTagged">Lean.TagDeclarationExtension.isTagged</a></div><div class="nav_link"><a class="break_within" href="#Lean.MapDeclarationExtension">Lean.MapDeclarationExtension</a></div><div class="nav_link"><a class="break_within" href="#Lean.mkMapDeclarationExtension">Lean.mkMapDeclarationExtension</a></div><div class="nav_link"><a class="break_within" href="#Lean.MapDeclarationExtension.instInhabitedMapDeclarationExtension">Lean.MapDeclarationExtension.instInhabitedMapDeclarationExtension</a></div><div class="nav_link"><a class="break_within" href="#Lean.MapDeclarationExtension.insert">Lean.MapDeclarationExtension.insert</a></div><div class="nav_link"><a class="break_within" href="#Lean.MapDeclarationExtension.find?">Lean.MapDeclarationExtension.find?</a></div><div class="nav_link"><a class="break_within" href="#Lean.MapDeclarationExtension.contains">Lean.MapDeclarationExtension.contains</a></div><div class="nav_link"><a class="break_within" href="#Lean.saveModuleData">Lean.saveModuleData</a></div><div class="nav_link"><a class="break_within" href="#Lean.readModuleData">Lean.readModuleData</a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.freeRegions">Lean.Environment.freeRegions</a></div><div class="nav_link"><a class="break_within" href="#Lean.mkModuleData">Lean.mkModuleData</a></div><div class="nav_link"><a class="break_within" href="#Lean.writeModule">Lean.writeModule</a></div><div class="nav_link"><a class="break_within" href="#Lean.updateEnvAttributes">Lean.updateEnvAttributes</a></div><div class="nav_link"><a class="break_within" href="#Lean.getNumBuiltiAttributes">Lean.getNumBuiltiAttributes</a></div><div class="nav_link"><a class="break_within" href="#Lean.ImportState">Lean.ImportState</a></div><div class="nav_link"><a class="break_within" href="#Lean.throwAlreadyImported">Lean.throwAlreadyImported</a></div><div class="nav_link"><a class="break_within" href="#Lean.importModules">Lean.importModules</a></div><div class="nav_link"><a class="break_within" href="#Lean.importModules.importMods">Lean.importModules.importMods</a></div><div class="nav_link"><a class="break_within" href="#Lean.withImportModules">Lean.withImportModules</a></div><div class="nav_link"><a class="break_within" href="#Lean.namespacesExt">Lean.namespacesExt</a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.registerNamespace">Lean.Environment.registerNamespace</a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.isNamespace">Lean.Environment.isNamespace</a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.getNamespaceSet">Lean.Environment.getNamespaceSet</a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.add">Lean.Environment.add</a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.displayStats">Lean.Environment.displayStats</a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.evalConst">Lean.Environment.evalConst</a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.evalConstCheck">Lean.Environment.evalConstCheck</a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.hasUnsafe">Lean.Environment.hasUnsafe</a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.isDefEq">Lean.Kernel.isDefEq</a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.isDefEqGuarded">Lean.Kernel.isDefEqGuarded</a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.whnf">Lean.Kernel.whnf</a></div><div class="nav_link"><a class="break_within" href="#Lean.MonadEnv">Lean.MonadEnv</a></div><div class="nav_link"><a class="break_within" href="#Lean.instMonadEnv">Lean.instMonadEnv</a></div></nav><main>
<div class="decl" id="Lean.EnvExtensionStateSpec"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L18-L18">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionStateSpec">Lean.EnvExtensionStateSpec</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">(α : <span class="fn">Type</span>) × <span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">α</span></span></span></div></div><p>Opaque environment extension state.</p></div></div><div class="decl" id="Lean.EnvExtensionState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L19-L19">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionStateSpec">Lean.EnvExtensionStateSpec</a>.fst</span></span></li></ul></details></div></div><div class="decl" id="Lean.instInhabitedEnvExtensionState"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L20-L20">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instInhabitedEnvExtensionState">Lean.instInhabitedEnvExtensionState</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.instInhabitedEnvExtensionState">Lean.instInhabitedEnvExtensionState</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionStateSpec">Lean.EnvExtensionStateSpec</a>.snd</span></span></li></ul></details></div></div><div class="decl" id="Lean.ModuleIdx"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L22-L23">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ModuleIdx">Lean.ModuleIdx</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.ModuleIdx">Lean.ModuleIdx</a> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Prelude.html#Nat">Nat</a></span></li></ul></details></div></div><div class="decl" id="Lean.ModuleIdx.toNat"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L25-L25">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ModuleIdx.toNat">Lean.ModuleIdx.toNat</a></span><span class="decl_args">
<span class="fn">(midx : <a href=".././Lean/Environment.html#Lean.ModuleIdx">Lean.ModuleIdx</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Nat">Nat</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.ModuleIdx.toNat">Lean.ModuleIdx.toNat</a> <span class="fn">midx</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">midx</span></span></li></ul></details></div></div><div class="decl" id="Lean.instInhabitedModuleIdx"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L27-L27">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instInhabitedModuleIdx">Lean.instInhabitedModuleIdx</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/Environment.html#Lean.ModuleIdx">Lean.ModuleIdx</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.instInhabitedModuleIdx">Lean.instInhabitedModuleIdx</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Prelude.html#inferInstanceAs">inferInstanceAs</a> (<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Init/Prelude.html#Nat">Nat</a></span>)</span></span></li></ul></details></div></div><div class="decl" id="Lean.ConstMap"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L29-L29">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ConstMap">Lean.ConstMap</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.ConstMap">Lean.ConstMap</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Data/SMap.html#Lean.SMap">Lean.SMap</a> <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a> <a href=".././Lean/Declaration.html#Lean.ConstantInfo">Lean.ConstantInfo</a></span></span></li></ul></details></div></div><div class="decl" id="Lean.Import"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L31-L33">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Import">Lean.Import</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.Import.mk"><li id="Lean.Import.module" class="structure_field"><div class="structure_field_info">module : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a></div></li><li id="Lean.Import.runtimeOnly" class="structure_field"><div class="structure_field_info">runtimeOnly : <a href=".././Init/Prelude.html#Bool">Bool</a></div></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.Import" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.instToStringImport"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L35-L35">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instToStringImport">Lean.instToStringImport</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Data/ToString/Basic.html#ToString">ToString</a> <a href=".././Lean/Environment.html#Lean.Import">Lean.Import</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.instToStringImport">Lean.instToStringImport</a> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn">{ <span class="fn">toString</span> := <span class="fn">fun <span class="fn">imp</span> =&gt <span class="fn"><span class="fn"><a href=".././Init/Data/ToString/Basic.html#ToString.toString">toString</a> <span class="fn"><span class="fn">imp</span>.module</span></span> <a href=".././Init/Prelude.html#HAppend.hAppend">++</a> <span class="fn">if <span class="fn"><span class="fn"><span class="fn">imp</span>.runtimeOnly</span> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Prelude.html#Bool.true">true</a></span> then <span class="fn">&quot (runtime)&quot</span> else <span class="fn">&quot&quot</span></span></span></span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.CompactedRegion"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L41-L41">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.CompactedRegion">Lean.CompactedRegion</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><p>A compacted region holds multiple Lean objects in a contiguous memory region, which can be read/written to/from disk.
Objects inside the region do not have reference counters and cannot be freed individually. The contents of .olean
files are compacted regions.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.CompactedRegion">Lean.CompactedRegion</a> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Prelude.html#USize">USize</a></span></li></ul></details></div></div><div class="decl" id="Lean.CompactedRegion.isMemoryMapped"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L44-L44">source</a></div><div class="attributes">@[extern  lean_compacted_region_is_memory_mapped]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.CompactedRegion.isMemoryMapped">Lean.CompactedRegion.isMemoryMapped</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Environment.html#Lean.CompactedRegion">Lean.CompactedRegion</a> → <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div></div></div><div class="decl" id="Lean.CompactedRegion.free"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L48-L48">source</a></div><div class="attributes">@[extern  lean_compacted_region_free]</div>
<div class="decl_header"><span class="decl_kind">unsafe opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.CompactedRegion.free">Lean.CompactedRegion.free</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Environment.html#Lean.CompactedRegion">Lean.CompactedRegion</a> → <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></span></div></div><p>Free a compacted region and its contents. No live references to the contents may exist at the time of invocation.</p></div></div><div class="decl" id="Lean.EnvExtensionEntrySpec"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L51-L51">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionEntrySpec">Lean.EnvExtensionEntrySpec</a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#NonemptyType">NonemptyType</a></div></div><p>Opaque persistent environment extension entry.</p></div></div><div class="decl" id="Lean.EnvExtensionEntry"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L52-L52">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionEntry">Lean.EnvExtensionEntry</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionEntry">Lean.EnvExtensionEntry</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Prelude.html#NonemptyType.type">NonemptyType.type</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionEntrySpec">Lean.EnvExtensionEntrySpec</a></span></span></li></ul></details></div></div><div class="decl" id="Lean.instNonemptyEnvExtensionEntry"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L53-L53">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instNonemptyEnvExtensionEntry">Lean.instNonemptyEnvExtensionEntry</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Nonempty">Nonempty</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionEntry">Lean.EnvExtensionEntry</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.instNonemptyEnvExtensionEntry">Lean.instNonemptyEnvExtensionEntry</a> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Lean/Environment.html#Lean.instNonemptyEnvExtensionEntry.proof_1">Lean.instNonemptyEnvExtensionEntry.proof_1</a></span></li></ul></details></div></div><div class="decl" id="Lean.ModuleData"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L57-L74">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ModuleData">Lean.ModuleData</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.ModuleData.mk"><li id="Lean.ModuleData.imports" class="structure_field"><div class="structure_field_info">imports : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.Import">Lean.Import</a></span></div></li><li id="Lean.ModuleData.constNames" class="structure_field"><div class="structure_field_doc"><p><code>constNames</code> contains all constant names in <code>constants</code>.
This information is redundant. It is equal to <code>constants.map fun c => c.name</code>,
but it improves the performance of <code><a href=".././Lean/Environment.html#Lean.importModules">importModules</a></code>. <code>perf</code> reports that 12% of the
runtime was being spent on <code>ConstantInfo.name</code> when importing a file containing only <code>import <a href=".././Lean.html">Lean</a></code></p></div><div class="structure_field_info">constNames : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a></span></div></li><li id="Lean.ModuleData.constants" class="structure_field"><div class="structure_field_info">constants : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Declaration.html#Lean.ConstantInfo">Lean.ConstantInfo</a></span></div></li><li id="Lean.ModuleData.extraConstNames" class="structure_field"><div class="structure_field_doc"><p>Extra entries for the <code>const2ModIdx</code> map in the <code><a href=".././Lean/Environment.html#Lean.Environment">Environment</a></code> object.
The code generator creates auxiliary declarations that are not in the
mapping <code>constants</code>, but we want to know in which module they were generated.</p></div><div class="structure_field_info">extraConstNames : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a></span></div></li><li id="Lean.ModuleData.entries" class="structure_field"><div class="structure_field_info">entries : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> (<span class="fn"><a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a> <a href=".././Init/Prelude.html#Prod">×</a> <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionEntry">Lean.EnvExtensionEntry</a></span></span>)</span></div></li></ul><p>Content of a .olean file.
We use <code>compact.cpp</code> to generate the image of this object in disk.</p><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.ModuleData" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.instInhabitedModuleData"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L74-L74">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instInhabitedModuleData">Lean.instInhabitedModuleData</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/Environment.html#Lean.ModuleData">Lean.ModuleData</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.instInhabitedModuleData">Lean.instInhabitedModuleData</a> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn">{ <span class="fn">default</span> :=
      <span class="fn">{ <span class="fn">imports</span> := <span class="fn">default</span>, <span class="fn">constNames</span> := <span class="fn">default</span>, <span class="fn">constants</span> := <span class="fn">default</span>, <span class="fn">extraConstNames</span> := <span class="fn">default</span>,
        <span class="fn">entries</span> := <span class="fn">default</span> }</span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.EnvironmentHeader"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L77-L100">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvironmentHeader">Lean.EnvironmentHeader</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.EnvironmentHeader.mk"><li id="Lean.EnvironmentHeader.trustLevel" class="structure_field"><div class="structure_field_doc"><p>The trust level used by the kernel. For example,
the kernel assumes imported constants are type correct when the trust level is greater than zero.</p></div><div class="structure_field_info">trustLevel : <a href=".././Init/Prelude.html#UInt32">UInt32</a></div></li><li id="Lean.EnvironmentHeader.quotInit" class="structure_field"><div class="structure_field_doc"><p><code>quotInit = true</code> if the command <code>init_quot</code> has already been executed for the environment, and
<code><a href=".././Init/Prelude.html#Quot">Quot</a></code> declarations have been added to the environment.</p></div><div class="structure_field_info">quotInit : <a href=".././Init/Prelude.html#Bool">Bool</a></div></li><li id="Lean.EnvironmentHeader.mainModule" class="structure_field"><div class="structure_field_doc"><p>Name of the module being compiled.</p></div><div class="structure_field_info">mainModule : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a></div></li><li id="Lean.EnvironmentHeader.imports" class="structure_field"><div class="structure_field_doc"><p>Direct imports</p></div><div class="structure_field_info">imports : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.Import">Lean.Import</a></span></div></li><li id="Lean.EnvironmentHeader.regions" class="structure_field"><div class="structure_field_doc"><p>Compacted regions for all imported modules. Objects in compacted memory regions do no require any memory management.</p></div><div class="structure_field_info">regions : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.CompactedRegion">Lean.CompactedRegion</a></span></div></li><li id="Lean.EnvironmentHeader.moduleNames" class="structure_field"><div class="structure_field_doc"><p>Name of all imported modules (directly and indirectly).</p></div><div class="structure_field_info">moduleNames : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a></span></div></li><li id="Lean.EnvironmentHeader.moduleData" class="structure_field"><div class="structure_field_doc"><p>Module data for all imported modules.</p></div><div class="structure_field_info">moduleData : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.ModuleData">Lean.ModuleData</a></span></div></li></ul><p>Environment fields that are not used often.</p><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.EnvironmentHeader" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.instInhabitedEnvironmentHeader"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L100-L100">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instInhabitedEnvironmentHeader">Lean.instInhabitedEnvironmentHeader</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/Environment.html#Lean.EnvironmentHeader">Lean.EnvironmentHeader</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Environment"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L116-L145">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.Environment.mk"><li id="Lean.Environment.const2ModIdx" class="structure_field"><div class="structure_field_doc"><p>Mapping from constant name to module (index) where constant has been declared.
Recall that a Lean file has a header where previously compiled modules can be imported.
Each imported module has a unique <code><a href=".././Lean/Environment.html#Lean.ModuleIdx">ModuleIdx</a></code>.
Many extensions use the <code><a href=".././Lean/Environment.html#Lean.ModuleIdx">ModuleIdx</a></code> to efficiently retrieve information stored in imported modules.</p><p>Remark: this mapping also contains auxiliary constants, created by the code generator, that are <strong>not</strong> in
the field <code>constants</code>. These auxiliary constants are invisible to the Lean kernel and elaborator.
Only the code generator uses them.</p></div><div class="structure_field_info">const2ModIdx : <span class="fn"><a href=".././Lean/Data/HashMap.html#Lean.HashMap">Lean.HashMap</a> <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a> <a href=".././Lean/Environment.html#Lean.ModuleIdx">Lean.ModuleIdx</a></span></div></li><li id="Lean.Environment.constants" class="structure_field"><div class="structure_field_doc"><p>Mapping from constant name to <code>ConstantInfo</code>. It contains all constants (definitions, theorems, axioms, etc)
that have been already type checked by the kernel.</p></div><div class="structure_field_info">constants : <a href=".././Lean/Environment.html#Lean.ConstMap">Lean.ConstMap</a></div></li><li id="Lean.Environment.extensions" class="structure_field"><div class="structure_field_doc"><p>Environment extensions. It also includes user-defined extensions.</p></div><div class="structure_field_info">extensions : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a></span></div></li><li id="Lean.Environment.extraConstNames" class="structure_field"><div class="structure_field_doc"><p>Constant names to be saved in the field <code>extraConstNames</code> at <code><a href=".././Lean/Environment.html#Lean.ModuleData">ModuleData</a></code>.
It contains auxiliary declaration names created by the code generator which are not in <code>constants</code>.
When importing modules, we want to insert them at <code>const2ModIdx</code>.</p></div><div class="structure_field_info">extraConstNames : <a href=".././Lean/Data/NameMap.html#Lean.NameSet">Lean.NameSet</a></div></li><li id="Lean.Environment.header" class="structure_field"><div class="structure_field_doc"><p>The header contains additional information that is not updated often.</p></div><div class="structure_field_info">header : <a href=".././Lean/Environment.html#Lean.EnvironmentHeader">Lean.EnvironmentHeader</a></div></li></ul><p>An environment stores declarations provided by the user. The kernel
currently supports different kinds of declarations such as definitions, theorems,
and inductive families. Each has a unique identifier (i.e., <code>Name</code>), and can be
parameterized by a sequence of universe parameters.
A constant in Lean is just a reference to a <code>ConstantInfo</code> object. The main task of
the kernel is to type check these declarations and refuse type incorrect ones. The
kernel does not allow declarations containing metavariables and/or free variables
to be added to an environment. Environments are never destructively updated.</p><p>The environment also contains a collection of extensions. For example, the <code>simp</code> theorems
declared by users are stored in an environment extension. Users can declare new extensions
using meta-programming.</p><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.Environment" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.instInhabitedEnvironment"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L145-L145">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instInhabitedEnvironment">Lean.instInhabitedEnvironment</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.instInhabitedEnvironment">Lean.instInhabitedEnvironment</a> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn">{ <span class="fn">default</span> :=
      <span class="fn">{ <span class="fn">const2ModIdx</span> := <span class="fn">default</span>, <span class="fn">constants</span> := <span class="fn">default</span>, <span class="fn">extensions</span> := <span class="fn">default</span>, <span class="fn">extraConstNames</span> := <span class="fn">default</span>,
        <span class="fn">header</span> := <span class="fn">default</span> }</span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.Environment.addAux"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L149-L150">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.addAux">Lean.Environment.addAux</a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(cinfo : <a href=".././Lean/Declaration.html#Lean.ConstantInfo">Lean.ConstantInfo</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Environment.addExtraName"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L157-L161">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.addExtraName">Lean.Environment.addExtraName</a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(name : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><p>Save an extra constant name that is used to populate <code>const2ModIdx</code> when we import
.olean files. We use this feature to save in which module an auxiliary declaration
created by the code generator has been created.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Environment.find?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L164-L166">source</a></div><div class="attributes">@[export lean_environment_find]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.find?">Lean.Environment.find?</a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(n : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Lean/Declaration.html#Lean.ConstantInfo">Lean.ConstantInfo</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.Environment.find?">Lean.Environment.find?</a> <span class="fn">env</span> <span class="fn">n</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Data/SMap.html#Lean.SMap.find?'">Lean.SMap.find?'</a> <span class="fn"><span class="fn">env</span>.constants</span> <span class="fn">n</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Environment.contains"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L168-L169">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.contains">Lean.Environment.contains</a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(n : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.Environment.contains">Lean.Environment.contains</a> <span class="fn">env</span> <span class="fn">n</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Data/SMap.html#Lean.SMap.contains">Lean.SMap.contains</a> <span class="fn"><span class="fn">env</span>.constants</span> <span class="fn">n</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Environment.imports"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L171-L172">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.imports">Lean.Environment.imports</a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.Import">Lean.Import</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.Environment.imports">Lean.Environment.imports</a> <span class="fn">env</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn">env</span>.header</span>.imports</span></span></li></ul></details></div></div><div class="decl" id="Lean.Environment.allImportedModuleNames"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L174-L175">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.allImportedModuleNames">Lean.Environment.allImportedModuleNames</a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.Environment.allImportedModuleNames">Lean.Environment.allImportedModuleNames</a> <span class="fn">env</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn">env</span>.header</span>.moduleNames</span></span></li></ul></details></div></div><div class="decl" id="Lean.Environment.setMainModule"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L178-L179">source</a></div><div class="attributes">@[export lean_environment_set_main_module]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.setMainModule">Lean.Environment.setMainModule</a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(m : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Environment.mainModule"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L182-L183">source</a></div><div class="attributes">@[export lean_environment_main_module]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.mainModule">Lean.Environment.mainModule</a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.Environment.mainModule">Lean.Environment.mainModule</a> <span class="fn">env</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn">env</span>.header</span>.mainModule</span></span></li></ul></details></div></div><div class="decl" id="Lean.Environment.getModuleIdxFor?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L197-L198">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.getModuleIdxFor?">Lean.Environment.getModuleIdxFor?</a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(declName : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Lean/Environment.html#Lean.ModuleIdx">Lean.ModuleIdx</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.Environment.getModuleIdxFor?">Lean.Environment.getModuleIdxFor?</a> <span class="fn">env</span> <span class="fn">declName</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Data/HashMap.html#Lean.HashMap.find?">Lean.HashMap.find?</a> <span class="fn"><span class="fn">env</span>.const2ModIdx</span> <span class="fn">declName</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Environment.isConstructor"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L200-L203">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.isConstructor">Lean.Environment.isConstructor</a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(declName : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.Environment.isConstructor">Lean.Environment.isConstructor</a> <span class="fn">env</span> <span class="fn">declName</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn">match <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment.find?">Lean.Environment.find?</a> <span class="fn">env</span> <span class="fn">declName</span></span> with
  | <span class="fn"><a href=".././Init/Prelude.html#Option.some">some</a> (<span class="fn"><a href=".././Lean/Declaration.html#Lean.ConstantInfo.ctorInfo">Lean.ConstantInfo.ctorInfo</a> <span class="fn">val</span></span>)</span> =&gt <a href=".././Init/Prelude.html#Bool.true">true</a>
  | <span class="fn">x</span> =&gt <span class="fn">false</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Environment.getModuleIdx?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L205-L206">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.getModuleIdx?">Lean.Environment.getModuleIdx?</a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(moduleName : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Lean/Environment.html#Lean.ModuleIdx">Lean.ModuleIdx</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.Environment.getModuleIdx?">Lean.Environment.getModuleIdx?</a> <span class="fn">env</span> <span class="fn">moduleName</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Data/Array/Basic.html#Array.findIdx?">Array.findIdx?</a> <span class="fn"><span class="fn"><span class="fn">env</span>.header</span>.moduleNames</span> <span class="fn">fun <span class="fn">x</span> =&gt <span class="fn"><span class="fn">x</span> <a href=".././Init/Prelude.html#BEq.beq">==</a> <span class="fn">moduleName</span></span></span></span></span></li></ul></details></div></div><div class="decl" id="Lean.KernelException"><div class="inductive"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L211-L223">source</a></div><div class="decl_header"><span class="decl_kind">inductive</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="constructors"><li class="constructor" id="Lean.KernelException.unknownConstant">unknownConstant: <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a> → <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></span></span></li><li class="constructor" id="Lean.KernelException.alreadyDeclared">alreadyDeclared: <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a> → <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></span></span></li><li class="constructor" id="Lean.KernelException.declTypeMismatch">declTypeMismatch: <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Lean/Declaration.html#Lean.Declaration">Lean.Declaration</a> → <span class="fn"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></span></span></span></li><li class="constructor" id="Lean.KernelException.declHasMVars">declHasMVars: <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a> → <span class="fn"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></span></span></span></li><li class="constructor" id="Lean.KernelException.declHasFVars">declHasFVars: <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a> → <span class="fn"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></span></span></span></li><li class="constructor" id="Lean.KernelException.funExpected">funExpected: <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a> → <span class="fn"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></span></span></span></li><li class="constructor" id="Lean.KernelException.typeExpected">typeExpected: <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a> → <span class="fn"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></span></span></span></li><li class="constructor" id="Lean.KernelException.letTypeMismatch">letTypeMismatch: <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a> → <span class="fn"><a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a> → <span class="fn"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></span></span></span></span></li><li class="constructor" id="Lean.KernelException.exprTypeMismatch">exprTypeMismatch: <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a> → <span class="fn"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></span></span></span></li><li class="constructor" id="Lean.KernelException.appTypeMismatch">appTypeMismatch: <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a> → <span class="fn"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></span></span></span></li><li class="constructor" id="Lean.KernelException.invalidProj">invalidProj: <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a> → <span class="fn"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></span></span></span></li><li class="constructor" id="Lean.KernelException.other">other: <span class="fn"><a href=".././Init/Prelude.html#String">String</a> → <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a></span></li></ul><p>Exceptions that can be raised by the Kernel when type checking new declarations.</p><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.KernelException" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.Environment.addDecl"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L229-L229">source</a></div><div class="attributes">@[extern  lean_add_decl]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.addDecl">Lean.Environment.addDecl</a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(decl : <a href=".././Lean/Declaration.html#Lean.Declaration">Lean.Declaration</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Except">Except</a> <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a> <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></span></div></div><p>Type check given declaration and add it to the environment</p></div></div><div class="decl" id="Lean.ConstantInfo.instantiateTypeLevelParams"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L235-L236">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ConstantInfo.instantiateTypeLevelParams">Lean.ConstantInfo.instantiateTypeLevelParams</a></span><span class="decl_args">
<span class="fn">(c : <a href=".././Lean/Declaration.html#Lean.ConstantInfo">Lean.ConstantInfo</a>)</span></span>
<span class="decl_args">
<span class="fn">(ls : <span class="fn"><a href=".././Init/Prelude.html#List">List</a> <a href=".././Lean/Level.html#Lean.Level">Lean.Level</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.ConstantInfo.instantiateTypeLevelParams">Lean.ConstantInfo.instantiateTypeLevelParams</a> <span class="fn">c</span> <span class="fn">ls</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Lean/Util/InstantiateLevelParams.html#Lean.Expr.instantiateLevelParams">Lean.Expr.instantiateLevelParams</a> (<span class="fn"><a href=".././Lean/Declaration.html#Lean.ConstantInfo.type">Lean.ConstantInfo.type</a> <span class="fn">c</span></span>) (<span class="fn"><a href=".././Lean/Declaration.html#Lean.ConstantInfo.levelParams">Lean.ConstantInfo.levelParams</a> <span class="fn">c</span></span>) <span class="fn">ls</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.ConstantInfo.instantiateValueLevelParams!"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L238-L239">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ConstantInfo.instantiateValueLevelParams!">Lean.ConstantInfo.instantiateValueLevelParams!</a></span><span class="decl_args">
<span class="fn">(c : <a href=".././Lean/Declaration.html#Lean.ConstantInfo">Lean.ConstantInfo</a>)</span></span>
<span class="decl_args">
<span class="fn">(ls : <span class="fn"><a href=".././Init/Prelude.html#List">List</a> <a href=".././Lean/Level.html#Lean.Level">Lean.Level</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.ConstantInfo.instantiateValueLevelParams!">Lean.ConstantInfo.instantiateValueLevelParams!</a> <span class="fn">c</span> <span class="fn">ls</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Lean/Util/InstantiateLevelParams.html#Lean.Expr.instantiateLevelParams">Lean.Expr.instantiateLevelParams</a> (<span class="fn"><a href=".././Lean/Declaration.html#Lean.ConstantInfo.value!">Lean.ConstantInfo.value!</a> <span class="fn">c</span></span>) (<span class="fn"><a href=".././Lean/Declaration.html#Lean.ConstantInfo.levelParams">Lean.ConstantInfo.levelParams</a> <span class="fn">c</span></span>) <span class="fn">ls</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.EnvExtensionInterface"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L244-L252">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionInterface">Lean.EnvExtensionInterface</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type 1</span></div></div><ul class="structure_fields" id="Lean.EnvExtensionInterface.mk"><li id="Lean.EnvExtensionInterface.ext" class="structure_field"><div class="structure_field_info">ext : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span></div></li><li id="Lean.EnvExtensionInterface.inhabitedExt" class="structure_field"><div class="structure_field_info">inhabitedExt : <span class="fn">{<span class="fn">σ</span> : <span class="fn">Type</span>} → <span class="fn"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span> → <span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> (<span class="fn"><span class="fn">ext</span> <span class="fn">σ</span></span>)</span></span></span></div></li><li id="Lean.EnvExtensionInterface.registerExt" class="structure_field"><div class="structure_field_info">registerExt : <span class="fn">{<span class="fn">σ</span> : <span class="fn">Type</span>} → <span class="fn"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">σ</span></span> → <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> (<span class="fn"><span class="fn">ext</span> <span class="fn">σ</span></span>)</span></span></span></div></li><li id="Lean.EnvExtensionInterface.setState" class="structure_field"><div class="structure_field_info">setState : <span class="fn">{<span class="fn">σ</span> : <span class="fn">Type</span>} → <span class="fn"><span class="fn"><span class="fn">ext</span> <span class="fn">σ</span></span> → <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><span class="fn">σ</span> → <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></span></span></span></span></div></li><li id="Lean.EnvExtensionInterface.modifyState" class="structure_field"><div class="structure_field_info">modifyState : <span class="fn">{<span class="fn">σ</span> : <span class="fn">Type</span>} → <span class="fn"><span class="fn"><span class="fn">ext</span> <span class="fn">σ</span></span> → <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn">(<span class="fn"><span class="fn">σ</span> → <span class="fn">σ</span></span>) → <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></span></span></span></span></div></li><li id="Lean.EnvExtensionInterface.getState" class="structure_field"><div class="structure_field_info">getState : <span class="fn">{<span class="fn">σ</span> : <span class="fn">Type</span>} → <span class="fn">[<span class="fn">inst</span> : <span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>] → <span class="fn"><span class="fn"><span class="fn">ext</span> <span class="fn">σ</span></span> → <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn">σ</span></span></span></span></span></div></li><li id="Lean.EnvExtensionInterface.mkInitialExtStates" class="structure_field"><div class="structure_field_info">mkInitialExtStates : <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> (<span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a></span>)</span></div></li><li id="Lean.EnvExtensionInterface.ensureExtensionsSize" class="structure_field"><div class="structure_field_info">ensureExtensionsSize : <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></span></span></div></li></ul><p>Interface for managing environment extensions.</p><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.EnvExtensionInterface" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.instInhabitedEnvExtensionInterface"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L254-L264">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instInhabitedEnvExtensionInterface">Lean.instInhabitedEnvExtensionInterface</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionInterface">Lean.EnvExtensionInterface</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="mod_doc"><h1 class="markdown-heading" id="Unsafe-implementation-of-EnvExtensionInterface">Unsafe implementation of <code><a href=".././Lean/Environment.html#Lean.EnvExtensionInterface">EnvExtensionInterface</a></code> <a class="hover-link" href="#Unsafe-implementation-of-EnvExtensionInterface">#</a></h1></div><div class="decl" id="Lean.EnvExtensionInterfaceUnsafe.Ext"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L269-L272">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.Ext">Lean.EnvExtensionInterfaceUnsafe.Ext</a></span><span class="decl_args">
<span class="fn">(σ : <span class="fn">Type</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.EnvExtensionInterfaceUnsafe.Ext.mk"><li id="Lean.EnvExtensionInterfaceUnsafe.Ext.idx" class="structure_field"><div class="structure_field_info">idx : <a href=".././Init/Prelude.html#Nat">Nat</a></div></li><li id="Lean.EnvExtensionInterfaceUnsafe.Ext.mkInitial" class="structure_field"><div class="structure_field_info">mkInitial : <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">σ</span></span></div></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.EnvExtensionInterfaceUnsafe.Ext" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.EnvExtensionInterfaceUnsafe.instInhabitedExt"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L272-L272">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.instInhabitedExt">Lean.EnvExtensionInterfaceUnsafe.instInhabitedExt</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">{<span class="fn">a</span> : <span class="fn">Type</span>} → <span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> (<span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.Ext">Lean.EnvExtensionInterfaceUnsafe.Ext</a> <span class="fn">a</span></span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">Lean.EnvExtensionInterfaceUnsafe.instInhabitedExt</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">default</span> := <span class="fn">{ <span class="fn">idx</span> := <span class="fn">default</span>, <span class="fn">mkInitial</span> := <span class="fn">default</span> }</span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.EnvExtensionInterfaceUnsafe.ensureExtensionsArraySize"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L283-L293">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.ensureExtensionsArraySize">Lean.EnvExtensionInterfaceUnsafe.ensureExtensionsArraySize</a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></span></div></div><p>User-defined environment extensions are declared using the <code>initialize</code> command.
This command is just syntax sugar for the <code>init</code> attribute.
When we <code>import</code> lean modules, the vector stored at <code>envExtensionsRef</code> may increase in size because of
user-defined environment extensions. When this happens, we must adjust the size of the <code>env.extensions</code>.
This method is invoked when processing <code>import</code>s.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.ensureExtensionsArraySize">Lean.EnvExtensionInterfaceUnsafe.ensureExtensionsArraySize</a> <span class="fn">env</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.ensureExtensionsArraySize.loop">Lean.EnvExtensionInterfaceUnsafe.ensureExtensionsArraySize.loop</a> (<span class="fn"><a href=".././Init/Prelude.html#Array.size">Array.size</a> <span class="fn"><span class="fn">env</span>.extensions</span></span>) <span class="fn">env</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.EnvExtensionInterfaceUnsafe.ensureExtensionsArraySize.loop"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L286-L293">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.ensureExtensionsArraySize.loop">Lean.EnvExtensionInterfaceUnsafe.ensureExtensionsArraySize.loop</a></span><span class="decl_args">
<span class="fn">(i : <a href=".././Init/Prelude.html#Nat">Nat</a>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></span></div></div></div></div><div class="decl" id="Lean.EnvExtensionInterfaceUnsafe.setState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L297-L301">source</a></div><div class="decl_header"><span class="decl_kind">unsafe def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.setState">Lean.EnvExtensionInterfaceUnsafe.setState</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <span class="fn">Type</span>}</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.Ext">Lean.EnvExtensionInterfaceUnsafe.Ext</a> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(s : <span class="fn">σ</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.EnvExtensionInterfaceUnsafe.modifyState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L303-L311">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">unsafe def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.modifyState">Lean.EnvExtensionInterfaceUnsafe.modifyState</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <span class="fn">Type</span>}</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.Ext">Lean.EnvExtensionInterfaceUnsafe.Ext</a> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(f : <span class="fn"><span class="fn">σ</span> → <span class="fn">σ</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.EnvExtensionInterfaceUnsafe.getState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L313-L318">source</a></div><div class="decl_header"><span class="decl_kind">unsafe def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.getState">Lean.EnvExtensionInterfaceUnsafe.getState</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.Ext">Lean.EnvExtensionInterfaceUnsafe.Ext</a> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">σ</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.EnvExtensionInterfaceUnsafe.registerExt"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L320-L330">source</a></div><div class="decl_header"><span class="decl_kind">unsafe def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.registerExt">Lean.EnvExtensionInterfaceUnsafe.registerExt</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <span class="fn">Type</span>}</span></span>
</span><span class="decl_args">
<span class="fn">(mkInitial : <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> (<span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.Ext">Lean.EnvExtensionInterfaceUnsafe.Ext</a> <span class="fn">σ</span></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.EnvExtensionInterfaceUnsafe.mkInitialExtStates"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L332-L334">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.mkInitialExtStates">Lean.EnvExtensionInterfaceUnsafe.mkInitialExtStates</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> (<span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.mkInitialExtStates">Lean.EnvExtensionInterfaceUnsafe.mkInitialExtStates</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let exts ← <span class="fn"><a href=".././Init/System/ST.html#ST.Ref.get">ST.Ref.get</a> <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.EnvExtensionInterfaceUnsafe.envExtensionsRef">Lean.EnvExtensionInterfaceUnsafe.envExtensionsRef</a></span>
  <span class="fn"><a href=".././Init/Data/Array/Basic.html#Array.mapM">Array.mapM</a> (<span class="fn">fun <span class="fn">ext</span> =&gt <span class="fn"><span class="fn">ext</span>.mkInitial</span></span>) <span class="fn">exts</span></span></span></span></li></ul></details></div></div><div class="decl" id="Lean.EnvExtensionInterfaceUnsafe.imp"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L336-L345">source</a></div><div class="decl_header"><span class="decl_kind">unsafe def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceUnsafe.imp">Lean.EnvExtensionInterfaceUnsafe.imp</a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.EnvExtensionInterface">Lean.EnvExtensionInterface</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.EnvExtensionInterfaceImp"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L350-L350">source</a></div><div class="attributes">@[implemented_by Lean.EnvExtensionInterfaceUnsafe.imp]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceImp">Lean.EnvExtensionInterfaceImp</a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.EnvExtensionInterface">Lean.EnvExtensionInterface</a></div></div></div></div><div class="decl" id="Lean.EnvExtension"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L352-L352">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtension">Lean.EnvExtension</a></span><span class="decl_args">
<span class="fn">(σ : <span class="fn">Type</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension">Lean.EnvExtension</a> <span class="fn">σ</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionInterface.ext">Lean.EnvExtensionInterface.ext</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceImp">Lean.EnvExtensionInterfaceImp</a> <span class="fn">σ</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.EnvExtension.instInhabitedEnvExtension"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L358-L358">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtension.instInhabitedEnvExtension">Lean.EnvExtension.instInhabitedEnvExtension</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[s : <span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> (<span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension">Lean.EnvExtension</a> <span class="fn">σ</span></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">Lean.EnvExtension.instInhabitedEnvExtension</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionInterface.inhabitedExt">Lean.EnvExtensionInterface.inhabitedExt</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceImp">Lean.EnvExtensionInterfaceImp</a> <span class="fn">s</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.EnvExtension.setState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L359-L359">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtension.setState">Lean.EnvExtension.setState</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <span class="fn">Type</span>}</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension">Lean.EnvExtension</a> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(s : <span class="fn">σ</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension.setState">Lean.EnvExtension.setState</a> <span class="fn">ext</span> <span class="fn">env</span> <span class="fn">s</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionInterface.setState">Lean.EnvExtensionInterface.setState</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceImp">Lean.EnvExtensionInterfaceImp</a> <span class="fn">ext</span> <span class="fn">env</span> <span class="fn">s</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.EnvExtension.modifyState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L360-L360">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtension.modifyState">Lean.EnvExtension.modifyState</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <span class="fn">Type</span>}</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension">Lean.EnvExtension</a> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(f : <span class="fn"><span class="fn">σ</span> → <span class="fn">σ</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension.modifyState">Lean.EnvExtension.modifyState</a> <span class="fn">ext</span> <span class="fn">env</span> <span class="fn">f</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionInterface.modifyState">Lean.EnvExtensionInterface.modifyState</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceImp">Lean.EnvExtensionInterfaceImp</a> <span class="fn">ext</span> <span class="fn">env</span> <span class="fn">f</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.EnvExtension.getState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L361-L361">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtension.getState">Lean.EnvExtension.getState</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension">Lean.EnvExtension</a> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">σ</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension.getState">Lean.EnvExtension.getState</a> <span class="fn">ext</span> <span class="fn">env</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionInterface.getState">Lean.EnvExtensionInterface.getState</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceImp">Lean.EnvExtensionInterfaceImp</a> <span class="fn">ext</span> <span class="fn">env</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.registerEnvExtension"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L371-L371">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.registerEnvExtension">Lean.registerEnvExtension</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <span class="fn">Type</span>}</span></span>
</span><span class="decl_args">
<span class="fn">(mkInitial : <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> (<span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension">Lean.EnvExtension</a> <span class="fn">σ</span></span>)</span></div></div><p>Environment extensions can only be registered during initialization.
Reasons:
1- Our implementation assumes the number of extensions does not change after an environment object is created.
2- We do not use any synchronization primitive to access <code>envExtensionsRef</code>.</p><p>Note that by default, extension state is <em>not</em> stored in .olean files and will not propagate across <code>import</code>s.
For that, you need to register a persistent environment extension.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.registerEnvExtension">Lean.registerEnvExtension</a> <span class="fn">mkInitial</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionInterface.registerExt">Lean.EnvExtensionInterface.registerExt</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionInterfaceImp">Lean.EnvExtensionInterfaceImp</a> <span class="fn">mkInitial</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.mkEmptyEnvironment"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L375-L385">source</a></div><div class="attributes">@[export lean_mk_empty_environment]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.mkEmptyEnvironment">Lean.mkEmptyEnvironment</a></span><span class="decl_args">
<span class="fn">(trustLevel : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> <a href=".././Init/Prelude.html#UInt32">UInt32</a> <span class="fn">0</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.PersistentEnvExtensionState"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L387-L389">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.PersistentEnvExtensionState">Lean.PersistentEnvExtensionState</a></span><span class="decl_args">
<span class="fn">(α : <span class="fn">Type</span>)</span></span>
<span class="decl_args">
<span class="fn">(σ : <span class="fn">Type</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.PersistentEnvExtensionState.mk"><li id="Lean.PersistentEnvExtensionState.importedEntries" class="structure_field"><div class="structure_field_info">importedEntries : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> (<span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span></span>)</span></div></li><li id="Lean.PersistentEnvExtensionState.state" class="structure_field"><div class="structure_field_info">state : <span class="fn">σ</span></div></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.PersistentEnvExtensionState" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.ImportM.Context"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L391-L393">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ImportM.Context">Lean.ImportM.Context</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.ImportM.Context.mk"><li id="Lean.ImportM.Context.env" class="structure_field"><div class="structure_field_info">env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></li><li id="Lean.ImportM.Context.opts" class="structure_field"><div class="structure_field_info">opts : <a href=".././Lean/Data/Options.html#Lean.Options">Lean.Options</a></div></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.ImportM.Context" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.ImportM"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L395-L395">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ImportM">Lean.ImportM</a></span><span class="decl_args">
<span class="fn">(α : <span class="fn">Type</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.ImportM">Lean.ImportM</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Prelude.html#ReaderT">ReaderT</a> <a href=".././Lean/Environment.html#Lean.ImportM.Context">Lean.ImportM.Context</a> <a href=".././Init/System/IO.html#IO">IO</a></span></span></li></ul></details></div></div><div class="decl" id="Lean.PersistentEnvExtension"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L413-L419">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.PersistentEnvExtension">Lean.PersistentEnvExtension</a></span><span class="decl_args">
<span class="fn">(α : <span class="fn">Type</span>)</span></span>
<span class="decl_args">
<span class="fn">(β : <span class="fn">Type</span>)</span></span>
<span class="decl_args">
<span class="fn">(σ : <span class="fn">Type</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.PersistentEnvExtension.mk"><li id="Lean.PersistentEnvExtension.toEnvExtension" class="structure_field"><div class="structure_field_info">toEnvExtension : <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension">Lean.EnvExtension</a> (<span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtensionState">Lean.PersistentEnvExtensionState</a> <span class="fn">α</span> <span class="fn">σ</span></span>)</span></div></li><li id="Lean.PersistentEnvExtension.name" class="structure_field"><div class="structure_field_info">name : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a></div></li><li id="Lean.PersistentEnvExtension.addImportedFn" class="structure_field"><div class="structure_field_info">addImportedFn : <span class="fn"><span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> (<span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span></span>)</span> → <span class="fn"><a href=".././Lean/Environment.html#Lean.ImportM">Lean.ImportM</a> <span class="fn">σ</span></span></span></div></li><li id="Lean.PersistentEnvExtension.addEntryFn" class="structure_field"><div class="structure_field_info">addEntryFn : <span class="fn"><span class="fn">σ</span> → <span class="fn"><span class="fn">β</span> → <span class="fn">σ</span></span></span></div></li><li id="Lean.PersistentEnvExtension.exportEntriesFn" class="structure_field"><div class="structure_field_info">exportEntriesFn : <span class="fn"><span class="fn">σ</span> → <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span></span></span></div></li><li id="Lean.PersistentEnvExtension.statsFn" class="structure_field"><div class="structure_field_info">statsFn : <span class="fn"><span class="fn">σ</span> → <a href=".././Init/Data/Format/Basic.html#Std.Format">Lean.Format</a></span></div></li></ul><p>An environment extension with support for storing/retrieving entries from a .olean file.</p><ul>
<li>α is the type of the entries that are stored in .olean files.</li>
<li>β is the type of values used to update the state.</li>
<li>σ is the actual state.</li>
</ul><p>Remark: for most extensions α and β coincide.</p><p>Note that <code>addEntryFn</code> is not in <code><a href=".././Init/System/IO.html#IO">IO</a></code>. This is intentional, and allows us to write simple functions such as</p><pre><code>def addAlias (env : Environment) (a : Name) (e : Name) : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a> :=
aliasExtension.<a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.addEntry">addEntry</a> env (a, e)
</code></pre><p>without using <code><a href=".././Init/System/IO.html#IO">IO</a></code>. We have many functions like <code>addAlias</code>.</p><p><code>α</code> and ‵β` do not coincide for extensions where the data used to update the state contains, for example,
closures which we currently cannot store in files.</p><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.PersistentEnvExtension" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.instInhabitedPersistentEnvExtensionState"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L421-L422">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instInhabitedPersistentEnvExtensionState">Lean.instInhabitedPersistentEnvExtensionState</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> (<span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtensionState">Lean.PersistentEnvExtensionState</a> <span class="fn">α</span> <span class="fn">σ</span></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">Lean.instInhabitedPersistentEnvExtensionState</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">default</span> := <span class="fn">{ <span class="fn">importedEntries</span> := <span class="fn">#[]</span>, <span class="fn">state</span> := <span class="fn">default</span> }</span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.instInhabitedPersistentEnvExtension"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L424-L432">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instInhabitedPersistentEnvExtension">Lean.instInhabitedPersistentEnvExtension</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{β : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> (<span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">Lean.PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.PersistentEnvExtension.getModuleEntries"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L436-L437">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.PersistentEnvExtension.getModuleEntries">Lean.PersistentEnvExtension.getModuleEntries</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{β : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">Lean.PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(m : <a href=".././Lean/Environment.html#Lean.ModuleIdx">Lean.ModuleIdx</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.getModuleEntries">Lean.PersistentEnvExtension.getModuleEntries</a> <span class="fn">ext</span> <span class="fn">env</span> <span class="fn">m</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Init/Prelude.html#Array.get!">Array.get!</a> <span class="fn">(<span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension.getState">Lean.EnvExtension.getState</a> <span class="fn"><span class="fn">ext</span>.toEnvExtension</span> <span class="fn">env</span></span>).importedEntries</span> <span class="fn">m</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.PersistentEnvExtension.addEntry"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L439-L442">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.PersistentEnvExtension.addEntry">Lean.PersistentEnvExtension.addEntry</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{β : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <span class="fn">Type</span>}</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">Lean.PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(b : <span class="fn">β</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.PersistentEnvExtension.getState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L445-L446">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.PersistentEnvExtension.getState">Lean.PersistentEnvExtension.getState</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{β : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">Lean.PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">σ</span></div></div><p>Get the current state of the given extension in the given environment.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.getState">Lean.PersistentEnvExtension.getState</a> <span class="fn">ext</span> <span class="fn">env</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">(<span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension.getState">Lean.EnvExtension.getState</a> <span class="fn"><span class="fn">ext</span>.toEnvExtension</span> <span class="fn">env</span></span>).state</span></span></li></ul></details></div></div><div class="decl" id="Lean.PersistentEnvExtension.setState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L449-L450">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.PersistentEnvExtension.setState">Lean.PersistentEnvExtension.setState</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{β : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <span class="fn">Type</span>}</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">Lean.PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(s : <span class="fn">σ</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><p>Set the current state of the given extension in the given environment. This change is <em>not</em> persisted across files.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.setState">Lean.PersistentEnvExtension.setState</a> <span class="fn">ext</span> <span class="fn">env</span> <span class="fn">s</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension.modifyState">Lean.EnvExtension.modifyState</a> <span class="fn"><span class="fn">ext</span>.toEnvExtension</span> <span class="fn">env</span> <span class="fn">fun <span class="fn">ps</span> =&gt <span class="fn">{ <span class="fn">importedEntries</span> := <span class="fn"><span class="fn">ps</span>.importedEntries</span>, <span class="fn">state</span> := <span class="fn">s</span> }</span></span></span></span></li></ul></details></div></div><div class="decl" id="Lean.PersistentEnvExtension.modifyState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L453-L454">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.PersistentEnvExtension.modifyState">Lean.PersistentEnvExtension.modifyState</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{β : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <span class="fn">Type</span>}</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">Lean.PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(f : <span class="fn"><span class="fn">σ</span> → <span class="fn">σ</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><p>Modify the state of the given extension in the given environment by applying the given function. This change is <em>not</em> persisted across files.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.modifyState">Lean.PersistentEnvExtension.modifyState</a> <span class="fn">ext</span> <span class="fn">env</span> <span class="fn">f</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension.modifyState">Lean.EnvExtension.modifyState</a> <span class="fn"><span class="fn">ext</span>.toEnvExtension</span> <span class="fn">env</span> <span class="fn">fun <span class="fn">ps</span> =&gt
    <span class="fn">{ <span class="fn">importedEntries</span> := <span class="fn"><span class="fn">ps</span>.importedEntries</span>, <span class="fn">state</span> := <span class="fn"><span class="fn">f</span> <span class="fn"><span class="fn">ps</span>.state</span></span> }</span></span></span></span></li></ul></details></div></div><div class="decl" id="Lean.persistentEnvExtensionsRef"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L458-L458">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.persistentEnvExtensionsRef">Lean.persistentEnvExtensionsRef</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO.Ref">IO.Ref</a> (<span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> (<span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">Lean.PersistentEnvExtension</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionEntry">Lean.EnvExtensionEntry</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionEntry">Lean.EnvExtensionEntry</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a></span>)</span>)</span></div></div></div></div><div class="decl" id="Lean.PersistentEnvExtensionDescr"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L460-L466">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.PersistentEnvExtensionDescr">Lean.PersistentEnvExtensionDescr</a></span><span class="decl_args">
<span class="fn">(α : <span class="fn">Type</span>)</span></span>
<span class="decl_args">
<span class="fn">(β : <span class="fn">Type</span>)</span></span>
<span class="decl_args">
<span class="fn">(σ : <span class="fn">Type</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.PersistentEnvExtensionDescr.mk"><li id="Lean.PersistentEnvExtensionDescr.name" class="structure_field"><div class="structure_field_info">name : <span class="fn"><a href=".././Init/Meta.html#autoParam">autoParam</a> <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a> <a href=".././Lean/Environment.html#_auto._@.Lean.Environment._hyg.2724">_auto✝</a></span></div></li><li id="Lean.PersistentEnvExtensionDescr.mkInitial" class="structure_field"><div class="structure_field_info">mkInitial : <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">σ</span></span></div></li><li id="Lean.PersistentEnvExtensionDescr.addImportedFn" class="structure_field"><div class="structure_field_info">addImportedFn : <span class="fn"><span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> (<span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span></span>)</span> → <span class="fn"><a href=".././Lean/Environment.html#Lean.ImportM">Lean.ImportM</a> <span class="fn">σ</span></span></span></div></li><li id="Lean.PersistentEnvExtensionDescr.addEntryFn" class="structure_field"><div class="structure_field_info">addEntryFn : <span class="fn"><span class="fn">σ</span> → <span class="fn"><span class="fn">β</span> → <span class="fn">σ</span></span></span></div></li><li id="Lean.PersistentEnvExtensionDescr.exportEntriesFn" class="structure_field"><div class="structure_field_info">exportEntriesFn : <span class="fn"><span class="fn">σ</span> → <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span></span></span></div></li><li id="Lean.PersistentEnvExtensionDescr.statsFn" class="structure_field"><div class="structure_field_info">statsFn : <span class="fn"><span class="fn">σ</span> → <a href=".././Init/Data/Format/Basic.html#Std.Format">Lean.Format</a></span></div></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.PersistentEnvExtensionDescr" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.registerPersistentEnvExtensionUnsafe"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L468-L487">source</a></div><div class="decl_header"><span class="decl_kind">unsafe def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.registerPersistentEnvExtensionUnsafe">Lean.registerPersistentEnvExtensionUnsafe</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{β : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(descr : <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtensionDescr">Lean.PersistentEnvExtensionDescr</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> (<span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">Lean.PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.registerPersistentEnvExtension"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L490-L490">source</a></div><div class="attributes">@[implemented_by Lean.registerPersistentEnvExtensionUnsafe]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.registerPersistentEnvExtension">Lean.registerPersistentEnvExtension</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{β : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(descr : <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtensionDescr">Lean.PersistentEnvExtensionDescr</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> (<span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">Lean.PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span></span>)</span></div></div></div></div><div class="decl" id="Lean.SimplePersistentEnvExtension"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L493-L493">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension</a></span><span class="decl_args">
<span class="fn">(α : <span class="fn">Type</span>)</span></span>
<span class="decl_args">
<span class="fn">(σ : <span class="fn">Type</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><p>Simple <code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">PersistentEnvExtension</a></code> that implements <code>exportEntriesFn</code> using a list of entries.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">σ</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">Lean.PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">α</span> (<span class="fn"><span class="fn"><a href=".././Init/Prelude.html#List">List</a> <span class="fn">α</span></span> <a href=".././Init/Prelude.html#Prod">×</a> <span class="fn">σ</span></span>)</span></span></li></ul></details></div></div><div class="decl" id="Lean.mkStateFromImportedEntries"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L495-L496">source</a></div><div class="attributes">@[specialize #[]]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.mkStateFromImportedEntries">Lean.mkStateFromImportedEntries</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <span class="fn">Type</span>}</span></span>
</span><span class="decl_args">
<span class="fn">(addEntryFn : <span class="fn"><span class="fn">σ</span> → <span class="fn"><span class="fn">α</span> → <span class="fn">σ</span></span></span>)</span></span>
<span class="decl_args">
<span class="fn">(initState : <span class="fn">σ</span>)</span></span>
<span class="decl_args">
<span class="fn">(as : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> (<span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span></span>)</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">σ</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.mkStateFromImportedEntries">Lean.mkStateFromImportedEntries</a> <span class="fn">addEntryFn</span> <span class="fn">initState</span> <span class="fn">as</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Init/Data/Array/Basic.html#Array.foldl">Array.foldl</a> (<span class="fn">fun <span class="fn">r</span> <span class="fn">es</span> =&gt <span class="fn"><a href=".././Init/Data/Array/Basic.html#Array.foldl">Array.foldl</a> (<span class="fn">fun <span class="fn">r</span> <span class="fn">e</span> =&gt <span class="fn"><span class="fn">addEntryFn</span> <span class="fn">r</span> <span class="fn">e</span></span></span>) <span class="fn">r</span> <span class="fn">es</span> <span class="fn">0</span> (<span class="fn"><a href=".././Init/Prelude.html#Array.size">Array.size</a> <span class="fn">es</span></span>)</span></span>) <span class="fn">initState</span> <span class="fn">as</span> <span class="fn">0</span>
    (<span class="fn"><a href=".././Init/Prelude.html#Array.size">Array.size</a> <span class="fn">as</span></span>)</span></span></li></ul></details></div></div><div class="decl" id="Lean.SimplePersistentEnvExtensionDescr"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L498-L502">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtensionDescr">Lean.SimplePersistentEnvExtensionDescr</a></span><span class="decl_args">
<span class="fn">(α : <span class="fn">Type</span>)</span></span>
<span class="decl_args">
<span class="fn">(σ : <span class="fn">Type</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.SimplePersistentEnvExtensionDescr.mk"><li id="Lean.SimplePersistentEnvExtensionDescr.name" class="structure_field"><div class="structure_field_info">name : <span class="fn"><a href=".././Init/Meta.html#autoParam">autoParam</a> <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a> <a href=".././Lean/Environment.html#_auto._@.Lean.Environment._hyg.3199">_auto✝</a></span></div></li><li id="Lean.SimplePersistentEnvExtensionDescr.addEntryFn" class="structure_field"><div class="structure_field_info">addEntryFn : <span class="fn"><span class="fn">σ</span> → <span class="fn"><span class="fn">α</span> → <span class="fn">σ</span></span></span></div></li><li id="Lean.SimplePersistentEnvExtensionDescr.addImportedFn" class="structure_field"><div class="structure_field_info">addImportedFn : <span class="fn"><span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> (<span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span></span>)</span> → <span class="fn">σ</span></span></div></li><li id="Lean.SimplePersistentEnvExtensionDescr.toArrayFn" class="structure_field"><div class="structure_field_info">toArrayFn : <span class="fn"><span class="fn"><a href=".././Init/Prelude.html#List">List</a> <span class="fn">α</span></span> → <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span></span></span></div></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.SimplePersistentEnvExtensionDescr" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.registerSimplePersistentEnvExtension"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L504-L513">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.registerSimplePersistentEnvExtension">Lean.registerSimplePersistentEnvExtension</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(descr : <span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtensionDescr">Lean.SimplePersistentEnvExtensionDescr</a> <span class="fn">α</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> (<span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">σ</span></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.SimplePersistentEnvExtension.instInhabitedSimplePersistentEnvExtension"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L517-L518">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension.instInhabitedSimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension.instInhabitedSimplePersistentEnvExtension</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> (<span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">σ</span></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">Lean.SimplePersistentEnvExtension.instInhabitedSimplePersistentEnvExtension</span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Init/Prelude.html#inferInstanceAs">inferInstanceAs</a> (<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> (<span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">Lean.PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">α</span> (<span class="fn"><span class="fn"><a href=".././Init/Prelude.html#List">List</a> <span class="fn">α</span></span> <a href=".././Init/Prelude.html#Prod">×</a> <span class="fn">σ</span></span>)</span>)</span>)</span></span></li></ul></details></div></div><div class="decl" id="Lean.SimplePersistentEnvExtension.getEntries"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L522-L523">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension.getEntries">Lean.SimplePersistentEnvExtension.getEntries</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#List">List</a> <span class="fn">α</span></span></div></div><p>Get the list of values used to update the state of the given
<code><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">SimplePersistentEnvExtension</a></code> in the current file.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension.getEntries">Lean.SimplePersistentEnvExtension.getEntries</a> <span class="fn">ext</span> <span class="fn">env</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">(<span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.getState">Lean.PersistentEnvExtension.getState</a> <span class="fn">ext</span> <span class="fn">env</span></span>).fst</span></span></li></ul></details></div></div><div class="decl" id="Lean.SimplePersistentEnvExtension.getState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L526-L527">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension.getState">Lean.SimplePersistentEnvExtension.getState</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">σ</span></div></div><p>Get the current state of the given <code><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">SimplePersistentEnvExtension</a></code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension.getState">Lean.SimplePersistentEnvExtension.getState</a> <span class="fn">ext</span> <span class="fn">env</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">(<span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.getState">Lean.PersistentEnvExtension.getState</a> <span class="fn">ext</span> <span class="fn">env</span></span>).snd</span></span></li></ul></details></div></div><div class="decl" id="Lean.SimplePersistentEnvExtension.setState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L530-L531">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension.setState">Lean.SimplePersistentEnvExtension.setState</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <span class="fn">Type</span>}</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(s : <span class="fn">σ</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><p>Set the current state of the given <code><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">SimplePersistentEnvExtension</a></code>. This change is <em>not</em> persisted across files.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension.setState">Lean.SimplePersistentEnvExtension.setState</a> <span class="fn">ext</span> <span class="fn">env</span> <span class="fn">s</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.modifyState">Lean.PersistentEnvExtension.modifyState</a> <span class="fn">ext</span> <span class="fn">env</span> <span class="fn">fun <span class="fn">x</span> =&gt
    <span class="fn">match <span class="fn">x</span> with
    | <span class="fn">(<span class="fn">entries</span>, <span class="fn">snd</span>)</span> =&gt <span class="fn">(<span class="fn">entries</span>, <span class="fn">s</span>)</span></span></span></span></span></li></ul></details></div></div><div class="decl" id="Lean.SimplePersistentEnvExtension.modifyState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L534-L535">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension.modifyState">Lean.SimplePersistentEnvExtension.modifyState</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{σ : <span class="fn">Type</span>}</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(f : <span class="fn"><span class="fn">σ</span> → <span class="fn">σ</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><p>Modify the state of the given extension in the given environment by applying the given function. This change is <em>not</em> persisted across files.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension.modifyState">Lean.SimplePersistentEnvExtension.modifyState</a> <span class="fn">ext</span> <span class="fn">env</span> <span class="fn">f</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.modifyState">Lean.PersistentEnvExtension.modifyState</a> <span class="fn">ext</span> <span class="fn">env</span> <span class="fn">fun <span class="fn">x</span> =&gt
    <span class="fn">match <span class="fn">x</span> with
    | <span class="fn">(<span class="fn">entries</span>, <span class="fn">s</span>)</span> =&gt <span class="fn">(<span class="fn">entries</span>, <span class="fn"><span class="fn">f</span> <span class="fn">s</span></span>)</span></span></span></span></span></li></ul></details></div></div><div class="decl" id="Lean.TagDeclarationExtension"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L541-L541">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.TagDeclarationExtension">Lean.TagDeclarationExtension</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><p>Environment extension for tagging declarations.
Declarations must only be tagged in the module where they were declared.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.TagDeclarationExtension">Lean.TagDeclarationExtension</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension</a> <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a> <a href=".././Lean/Data/NameMap.html#Lean.NameSet">Lean.NameSet</a></span></span></li></ul></details></div></div><div class="decl" id="Lean.mkTagDeclarationExtension"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L543-L549">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.mkTagDeclarationExtension">Lean.mkTagDeclarationExtension</a></span><span class="decl_args">
<span class="fn">(name : <span class="fn"><a href=".././Init/Meta.html#autoParam">autoParam</a> <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a> <a href=".././Lean/Environment.html#_auto._@.Lean.Environment._hyg.3561">_auto✝</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Lean/Environment.html#Lean.TagDeclarationExtension">Lean.TagDeclarationExtension</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.TagDeclarationExtension.instInhabitedTagDeclarationExtension"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L553-L554">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.TagDeclarationExtension.instInhabitedTagDeclarationExtension">Lean.TagDeclarationExtension.instInhabitedTagDeclarationExtension</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/Environment.html#Lean.TagDeclarationExtension">Lean.TagDeclarationExtension</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.TagDeclarationExtension.instInhabitedTagDeclarationExtension">Lean.TagDeclarationExtension.instInhabitedTagDeclarationExtension</a> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Init/Prelude.html#inferInstanceAs">inferInstanceAs</a> (<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> (<span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension</a> <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a> <a href=".././Lean/Data/NameMap.html#Lean.NameSet">Lean.NameSet</a></span>)</span>)</span></span></li></ul></details></div></div><div class="decl" id="Lean.TagDeclarationExtension.tag"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L556-L558">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.TagDeclarationExtension.tag">Lean.TagDeclarationExtension.tag</a></span><span class="decl_args">
<span class="fn">(ext : <a href=".././Lean/Environment.html#Lean.TagDeclarationExtension">Lean.TagDeclarationExtension</a>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(declName : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.TagDeclarationExtension.isTagged"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L560-L563">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.TagDeclarationExtension.isTagged">Lean.TagDeclarationExtension.isTagged</a></span><span class="decl_args">
<span class="fn">(ext : <a href=".././Lean/Environment.html#Lean.TagDeclarationExtension">Lean.TagDeclarationExtension</a>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(declName : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MapDeclarationExtension"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L570-L570">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.MapDeclarationExtension">Lean.MapDeclarationExtension</a></span><span class="decl_args">
<span class="fn">(α : <span class="fn">Type</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><p>Environment extension for mapping declarations to values.
Declarations must only be inserted into the mapping in the module where they were declared.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.MapDeclarationExtension">Lean.MapDeclarationExtension</a> <span class="fn">α</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension</a> (<span class="fn"><a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a> <a href=".././Init/Prelude.html#Prod">×</a> <span class="fn">α</span></span>) (<span class="fn"><a href=".././Lean/Data/NameMap.html#Lean.NameMap">Lean.NameMap</a> <span class="fn">α</span></span>)</span></span></li></ul></details></div></div><div class="decl" id="Lean.mkMapDeclarationExtension"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L572-L578">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.mkMapDeclarationExtension">Lean.mkMapDeclarationExtension</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">α</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(name : <span class="fn"><a href=".././Init/Meta.html#autoParam">autoParam</a> <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a> <a href=".././Lean/Environment.html#_auto._@.Lean.Environment._hyg.3808">_auto✝</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> (<span class="fn"><a href=".././Lean/Environment.html#Lean.MapDeclarationExtension">Lean.MapDeclarationExtension</a> <span class="fn">α</span></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MapDeclarationExtension.instInhabitedMapDeclarationExtension"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L582-L583">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.MapDeclarationExtension.instInhabitedMapDeclarationExtension">Lean.MapDeclarationExtension.instInhabitedMapDeclarationExtension</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> (<span class="fn"><a href=".././Lean/Environment.html#Lean.MapDeclarationExtension">Lean.MapDeclarationExtension</a> <span class="fn">α</span></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">Lean.MapDeclarationExtension.instInhabitedMapDeclarationExtension</span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Init/Prelude.html#inferInstanceAs">inferInstanceAs</a> (<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> (<span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension</a> (<span class="fn"><a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a> <a href=".././Init/Prelude.html#Prod">×</a> <span class="fn">α</span></span>) (<span class="fn"><a href=".././Lean/Data/NameMap.html#Lean.NameMap">Lean.NameMap</a> <span class="fn">α</span></span>)</span>)</span>)</span></span></li></ul></details></div></div><div class="decl" id="Lean.MapDeclarationExtension.insert"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L585-L587">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.MapDeclarationExtension.insert">Lean.MapDeclarationExtension.insert</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.MapDeclarationExtension">Lean.MapDeclarationExtension</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(declName : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a>)</span></span>
<span class="decl_args">
<span class="fn">(val : <span class="fn">α</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MapDeclarationExtension.find?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L589-L595">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.MapDeclarationExtension.find?">Lean.MapDeclarationExtension.find?</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">α</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.MapDeclarationExtension">Lean.MapDeclarationExtension</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(declName : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <span class="fn">α</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MapDeclarationExtension.contains"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L597-L600">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.MapDeclarationExtension.contains">Lean.MapDeclarationExtension.contains</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">α</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(ext : <span class="fn"><a href=".././Lean/Environment.html#Lean.MapDeclarationExtension">Lean.MapDeclarationExtension</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(declName : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.saveModuleData"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L605-L605">source</a></div><div class="attributes">@[extern  lean_save_module_data]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.saveModuleData">Lean.saveModuleData</a></span><span class="decl_args">
<span class="fn">(fname : <a href=".././Init/System/FilePath.html#System.FilePath">System.FilePath</a>)</span></span>
<span class="decl_args">
<span class="fn">(mod : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a>)</span></span>
<span class="decl_args">
<span class="fn">(data : <a href=".././Lean/Environment.html#Lean.ModuleData">Lean.ModuleData</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div></div></div><div class="decl" id="Lean.readModuleData"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L607-L607">source</a></div><div class="attributes">@[extern  lean_read_module_data]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.readModuleData">Lean.readModuleData</a></span><span class="decl_args">
<span class="fn">(fname : <a href=".././Init/System/FilePath.html#System.FilePath">System.FilePath</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> (<span class="fn"><a href=".././Lean/Environment.html#Lean.ModuleData">Lean.ModuleData</a> <a href=".././Init/Prelude.html#Prod">×</a> <a href=".././Lean/Environment.html#Lean.CompactedRegion">Lean.CompactedRegion</a></span>)</span></div></div></div></div><div class="decl" id="Lean.Environment.freeRegions"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L613-L629">source</a></div><div class="attributes">@[noinline, export lean_environment_free_regions]</div>
<div class="decl_header"><span class="decl_kind">unsafe def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.freeRegions">Lean.Environment.freeRegions</a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Free compacted regions of imports. No live references to imported objects may exist at the time of invocation; in
particular, <code>env</code> should be the last reference to any <code><a href=".././Lean/Environment.html#Lean.Environment">Environment</a></code> derived from these imports.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.Environment.freeRegions">Lean.Environment.freeRegions</a> <span class="fn">env</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Init/Data/Array/Basic.html#Array.forM">Array.forM</a> <a href=".././Lean/Environment.html#Lean.CompactedRegion.free">Lean.CompactedRegion.free</a> <span class="fn"><span class="fn"><span class="fn">env</span>.header</span>.regions</span> <span class="fn">0</span> (<span class="fn"><a href=".././Init/Prelude.html#Array.size">Array.size</a> <span class="fn"><span class="fn"><span class="fn">env</span>.header</span>.regions</span></span>)</span></span></li></ul></details></div></div><div class="decl" id="Lean.mkModuleData"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L631-L642">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.mkModuleData">Lean.mkModuleData</a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Lean/Environment.html#Lean.ModuleData">Lean.ModuleData</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.writeModule"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L645-L646">source</a></div><div class="attributes">@[export lean_write_module]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.writeModule">Lean.writeModule</a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(fname : <a href=".././Init/System/FilePath.html#System.FilePath">System.FilePath</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.writeModule">Lean.writeModule</a> <span class="fn">env</span> <span class="fn">fname</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let __do_lift ← <span class="fn"><a href=".././Lean/Environment.html#Lean.mkModuleData">Lean.mkModuleData</a> <span class="fn">env</span></span>
  <span class="fn"><a href=".././Lean/Environment.html#Lean.saveModuleData">Lean.saveModuleData</a> <span class="fn">fname</span> (<span class="fn"><a href=".././Lean/Environment.html#Lean.Environment.mainModule">Lean.Environment.mainModule</a> <span class="fn">env</span></span>) <span class="fn">__do_lift</span></span></span></span></li></ul></details></div></div><div class="decl" id="Lean.updateEnvAttributes"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L686-L686">source</a></div><div class="attributes">@[extern 2 lean_update_env_attributes]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.updateEnvAttributes">Lean.updateEnvAttributes</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></span></span></div></div><p>"Forward declaration" needed for updating the attribute table with user-defined attributes.
User-defined attributes are declared using the <code>initialize</code> command. The <code>initialize</code> command is just syntax sugar for the <code>init</code> attribute.
The <code>init</code> attribute is initialized after the <code>attributeExtension</code> is initialized. We cannot change the order since the <code>init</code> attribute is an attribute,
and requires this extension.
The <code>attributeExtension</code> initializer uses <code>attributeMapRef</code> to initialize the attribute mapping.
When we a new user-defined attribute declaration is imported, <code>attributeMapRef</code> is updated.
Later, we set this method with code that adds the user-defined attributes that were imported after we initialized <code>attributeExtension</code>.</p></div></div><div class="decl" id="Lean.getNumBuiltiAttributes"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L688-L688">source</a></div><div class="attributes">@[extern 1 lean_get_num_attributes]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.getNumBuiltiAttributes">Lean.getNumBuiltiAttributes</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Nat">Nat</a></span></div></div><p>"Forward declaration" for retrieving the number of builtin attributes.</p></div></div><div class="decl" id="Lean.ImportState"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L715-L719">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ImportState">Lean.ImportState</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.ImportState.mk"><li id="Lean.ImportState.moduleNameSet" class="structure_field"><div class="structure_field_info">moduleNameSet : <a href=".././Lean/Data/NameMap.html#Lean.NameHashSet">Lean.NameHashSet</a></div></li><li id="Lean.ImportState.moduleNames" class="structure_field"><div class="structure_field_info">moduleNames : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a></span></div></li><li id="Lean.ImportState.moduleData" class="structure_field"><div class="structure_field_info">moduleData : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.ModuleData">Lean.ModuleData</a></span></div></li><li id="Lean.ImportState.regions" class="structure_field"><div class="structure_field_info">regions : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.CompactedRegion">Lean.CompactedRegion</a></span></div></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.ImportState" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.throwAlreadyImported"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L721-L724">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.throwAlreadyImported">Lean.throwAlreadyImported</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="decl_args">
<span class="fn">(s : <a href=".././Lean/Environment.html#Lean.ImportState">Lean.ImportState</a>)</span></span>
<span class="decl_args">
<span class="fn">(const2ModIdx : <span class="fn"><a href=".././Lean/Data/HashMap.html#Lean.HashMap">Lean.HashMap</a> <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a> <a href=".././Lean/Environment.html#Lean.ModuleIdx">Lean.ModuleIdx</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(modIdx : <a href=".././Init/Prelude.html#Nat">Nat</a>)</span></span>
<span class="decl_args">
<span class="fn">(cname : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">α</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.importModules"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L727-L787">source</a></div><div class="attributes">@[export lean_import_modules]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.importModules">Lean.importModules</a></span><span class="decl_args">
<span class="fn">(imports : <span class="fn"><a href=".././Init/Prelude.html#List">List</a> <a href=".././Lean/Environment.html#Lean.Import">Lean.Import</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(opts : <a href=".././Lean/Data/Options.html#Lean.Options">Lean.Options</a>)</span></span>
<span class="decl_args">
<span class="fn">(trustLevel : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> <a href=".././Init/Prelude.html#UInt32">UInt32</a> <span class="fn">0</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.importModules.importMods"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L770-L787">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.importModules.importMods">Lean.importModules.importMods</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn"><a href=".././Init/Prelude.html#List">List</a> <a href=".././Lean/Environment.html#Lean.Import">Lean.Import</a></span> → <span class="fn"><a href=".././Init/Control/StateRef.html#StateRefT'">StateRefT'</a> <a href=".././Init/System/IO.html#IO.RealWorld">IO.RealWorld</a> <a href=".././Lean/Environment.html#Lean.ImportState">Lean.ImportState</a> <a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></span></div></div></div></div><div class="decl" id="Lean.withImportModules"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L792-L794">source</a></div><div class="decl_header"><span class="decl_kind">unsafe def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.withImportModules">Lean.withImportModules</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="decl_args">
<span class="fn">(imports : <span class="fn"><a href=".././Init/Prelude.html#List">List</a> <a href=".././Lean/Environment.html#Lean.Import">Lean.Import</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(opts : <a href=".././Lean/Data/Options.html#Lean.Options">Lean.Options</a>)</span></span>
<span class="decl_args">
<span class="fn">(trustLevel : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> <a href=".././Init/Prelude.html#UInt32">UInt32</a> <span class="fn">0</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(x : <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">α</span></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">α</span></span></div></div><p>Create environment object from imports and free compacted regions after calling <code>act</code>. No live references to the
environment object or imported objects may exist after <code>act</code> finishes.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.withImportModules">Lean.withImportModules</a> <span class="fn">imports</span> <span class="fn">opts</span> <span class="fn">trustLevel</span> <span class="fn">x</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let env ← <span class="fn"><a href=".././Lean/Environment.html#Lean.importModules">Lean.importModules</a> <span class="fn">imports</span> <span class="fn">opts</span> <span class="fn">trustLevel</span></span>
  <span class="fn"><a href=".././Init/Control/Except.html#tryFinally">tryFinally</a> (<span class="fn"><span class="fn">x</span> <span class="fn">env</span></span>) (<span class="fn"><a href=".././Lean/Environment.html#Lean.Environment.freeRegions">Lean.Environment.freeRegions</a> <span class="fn">env</span></span>)</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.namespacesExt"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L796-L812">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.namespacesExt">Lean.namespacesExt</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension">Lean.SimplePersistentEnvExtension</a> <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a> <a href=".././Lean/Data/NameMap.html#Lean.NameSSet">Lean.NameSSet</a></span></div></div><p>Environment extension for tracking all <code>namespace</code> declared by users.</p></div></div><div class="decl" id="Lean.Environment.registerNamespace"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L817-L818">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.registerNamespace">Lean.Environment.registerNamespace</a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(n : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><p>Register a new namespace in the environment.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Environment.isNamespace"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L821-L822">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.isNamespace">Lean.Environment.isNamespace</a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(n : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><p>Return <code>true</code> if <code>n</code> is the name of a namespace in <code>env</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.Environment.isNamespace">Lean.Environment.isNamespace</a> <span class="fn">env</span> <span class="fn">n</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Lean/Data/NameMap.html#Lean.NameSSet.contains">Lean.NameSSet.contains</a> (<span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension.getState">Lean.SimplePersistentEnvExtension.getState</a> <a href=".././Lean/Environment.html#Lean.namespacesExt">Lean.namespacesExt</a> <span class="fn">env</span></span>) <span class="fn">n</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Environment.getNamespaceSet"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L825-L826">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.getNamespaceSet">Lean.Environment.getNamespaceSet</a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Data/NameMap.html#Lean.NameSSet">Lean.NameSSet</a></div></div><p>Return a set containing all namespaces in <code>env</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.Environment.getNamespaceSet">Lean.Environment.getNamespaceSet</a> <span class="fn">env</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Environment.html#Lean.SimplePersistentEnvExtension.getState">Lean.SimplePersistentEnvExtension.getState</a> <a href=".././Lean/Environment.html#Lean.namespacesExt">Lean.namespacesExt</a> <span class="fn">env</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Environment.add"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L838-L840">source</a></div><div class="attributes">@[export lean_environment_add]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.add">Lean.Environment.add</a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(cinfo : <a href=".././Lean/Declaration.html#Lean.ConstantInfo">Lean.ConstantInfo</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.Environment.add">Lean.Environment.add</a> <span class="fn">env</span> <span class="fn">cinfo</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn">let env := <span class="fn"><a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.Environment.registerNamePrefixes">Lean.Environment.registerNamePrefixes</a> <span class="fn">env</span> (<span class="fn"><a href=".././Lean/Declaration.html#Lean.ConstantInfo.name">Lean.ConstantInfo.name</a> <span class="fn">cinfo</span></span>)</span>;
  <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment.addAux">Lean.Environment.addAux</a> <span class="fn">env</span> <span class="fn">cinfo</span></span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Environment.displayStats"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L843-L859">source</a></div><div class="attributes">@[export lean_display_stats]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.displayStats">Lean.Environment.displayStats</a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Environment.evalConst"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L866-L866">source</a></div><div class="attributes">@[extern  lean_eval_const]</div>
<div class="decl_header"><span class="decl_kind">unsafe opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.evalConst">Lean.Environment.evalConst</a></span><span class="decl_args">
<span class="fn">(α : <span class="fn">Type u_1</span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(opts : <a href=".././Lean/Data/Options.html#Lean.Options">Lean.Options</a>)</span></span>
<span class="decl_args">
<span class="fn">(constName : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Except">Except</a> <a href=".././Init/Prelude.html#String">String</a> <span class="fn">α</span></span></div></div><p>Evaluate the given declaration under the given environment to a value of the given type.
This function is only safe to use if the type matches the declaration's type in the environment
and if <code>enableInitializersExecution</code> has been used before importing any modules.</p></div></div><div class="decl" id="Lean.Environment.evalConstCheck"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L873-L881">source</a></div><div class="decl_header"><span class="decl_kind">unsafe def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.evalConstCheck">Lean.Environment.evalConstCheck</a></span><span class="decl_args">
<span class="fn">(α : <span class="fn">Type</span>)</span></span>
<span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(opts : <a href=".././Lean/Data/Options.html#Lean.Options">Lean.Options</a>)</span></span>
<span class="decl_args">
<span class="fn">(typeName : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a>)</span></span>
<span class="decl_args">
<span class="fn">(constName : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Control/Except.html#ExceptT">ExceptT</a> <a href=".././Init/Prelude.html#String">String</a> <a href=".././Init/Control/Id.html#Id">Id</a> <span class="fn">α</span></span></div></div><p>Like <code><a href=".././Lean/Environment.html#Lean.Environment.evalConst">evalConst</a></code>, but first check that <code>constName</code> indeed is a declaration of type <code>typeName</code>.
Note that this function cannot guarantee that <code>typeName</code> is in fact the name of the type <code>α</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Environment.hasUnsafe"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L883-L890">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.hasUnsafe">Lean.Environment.hasUnsafe</a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(e : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="mod_doc"><h1 class="markdown-heading" id="Kernel-API">Kernel API <a class="hover-link" href="#Kernel-API">#</a></h1></div><div class="decl" id="Lean.Kernel.isDefEq"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L902-L902">source</a></div><div class="attributes">@[extern  lean_kernel_is_def_eq]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.isDefEq">Lean.Kernel.isDefEq</a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(lctx : <a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(a : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(b : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Except">Except</a> <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><p>Kernel isDefEq predicate. We use it mainly for debugging purposes.
Recall that the Kernel type checker does not support metavariables.
When implementing automation, consider using the <code>MetaM</code> methods.</p></div></div><div class="decl" id="Lean.Kernel.isDefEqGuarded"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L904-L905">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.isDefEqGuarded">Lean.Kernel.isDefEqGuarded</a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(lctx : <a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(a : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(b : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.Kernel.isDefEqGuarded">Lean.Kernel.isDefEqGuarded</a> <span class="fn">env</span> <span class="fn">lctx</span> <span class="fn">a</span> <span class="fn">b</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn">match <span class="fn"><a href=".././Lean/Environment.html#Lean.Kernel.isDefEq">Lean.Kernel.isDefEq</a> <span class="fn">env</span> <span class="fn">lctx</span> <span class="fn">a</span> <span class="fn">b</span></span> with
  | <span class="fn"><a href=".././Init/Prelude.html#Except.ok">Except.ok</a> <span class="fn">result</span></span> =&gt <span class="fn">result</span>
  | <span class="fn">x</span> =&gt <span class="fn">false</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Kernel.whnf"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L912-L912">source</a></div><div class="attributes">@[extern  lean_kernel_whnf]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.whnf">Lean.Kernel.whnf</a></span><span class="decl_args">
<span class="fn">(env : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(lctx : <a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(a : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Except">Except</a> <a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></div></div><p>Kernel WHNF function. We use it mainly for debugging purposes.
Recall that the Kernel type checker does not support metavariables.
When implementing automation, consider using the <code>MetaM</code> methods.</p></div></div><div class="decl" id="Lean.MonadEnv"><div class="class"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L916-L918">source</a></div><div class="decl_header"><span class="decl_kind">class</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.MonadEnv">Lean.MonadEnv</a></span><span class="decl_args">
<span class="fn">(m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.MonadEnv.mk"><li id="Lean.MonadEnv.getEnv" class="structure_field"><div class="structure_field_info">getEnv : <span class="fn"><span class="fn">m</span> <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></span></div></li><li id="Lean.MonadEnv.modifyEnv" class="structure_field"><div class="structure_field_info">modifyEnv : <span class="fn">(<span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></span>) → <span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Unit">Unit</a></span></span></div></li></ul><details class="instances"><summary>Instances</summary><ul id="instances-list-Lean.MonadEnv" class="instances-list"></ul></details></div></div><div class="decl" id="Lean.instMonadEnv"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/Environment.lean#L923-L925">source</a></div><div class="attributes">@[always_inline]</div>
<div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instMonadEnv">Lean.instMonadEnv</a></span><span class="decl_args">
<span class="fn">(m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(n : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>)</span></span>
<span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#MonadLift">MonadLift</a> <span class="fn">m</span> <span class="fn">n</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/Environment.html#Lean.MonadEnv">Lean.MonadEnv</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Environment.html#Lean.MonadEnv">Lean.MonadEnv</a> <span class="fn">n</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/Environment.html#Lean.instMonadEnv">Lean.instMonadEnv</a> <span class="fn">m</span> <span class="fn">n</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">getEnv</span> := <span class="fn"><a href=".././Init/Prelude.html#liftM">liftM</a> <span class="fn">Lean.getEnv</span></span>, <span class="fn">modifyEnv</span> := <span class="fn">fun <span class="fn">f</span> =&gt <span class="fn"><a href=".././Init/Prelude.html#liftM">liftM</a> (<span class="fn"><a href=".././Lean/Environment.html#Lean.MonadEnv.modifyEnv">Lean.modifyEnv</a> <span class="fn">f</span></span>)</span></span> }</span></span></li></ul></details></div></div></main>
<nav class="nav"><iframe src=".././/navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>