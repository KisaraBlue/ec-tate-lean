<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href=".././style.css"></link><link rel="stylesheet" href=".././src/pygments.css"></link><link rel="shortcut icon" href=".././favicon.ico"></link><link rel="prefetch" href=".././/declarations/declaration-data.bmp" as="image"></link><title>Lean.ImportingFlag</title><script defer="true" src=".././mathjax-config.js"></script><script defer="true" src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT=".././";</script><script>const MODULE_NAME="Lean.ImportingFlag";</script><script type="module" src=".././nav.js"></script><script type="module" src=".././search.js"></script><script type="module" src=".././how-about.js"></script><script type="module" src=".././instances.js"></script><script type="module" src=".././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label>Documentation</h1><p class="header_filename break_within">Lean.ImportingFlag</p><form action="https://google.com/search" method="get" id="search_form"><input type="hidden" name="sitesearch" value="https://leanprover-community.github.io/mathlib_docs"></input><input type="text" name="q" autocomplete="off"></input><button>Google site search</button></form></header><nav class="internal_nav"><h3><a class="break_within" href="#top">Lean.ImportingFlag</a></h3><p class="gh_nav_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/ImportingFlag.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href=".././Init.html">Init</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Lean.ImportingFlag" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Lean.enableInitializersExecution">Lean.enableInitializersExecution</a></div><div class="nav_link"><a class="break_within" href="#Lean.isInitializerExecutionEnabled">Lean.isInitializerExecutionEnabled</a></div><div class="nav_link"><a class="break_within" href="#Lean.initializing">Lean.initializing</a></div><div class="nav_link"><a class="break_within" href="#Lean.withImporting">Lean.withImporting</a></div></nav><main>
<div class="decl" id="Lean.enableInitializersExecution"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/ImportingFlag.lean#L23-L24">source</a></div><div class="attributes">@[export lean_enable_initializer_execution]</div>
<div class="decl_header"><span class="decl_kind">unsafe def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/ImportingFlag.html#Lean.enableInitializersExecution">Lean.enableInitializersExecution</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><p>By default the <code>initialize</code> code is not executed when importing .olean files.
When this flag is set to <code>true</code>, the initializers are executed.
This method is meant to be used by the Lean frontend only.
Remark: it is not safe to run <code>initialize</code> code when using multiple threads.
Remark: Any loaded native Lean code must match its imported version. In particular,
no two versions of the same module may be loaded when this flag is set.
No native code may be loaded after its module has been imported.
Remark: The Lean frontend executes this method at startup time.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/ImportingFlag.html#Lean.enableInitializersExecution">Lean.enableInitializersExecution</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/System/ST.html#ST.Ref.set">ST.Ref.set</a> <a href=".././Lean/ImportingFlag.html#_private.Lean.ImportingFlag.0.Lean.runInitializersRef">Lean.runInitializersRef</a> <a href=".././Init/Prelude.html#Bool.true">true</a></span></span></li></ul></details></div></div><div class="decl" id="Lean.isInitializerExecutionEnabled"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/ImportingFlag.lean#L26-L27">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/ImportingFlag.html#Lean.isInitializerExecutionEnabled">Lean.isInitializerExecutionEnabled</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/ImportingFlag.html#Lean.isInitializerExecutionEnabled">Lean.isInitializerExecutionEnabled</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/System/ST.html#ST.Ref.get">ST.Ref.get</a> <a href=".././Lean/ImportingFlag.html#_private.Lean.ImportingFlag.0.Lean.runInitializersRef">Lean.runInitializersRef</a></span></span></li></ul></details></div></div><div class="decl" id="Lean.initializing"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/ImportingFlag.lean#L33-L34">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/ImportingFlag.html#Lean.initializing">Lean.initializing</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><p>We say Lean is "initializing" when it is executing <code>builtin_initialize</code> declarations or importing modules.
Recall that Lean executes <code>initialize</code> declarations while importing modules.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/ImportingFlag.html#Lean.initializing">Lean.initializing</a> <a href=".././Init/Prelude.html#Eq">=</a> (<span class="fn"><span class="fn"><a href=".././Init/Prelude.html#liftM">liftM</a> <a href=".././Init/System/IO.html#IO.initializing">IO.initializing</a></span> <a href=".././Init/Control/Basic.html#orM">&lt||&gt</a> <span class="fn"><a href=".././Init/System/ST.html#ST.Ref.get">ST.Ref.get</a> <a href=".././Lean/ImportingFlag.html#_private.Lean.ImportingFlag.0.Lean.importingRef">Lean.importingRef</a></span></span>)</span></li></ul></details></div></div><div class="decl" id="Lean.withImporting"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/ImportingFlag.lean#L46-L52">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/ImportingFlag.html#Lean.withImporting">Lean.withImporting</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="decl_args">
<span class="fn">(x : <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">α</span></span></div></div><p>Execute <code>x</code> with "importing" flag turned on.
When the "importing" flag is set to true, we allow user-extensions defined with with
the <code>initialize</code> command to update global references.
IMPORTANT: There is no semaphore controlling the access to these global references.
We assume these global references are updated by a single execution thread.
This is true in the Lean frontend where we process the <code>import</code> commands at the beginning
of the execution only. Users must make sure that <code>importModules</code> is used, there is only
one execution thread accessing the global references.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/ImportingFlag.html#Lean.withImporting">Lean.withImporting</a> <span class="fn">x</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Init/Control/Except.html#tryFinally">tryFinally</a>
    (<span class="fn">do
      <span class="fn"><a href=".././Init/System/ST.html#ST.Ref.set">ST.Ref.set</a> <a href=".././Lean/ImportingFlag.html#_private.Lean.ImportingFlag.0.Lean.importingRef">Lean.importingRef</a> <a href=".././Init/Prelude.html#Bool.true">true</a></span>
      <span class="fn">x</span></span>)
    <span class="fn">do
    <span class="fn"><a href=".././Init/System/ST.html#ST.Ref.set">ST.Ref.set</a> <a href=".././Lean/ImportingFlag.html#_private.Lean.ImportingFlag.0.Lean.importingRef">Lean.importingRef</a> <a href=".././Init/Prelude.html#Bool.false">false</a></span>
    <span class="fn"><a href=".././Init/System/ST.html#ST.Ref.set">ST.Ref.set</a> <a href=".././Lean/ImportingFlag.html#_private.Lean.ImportingFlag.0.Lean.runInitializersRef">Lean.runInitializersRef</a> <a href=".././Init/Prelude.html#Bool.false">false</a></span></span></span></span></li></ul></details></div></div></main>
<nav class="nav"><iframe src=".././/navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>