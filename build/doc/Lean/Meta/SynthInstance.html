<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href="../.././style.css"></link><link rel="stylesheet" href="../.././src/pygments.css"></link><link rel="shortcut icon" href="../.././favicon.ico"></link><link rel="prefetch" href="../.././/declarations/declaration-data.bmp" as="image"></link><title>Lean.Meta.SynthInstance</title><script defer="true" src="../.././mathjax-config.js"></script><script defer="true" src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT="../.././";</script><script>const MODULE_NAME="Lean.Meta.SynthInstance";</script><script type="module" src="../.././nav.js"></script><script type="module" src="../.././search.js"></script><script type="module" src="../.././how-about.js"></script><script type="module" src="../.././instances.js"></script><script type="module" src="../.././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label>Documentation</h1><p class="header_filename break_within">Lean.Meta.SynthInstance</p><form action="https://google.com/search" method="get" id="search_form"><input type="hidden" name="sitesearch" value="https://leanprover-community.github.io/mathlib_docs"></input><input type="text" name="q" autocomplete="off"></input><button>Google site search</button></form></header><nav class="internal_nav"><h3><a class="break_within" href="#top">Lean.Meta.SynthInstance</a></h3><p class="gh_nav_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href="../.././Init.html">Init</a></li><li><a href="../.././Lean/Meta/AbstractMVars.html">Lean.Meta.AbstractMVars</a></li><li><a href="../.././Lean/Meta/Basic.html">Lean.Meta.Basic</a></li><li><a href="../.././Lean/Meta/Check.html">Lean.Meta.Check</a></li><li><a href="../.././Lean/Meta/Instances.html">Lean.Meta.Instances</a></li><li><a href="../.././Lean/Meta/WHNF.html">Lean.Meta.WHNF</a></li><li><a href="../.././Lean/Util/Profile.html">Lean.Util.Profile</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Lean.Meta.SynthInstance" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.synthInstance.maxHeartbeats">Lean.Meta.synthInstance.maxHeartbeats</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.synthInstance.maxSize">Lean.Meta.synthInstance.maxSize</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.getMaxHeartbeats">Lean.Meta.SynthInstance.getMaxHeartbeats</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.inferTCGoalsRLAttr">Lean.Meta.SynthInstance.inferTCGoalsRLAttr</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.hasInferTCGoalsRLAttribute">Lean.Meta.SynthInstance.hasInferTCGoalsRLAttribute</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.GeneratorNode">Lean.Meta.SynthInstance.GeneratorNode</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.instInhabitedGeneratorNode">Lean.Meta.SynthInstance.instInhabitedGeneratorNode</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.ConsumerNode">Lean.Meta.SynthInstance.ConsumerNode</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.instInhabitedConsumerNode">Lean.Meta.SynthInstance.instInhabitedConsumerNode</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.Waiter">Lean.Meta.SynthInstance.Waiter</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.Waiter.isRoot">Lean.Meta.SynthInstance.Waiter.isRoot</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.MkTableKey.State">Lean.Meta.SynthInstance.MkTableKey.State</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.MkTableKey.M">Lean.Meta.SynthInstance.MkTableKey.M</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.MkTableKey.instMonadMCtxM">Lean.Meta.SynthInstance.MkTableKey.instMonadMCtxM</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.MkTableKey.normLevel">Lean.Meta.SynthInstance.MkTableKey.normLevel</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.MkTableKey.normExpr">Lean.Meta.SynthInstance.MkTableKey.normExpr</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.mkTableKey">Lean.Meta.SynthInstance.mkTableKey</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.Answer">Lean.Meta.SynthInstance.Answer</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.instInhabitedAnswer">Lean.Meta.SynthInstance.instInhabitedAnswer</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.TableEntry">Lean.Meta.SynthInstance.TableEntry</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.Context">Lean.Meta.SynthInstance.Context</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.State">Lean.Meta.SynthInstance.State</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.SynthM">Lean.Meta.SynthInstance.SynthM</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.checkMaxHeartbeats">Lean.Meta.SynthInstance.checkMaxHeartbeats</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.mapMetaM">Lean.Meta.SynthInstance.mapMetaM</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.instInhabitedSynthM">Lean.Meta.SynthInstance.instInhabitedSynthM</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.getInstances">Lean.Meta.SynthInstance.getInstances</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.mkGeneratorNode?">Lean.Meta.SynthInstance.mkGeneratorNode?</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.newSubgoal">Lean.Meta.SynthInstance.newSubgoal</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.findEntry?">Lean.Meta.SynthInstance.findEntry?</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.getEntry">Lean.Meta.SynthInstance.getEntry</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.mkTableKeyFor">Lean.Meta.SynthInstance.mkTableKeyFor</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.SubgoalsResult">Lean.Meta.SynthInstance.SubgoalsResult</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.getSubgoals">Lean.Meta.SynthInstance.getSubgoals</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.tryResolve">Lean.Meta.SynthInstance.tryResolve</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.tryAnswer">Lean.Meta.SynthInstance.tryAnswer</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.wakeUp">Lean.Meta.SynthInstance.wakeUp</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.isNewAnswer">Lean.Meta.SynthInstance.isNewAnswer</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.addAnswer">Lean.Meta.SynthInstance.addAnswer</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.consume">Lean.Meta.SynthInstance.consume</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.getTop">Lean.Meta.SynthInstance.getTop</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.modifyTop">Lean.Meta.SynthInstance.modifyTop</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.generate">Lean.Meta.SynthInstance.generate</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.getNextToResume">Lean.Meta.SynthInstance.getNextToResume</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.resume">Lean.Meta.SynthInstance.resume</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.step">Lean.Meta.SynthInstance.step</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.getResult">Lean.Meta.SynthInstance.getResult</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.synth">Lean.Meta.SynthInstance.synth</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.SynthInstance.main">Lean.Meta.SynthInstance.main</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.synthInstance?">Lean.Meta.synthInstance?</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.trySynthInstance">Lean.Meta.trySynthInstance</a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.synthInstance">Lean.Meta.synthInstance</a></div></nav><main>
<div class="decl" id="Lean.Meta.synthInstance.maxHeartbeats"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L17-L20">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.synthInstance.maxHeartbeats">Lean.Meta.synthInstance.maxHeartbeats</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Data/Options.html#Lean.Option">Lean.Option</a> <a href="../.././Init/Prelude.html#Nat">Nat</a></span></div></div></div></div><div class="decl" id="Lean.Meta.synthInstance.maxSize"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L22-L25">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.synthInstance.maxSize">Lean.Meta.synthInstance.maxSize</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Data/Options.html#Lean.Option">Lean.Option</a> <a href="../.././Init/Prelude.html#Nat">Nat</a></span></div></div></div></div><div class="decl" id="Lean.Meta.SynthInstance.getMaxHeartbeats"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L29-L30">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.getMaxHeartbeats">Lean.Meta.SynthInstance.getMaxHeartbeats</a></span><span class="decl_args">
<span class="fn">(opts : <a href="../.././Lean/Data/Options.html#Lean.Options">Lean.Options</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Init/Prelude.html#Nat">Nat</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.getMaxHeartbeats">Lean.Meta.SynthInstance.getMaxHeartbeats</a> <span class="fn">opts</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><a href="../.././Lean/Data/Options.html#Lean.Option.get">Lean.Option.get</a> <span class="fn">opts</span> <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.synthInstance.maxHeartbeats">Lean.Meta.synthInstance.maxHeartbeats</a></span> <a href="../.././Init/Prelude.html#HMul.hMul">*</a> <span class="fn">1000</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.inferTCGoalsRLAttr"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L32-L33">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.inferTCGoalsRLAttr">Lean.Meta.SynthInstance.inferTCGoalsRLAttr</a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././Lean/Attributes.html#Lean.TagAttribute">Lean.TagAttribute</a></div></div></div></div><div class="decl" id="Lean.Meta.SynthInstance.hasInferTCGoalsRLAttribute"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L35-L36">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.hasInferTCGoalsRLAttribute">Lean.Meta.SynthInstance.hasInferTCGoalsRLAttribute</a></span><span class="decl_args">
<span class="fn">(env : <a href="../.././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(constName : <a href="../.././Init/Prelude.html#Lean.Name">Lean.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.hasInferTCGoalsRLAttribute">Lean.Meta.SynthInstance.hasInferTCGoalsRLAttribute</a> <span class="fn">env</span> <span class="fn">constName</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../.././Lean/Attributes.html#Lean.TagAttribute.hasTag">Lean.TagAttribute.hasTag</a> <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.inferTCGoalsRLAttr">Lean.Meta.SynthInstance.inferTCGoalsRLAttr</a> <span class="fn">env</span> <span class="fn">constName</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.GeneratorNode"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L38-L44">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.GeneratorNode">Lean.Meta.SynthInstance.GeneratorNode</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.Meta.SynthInstance.GeneratorNode.mk"><li id="Lean.Meta.SynthInstance.GeneratorNode.mvar" class="structure_field"><div class="structure_field_info">mvar : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a></div></li><li id="Lean.Meta.SynthInstance.GeneratorNode.key" class="structure_field"><div class="structure_field_info">key : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a></div></li><li id="Lean.Meta.SynthInstance.GeneratorNode.mctx" class="structure_field"><div class="structure_field_info">mctx : <a href="../.././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a></div></li><li id="Lean.Meta.SynthInstance.GeneratorNode.instances" class="structure_field"><div class="structure_field_info">instances : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></div></li><li id="Lean.Meta.SynthInstance.GeneratorNode.currInstanceIdx" class="structure_field"><div class="structure_field_info">currInstanceIdx : <a href="../.././Init/Prelude.html#Nat">Nat</a></div></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.Meta.SynthInstance.GeneratorNode" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.instInhabitedGeneratorNode"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L44-L44">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.instInhabitedGeneratorNode">Lean.Meta.SynthInstance.instInhabitedGeneratorNode</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Inhabited">Inhabited</a> <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.GeneratorNode">Lean.Meta.SynthInstance.GeneratorNode</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.instInhabitedGeneratorNode">Lean.Meta.SynthInstance.instInhabitedGeneratorNode</a> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn">{ <span class="fn">default</span> := <span class="fn">{ <span class="fn">mvar</span> := <span class="fn">default</span>, <span class="fn">key</span> := <span class="fn">default</span>, <span class="fn">mctx</span> := <span class="fn">default</span>, <span class="fn">instances</span> := <span class="fn">default</span>, <span class="fn">currInstanceIdx</span> := <span class="fn">default</span> }</span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.ConsumerNode"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L46-L52">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.ConsumerNode">Lean.Meta.SynthInstance.ConsumerNode</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.Meta.SynthInstance.ConsumerNode.mk"><li id="Lean.Meta.SynthInstance.ConsumerNode.mvar" class="structure_field"><div class="structure_field_info">mvar : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a></div></li><li id="Lean.Meta.SynthInstance.ConsumerNode.key" class="structure_field"><div class="structure_field_info">key : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a></div></li><li id="Lean.Meta.SynthInstance.ConsumerNode.mctx" class="structure_field"><div class="structure_field_info">mctx : <a href="../.././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a></div></li><li id="Lean.Meta.SynthInstance.ConsumerNode.subgoals" class="structure_field"><div class="structure_field_info">subgoals : <span class="fn"><a href="../.././Init/Prelude.html#List">List</a> <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></div></li><li id="Lean.Meta.SynthInstance.ConsumerNode.size" class="structure_field"><div class="structure_field_info">size : <a href="../.././Init/Prelude.html#Nat">Nat</a></div></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.Meta.SynthInstance.ConsumerNode" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.instInhabitedConsumerNode"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L52-L52">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.instInhabitedConsumerNode">Lean.Meta.SynthInstance.instInhabitedConsumerNode</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Inhabited">Inhabited</a> <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.ConsumerNode">Lean.Meta.SynthInstance.ConsumerNode</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.instInhabitedConsumerNode">Lean.Meta.SynthInstance.instInhabitedConsumerNode</a> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn">{ <span class="fn">default</span> := <span class="fn">{ <span class="fn">mvar</span> := <span class="fn">default</span>, <span class="fn">key</span> := <span class="fn">default</span>, <span class="fn">mctx</span> := <span class="fn">default</span>, <span class="fn">subgoals</span> := <span class="fn">default</span>, <span class="fn">size</span> := <span class="fn">default</span> }</span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.Waiter"><div class="inductive"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L54-L56">source</a></div><div class="decl_header"><span class="decl_kind">inductive</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.Waiter">Lean.Meta.SynthInstance.Waiter</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="constructors"><li class="constructor" id="Lean.Meta.SynthInstance.Waiter.consumerNode">consumerNode: <span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.ConsumerNode">Lean.Meta.SynthInstance.ConsumerNode</a> → <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.Waiter">Lean.Meta.SynthInstance.Waiter</a></span></li><li class="constructor" id="Lean.Meta.SynthInstance.Waiter.root">root: <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.Waiter">Lean.Meta.SynthInstance.Waiter</a></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.Meta.SynthInstance.Waiter" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.Waiter.isRoot"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L58-L60">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.Waiter.isRoot">Lean.Meta.SynthInstance.Waiter.isRoot</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.Waiter">Lean.Meta.SynthInstance.Waiter</a> → <a href="../.././Init/Prelude.html#Bool">Bool</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.Waiter.isRoot">Lean.Meta.SynthInstance.Waiter.isRoot</a> <span class="fn">x</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn">match <span class="fn">x</span> with
  | <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.Waiter.root"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.Waiter.consumerNode">Lean.Meta.SynthInstance.Waiter.consumerNode</a> <span class="fn">a</span></a> =&gt <a href="../.././Init/Prelude.html#Bool.false">false</a>
  | <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.Waiter.root">Lean.Meta.SynthInstance.Waiter.root</a> =&gt <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.Waiter.root">true</a></span></span></li></ul></details></div></div><div class="mod_doc"><p>In tabled resolution, we creating a mapping from goals (e.g., <code><a href="../.././Init/Coe.html#Coe">Coe</a> <a href="../.././Init/Prelude.html#Nat">Nat</a> ?x</code>) to
answers and waiters. Waiters are consumer nodes that are waiting for answers for a
particular node.</p><p>We implement this mapping using a <code>HashMap</code> where the keys are
normalized expressions. That is, we replace assignable metavariables
with auxiliary free variables of the form <code>_tc.<idx></code>. We do
not declare these free variables in any local context, and we should
view them as "normalized names" for metavariables. For example, the
term <code>f ?m ?m ?n</code> is normalized as
<code>f _tc.0 _tc.0 _tc.1</code>.</p><p>This approach is structural, and we may visit the same goal more
than once if the different occurrences are just definitionally
equal, but not structurally equal.</p><p>Remark: a metavariable is assignable only if its depth is equal to
the metavar context depth.</p></div><div class="decl" id="Lean.Meta.SynthInstance.MkTableKey.State"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L84-L88">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.MkTableKey.State">Lean.Meta.SynthInstance.MkTableKey.State</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.Meta.SynthInstance.MkTableKey.State.mk"><li id="Lean.Meta.SynthInstance.MkTableKey.State.nextIdx" class="structure_field"><div class="structure_field_info">nextIdx : <a href="../.././Init/Prelude.html#Nat">Nat</a></div></li><li id="Lean.Meta.SynthInstance.MkTableKey.State.lmap" class="structure_field"><div class="structure_field_info">lmap : <span class="fn"><a href="../.././Lean/Data/HashMap.html#Lean.HashMap">Lean.HashMap</a> <a href="../.././Lean/Level.html#Lean.LMVarId">Lean.LMVarId</a> <a href="../.././Lean/Level.html#Lean.Level">Lean.Level</a></span></div></li><li id="Lean.Meta.SynthInstance.MkTableKey.State.emap" class="structure_field"><div class="structure_field_info">emap : <span class="fn"><a href="../.././Lean/Data/HashMap.html#Lean.HashMap">Lean.HashMap</a> <a href="../.././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a> <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></div></li><li id="Lean.Meta.SynthInstance.MkTableKey.State.mctx" class="structure_field"><div class="structure_field_info">mctx : <a href="../.././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a></div></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.Meta.SynthInstance.MkTableKey.State" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.MkTableKey.M"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L90-L90">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.MkTableKey.M">Lean.Meta.SynthInstance.MkTableKey.M</a></span><span class="decl_args">
<span class="fn">(α : <span class="fn">Type</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.MkTableKey.M">Lean.Meta.SynthInstance.MkTableKey.M</a> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Init/Control/State.html#StateM">StateM</a> <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.MkTableKey.State">Lean.Meta.SynthInstance.MkTableKey.State</a></span></span></li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.MkTableKey.instMonadMCtxM"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L93-L95">source</a></div><div class="attributes">@[always_inline]</div>
<div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.MkTableKey.instMonadMCtxM">Lean.Meta.SynthInstance.MkTableKey.instMonadMCtxM</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.MkTableKey.M">Lean.Meta.SynthInstance.MkTableKey.M</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.MkTableKey.normLevel"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L97-L115">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.MkTableKey.normLevel">Lean.Meta.SynthInstance.MkTableKey.normLevel</a></span><span class="decl_args">
<span class="fn">(u : <a href="../.././Lean/Level.html#Lean.Level">Lean.Level</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.MkTableKey.M">Lean.Meta.SynthInstance.MkTableKey.M</a> <a href="../.././Lean/Level.html#Lean.Level">Lean.Level</a></span></div></div></div></div><div class="decl" id="Lean.Meta.SynthInstance.MkTableKey.normExpr"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L117-L140">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.MkTableKey.normExpr">Lean.Meta.SynthInstance.MkTableKey.normExpr</a></span><span class="decl_args">
<span class="fn">(e : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.MkTableKey.M">Lean.Meta.SynthInstance.MkTableKey.M</a> <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></div></div></div></div><div class="decl" id="Lean.Meta.SynthInstance.mkTableKey"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L145-L148">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.mkTableKey">Lean.Meta.SynthInstance.mkTableKey</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href="../.././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href="../.././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(e : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></div></div><p>Remark: <code><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.mkTableKey">mkTableKey</a></code> assumes <code>e</code> does not contain assigned metavariables.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.Answer"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L150-L154">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.Answer">Lean.Meta.SynthInstance.Answer</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.Meta.SynthInstance.Answer.mk"><li id="Lean.Meta.SynthInstance.Answer.result" class="structure_field"><div class="structure_field_info">result : <a href="../.././Lean/Meta/AbstractMVars.html#Lean.Meta.AbstractMVarsResult">Lean.Meta.AbstractMVarsResult</a></div></li><li id="Lean.Meta.SynthInstance.Answer.resultType" class="structure_field"><div class="structure_field_info">resultType : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a></div></li><li id="Lean.Meta.SynthInstance.Answer.size" class="structure_field"><div class="structure_field_info">size : <a href="../.././Init/Prelude.html#Nat">Nat</a></div></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.Meta.SynthInstance.Answer" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.instInhabitedAnswer"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L154-L154">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.instInhabitedAnswer">Lean.Meta.SynthInstance.instInhabitedAnswer</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Inhabited">Inhabited</a> <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.Answer">Lean.Meta.SynthInstance.Answer</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.instInhabitedAnswer">Lean.Meta.SynthInstance.instInhabitedAnswer</a> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn">{ <span class="fn">default</span> := <span class="fn">{ <span class="fn">result</span> := <span class="fn">default</span>, <span class="fn">resultType</span> := <span class="fn">default</span>, <span class="fn">size</span> := <span class="fn">default</span> }</span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.TableEntry"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L156-L158">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.TableEntry">Lean.Meta.SynthInstance.TableEntry</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.Meta.SynthInstance.TableEntry.mk"><li id="Lean.Meta.SynthInstance.TableEntry.waiters" class="structure_field"><div class="structure_field_info">waiters : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.Waiter">Lean.Meta.SynthInstance.Waiter</a></span></div></li><li id="Lean.Meta.SynthInstance.TableEntry.answers" class="structure_field"><div class="structure_field_info">answers : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.Answer">Lean.Meta.SynthInstance.Answer</a></span></div></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.Meta.SynthInstance.TableEntry" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.Context"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L160-L162">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.Context">Lean.Meta.SynthInstance.Context</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.Meta.SynthInstance.Context.mk"><li id="Lean.Meta.SynthInstance.Context.maxResultSize" class="structure_field"><div class="structure_field_info">maxResultSize : <a href="../.././Init/Prelude.html#Nat">Nat</a></div></li><li id="Lean.Meta.SynthInstance.Context.maxHeartbeats" class="structure_field"><div class="structure_field_info">maxHeartbeats : <a href="../.././Init/Prelude.html#Nat">Nat</a></div></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.Meta.SynthInstance.Context" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.State"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L171-L175">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.State">Lean.Meta.SynthInstance.State</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.Meta.SynthInstance.State.mk"><li id="Lean.Meta.SynthInstance.State.result?" class="structure_field"><div class="structure_field_info">result? : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Meta/AbstractMVars.html#Lean.Meta.AbstractMVarsResult">Lean.Meta.AbstractMVarsResult</a></span></div></li><li id="Lean.Meta.SynthInstance.State.generatorStack" class="structure_field"><div class="structure_field_info">generatorStack : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.GeneratorNode">Lean.Meta.SynthInstance.GeneratorNode</a></span></div></li><li id="Lean.Meta.SynthInstance.State.resumeStack" class="structure_field"><div class="structure_field_info">resumeStack : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> (<span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.ConsumerNode">Lean.Meta.SynthInstance.ConsumerNode</a> <a href="../.././Init/Prelude.html#Prod">×</a> <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.Answer">Lean.Meta.SynthInstance.Answer</a></span>)</span></div></li><li id="Lean.Meta.SynthInstance.State.tableEntries" class="structure_field"><div class="structure_field_info">tableEntries : <span class="fn"><a href="../.././Lean/Data/HashMap.html#Lean.HashMap">Lean.HashMap</a> <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a> <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.TableEntry">Lean.Meta.SynthInstance.TableEntry</a></span></div></li></ul><p>Remark: the SynthInstance.State is not really an extension of <code>Meta.<a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.MkTableKey.State">State</a></code>.
The field <code>postponed</code> is not needed, and the field <code>mctx</code> is misleading since
<code><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.synthInstance">synthInstance</a></code> methods operate over different <code>MetavarContext</code>s simultaneously.
That being said, we still use <code>extends</code> because it makes it simpler to move from
<code><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.MkTableKey.M">M</a></code> to <code>MetaM</code>.</p><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.Meta.SynthInstance.State" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.SynthM"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L177-L177">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.SynthM">Lean.Meta.SynthInstance.SynthM</a></span><span class="decl_args">
<span class="fn">(α : <span class="fn">Type</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.SynthM">Lean.Meta.SynthInstance.SynthM</a> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../.././Init/Prelude.html#ReaderT">ReaderT</a> <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.Context">Lean.Meta.SynthInstance.Context</a> (<span class="fn"><a href="../.././Init/Control/StateRef.html#StateRefT'">StateRefT'</a> <a href="../.././Init/System/IO.html#IO.RealWorld">IO.RealWorld</a> <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.State">Lean.Meta.SynthInstance.State</a> <a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a></span>)</span></span></li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.checkMaxHeartbeats"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L179-L180">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.checkMaxHeartbeats">Lean.Meta.SynthInstance.checkMaxHeartbeats</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.SynthM">Lean.Meta.SynthInstance.SynthM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.checkMaxHeartbeats">Lean.Meta.SynthInstance.checkMaxHeartbeats</a> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let __do_lift ← <span class="fn">read</span>
  <span class="fn"><a href="../.././Init/Prelude.html#liftM">liftM</a> (<span class="fn"><a href="../.././Lean/CoreM.html#Lean.Core.checkMaxHeartbeatsCore">Lean.Core.checkMaxHeartbeatsCore</a> <span class="fn">&quottypeclass&quot</span> <span class="fn">`synthInstance.maxHeartbeats</span> <span class="fn"><span class="fn">__do_lift</span>.maxHeartbeats</span></span>)</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.mapMetaM"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L182-L183">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.mapMetaM">Lean.Meta.SynthInstance.mapMetaM</a></span><span class="decl_args">
<span class="fn">(f : <span class="fn">{<span class="fn">α</span> : <span class="fn">Type</span>} → <span class="fn"><span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> <span class="fn">α</span></span> → <span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> <span class="fn">α</span></span></span></span>)</span></span>
<span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.SynthM">Lean.Meta.SynthInstance.SynthM</a> <span class="fn">α</span></span> → <span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.SynthM">Lean.Meta.SynthInstance.SynthM</a> <span class="fn">α</span></span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.mapMetaM">Lean.Meta.SynthInstance.mapMetaM</a> <span class="fn">f</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Init/Prelude.html#MonadFunctorT.monadMap">monadMap</a> <span class="fn">f</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.instInhabitedSynthM"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L185-L186">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.instInhabitedSynthM">Lean.Meta.SynthInstance.instInhabitedSynthM</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <span class="fn">Type</span>}</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Inhabited">Inhabited</a> (<span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.SynthM">Lean.Meta.SynthInstance.SynthM</a> <span class="fn">α</span></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">Lean.Meta.SynthInstance.instInhabitedSynthM</span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">default</span> := <span class="fn">fun <span class="fn">x</span> <span class="fn">x</span> =&gt <span class="fn">default</span></span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.getInstances"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L189-L213">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.getInstances">Lean.Meta.SynthInstance.getInstances</a></span><span class="decl_args">
<span class="fn">(type : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> (<span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span>)</span></div></div><p>Return globals and locals instances that may unify with <code>type</code></p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.mkGeneratorNode?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L215-L226">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.mkGeneratorNode?">Lean.Meta.SynthInstance.mkGeneratorNode?</a></span><span class="decl_args">
<span class="fn">(key : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(mvar : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> (<span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.GeneratorNode">Lean.Meta.SynthInstance.GeneratorNode</a></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.newSubgoal"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L231-L241">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.newSubgoal">Lean.Meta.SynthInstance.newSubgoal</a></span><span class="decl_args">
<span class="fn">(mctx : <a href="../.././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(key : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(mvar : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(waiter : <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.Waiter">Lean.Meta.SynthInstance.Waiter</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.SynthM">Lean.Meta.SynthInstance.SynthM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Create a new generator node for <code>mvar</code> and add <code>waiter</code> as its waiter.
<code>key</code> must be <code><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.mkTableKey">mkTableKey</a> mctx mvarType</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.findEntry?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L243-L244">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.findEntry?">Lean.Meta.SynthInstance.findEntry?</a></span><span class="decl_args">
<span class="fn">(key : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.SynthM">Lean.Meta.SynthInstance.SynthM</a> (<span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.TableEntry">Lean.Meta.SynthInstance.TableEntry</a></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.findEntry?">Lean.Meta.SynthInstance.findEntry?</a> <span class="fn">key</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let __do_lift ← <span class="fn">get</span>
  <span class="fn"><a href="../.././Init/Prelude.html#Pure.pure">pure</a> (<span class="fn"><a href="../.././Lean/Data/HashMap.html#Lean.HashMap.find?">Lean.HashMap.find?</a> <span class="fn"><span class="fn">__do_lift</span>.tableEntries</span> <span class="fn">key</span></span>)</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.getEntry"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L246-L249">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.getEntry">Lean.Meta.SynthInstance.getEntry</a></span><span class="decl_args">
<span class="fn">(key : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.SynthM">Lean.Meta.SynthInstance.SynthM</a> <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.TableEntry">Lean.Meta.SynthInstance.TableEntry</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.mkTableKeyFor"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L256-L260">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.mkTableKeyFor">Lean.Meta.SynthInstance.mkTableKeyFor</a></span><span class="decl_args">
<span class="fn">(mctx : <a href="../.././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(mvar : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.SynthM">Lean.Meta.SynthInstance.SynthM</a> <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></div></div><p>Create a <code>key</code> for the goal associated with the given metavariable.
That is, we create a key for the type of the metavariable.</p><p>We must instantiate assigned metavariables before we invoke <code><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.mkTableKey">mkTableKey</a></code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.SubgoalsResult"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L268-L271">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.SubgoalsResult">Lean.Meta.SynthInstance.SubgoalsResult</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.Meta.SynthInstance.SubgoalsResult.mk"><li id="Lean.Meta.SynthInstance.SubgoalsResult.subgoals" class="structure_field"><div class="structure_field_info">subgoals : <span class="fn"><a href="../.././Init/Prelude.html#List">List</a> <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></div></li><li id="Lean.Meta.SynthInstance.SubgoalsResult.instVal" class="structure_field"><div class="structure_field_info">instVal : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a></div></li><li id="Lean.Meta.SynthInstance.SubgoalsResult.instTypeBody" class="structure_field"><div class="structure_field_info">instTypeBody : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a></div></li></ul><p>See <code><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.getSubgoals">getSubgoals</a></code> and <code>getSubgoalsAux</code></p><p>We use the parameter <code>j</code> to reduce the number of <code>instantiate*</code> invocations.
It is the same approach we use at <code>forallTelescope</code> and <code>lambdaTelescope</code>.
Given <code>getSubgoalsAux args j subgoals instVal type</code>,
we have that <code>type.instantiateRevRange j args.size args</code> does not have loose bound variables.</p><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.Meta.SynthInstance.SubgoalsResult" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.getSubgoals"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L307-L317">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.getSubgoals">Lean.Meta.SynthInstance.getSubgoals</a></span><span class="decl_args">
<span class="fn">(lctx : <a href="../.././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(localInsts : <a href="../.././Lean/MetavarContext.html#Lean.LocalInstances">Lean.LocalInstances</a>)</span></span>
<span class="decl_args">
<span class="fn">(xs : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(inst : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.SubgoalsResult">Lean.Meta.SynthInstance.SubgoalsResult</a></span></div></div><p><code><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.getSubgoals">getSubgoals</a> lctx localInsts xs inst</code> creates the subgoals for the instance <code>inst</code>.
The subgoals are in the context of the free variables <code>xs</code>, and
<code>(lctx, localInsts)</code> is the local context and instances before we added the free variables to it.</p><p>This extra complication is required because
1- We want all metavariables created by <code><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.synthInstance">synthInstance</a></code> to share the same local context.
2- We want to ensure that applications such as <code>mvar xs</code> are higher order patterns.</p><p>The method <code>getGoals</code> create a new metavariable for each parameter of <code>inst</code>.
For example, suppose the type of <code>inst</code> is <code>forall (x_1 : A_1) ... (x_n : A_n), B x_1 ... x_n</code>.
Then, we create the metavariables <code>?m_i : forall xs, A_i</code>, and return the subset of these
metavariables that are instance implicit arguments, and the expressions:</p><ul>
<li><code>inst (?m_1 xs) ... (?m_n xs)</code> (aka <code>instVal</code>)</li>
<li><code>B (?m_1 xs) ... (?m_n xs)</code></li>
</ul><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.tryResolve"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L324-L357">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.tryResolve">Lean.Meta.SynthInstance.tryResolve</a></span><span class="decl_args">
<span class="fn">(mvar : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(inst : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> (<span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> (<span class="fn"><a href="../.././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a> <a href="../.././Init/Prelude.html#Prod">×</a> <span class="fn"><a href="../.././Init/Prelude.html#List">List</a> <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></span>)</span>)</span></div></div><p>Try to synthesize metavariable <code>mvar</code> using the instance <code>inst</code>.
Remark: <code>mctx</code> is set using <code>withMCtx</code>.
If it succeeds, the result is a new updated metavariable context and a new list of subgoals.
A subgoal is created for each instance implicit parameter of <code>inst</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.tryAnswer"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L362-L368">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.tryAnswer">Lean.Meta.SynthInstance.tryAnswer</a></span><span class="decl_args">
<span class="fn">(mctx : <a href="../.././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(mvar : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(answer : <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.Answer">Lean.Meta.SynthInstance.Answer</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.SynthM">Lean.Meta.SynthInstance.SynthM</a> (<span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a></span>)</span></div></div><p>Assign a precomputed answer to <code>mvar</code>.
If it succeeds, the result is a new updated metavariable context and a new list of subgoals.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.wakeUp"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L371-L383">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.wakeUp">Lean.Meta.SynthInstance.wakeUp</a></span><span class="decl_args">
<span class="fn">(answer : <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.Answer">Lean.Meta.SynthInstance.Answer</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.Waiter">Lean.Meta.SynthInstance.Waiter</a> → <span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.SynthM">Lean.Meta.SynthInstance.SynthM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></span></div></div><p>Move waiters that are waiting for the given answer to the resume stack.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.isNewAnswer"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L385-L389">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.isNewAnswer">Lean.Meta.SynthInstance.isNewAnswer</a></span><span class="decl_args">
<span class="fn">(oldAnswers : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.Answer">Lean.Meta.SynthInstance.Answer</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(answer : <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.Answer">Lean.Meta.SynthInstance.Answer</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.isNewAnswer">Lean.Meta.SynthInstance.isNewAnswer</a> <span class="fn">oldAnswers</span> <span class="fn">answer</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../.././Init/Data/Array/Basic.html#Array.all">Array.all</a> <span class="fn">oldAnswers</span> (<span class="fn">fun <span class="fn">oldAnswer</span> =&gt <span class="fn"><span class="fn"><span class="fn">oldAnswer</span>.resultType</span> <a href="../.././Init/Core.html#bne">!=</a> <span class="fn"><span class="fn">answer</span>.resultType</span></span></span>) <span class="fn">0</span> (<span class="fn"><a href="../.././Init/Prelude.html#Array.size">Array.size</a> <span class="fn">oldAnswers</span></span>)</span></span></li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.addAnswer"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L403-L417">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.addAnswer">Lean.Meta.SynthInstance.addAnswer</a></span><span class="decl_args">
<span class="fn">(cNode : <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.ConsumerNode">Lean.Meta.SynthInstance.ConsumerNode</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.SynthM">Lean.Meta.SynthInstance.SynthM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Create a new answer after <code>cNode</code> resolved all subgoals.
That is, <code>cNode.subgoals == []</code>.
And then, store it in the tabled entries map, and wakeup waiters.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.consume"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L472-L504">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.consume">Lean.Meta.SynthInstance.consume</a></span><span class="decl_args">
<span class="fn">(cNode : <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.ConsumerNode">Lean.Meta.SynthInstance.ConsumerNode</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.SynthM">Lean.Meta.SynthInstance.SynthM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Process the next subgoal in the given consumer node.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.getTop"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L506-L507">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.getTop">Lean.Meta.SynthInstance.getTop</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.SynthM">Lean.Meta.SynthInstance.SynthM</a> <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.GeneratorNode">Lean.Meta.SynthInstance.GeneratorNode</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.getTop">Lean.Meta.SynthInstance.getTop</a> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let __do_lift ← <span class="fn">get</span>
  <span class="fn"><a href="../.././Init/Prelude.html#Pure.pure">pure</a> (<span class="fn"><a href="../.././Init/Data/Array/Basic.html#Array.back">Array.back</a> <span class="fn"><span class="fn">__do_lift</span>.generatorStack</span></span>)</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.modifyTop"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L509-L510">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.modifyTop">Lean.Meta.SynthInstance.modifyTop</a></span><span class="decl_args">
<span class="fn">(f : <span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.GeneratorNode">Lean.Meta.SynthInstance.GeneratorNode</a> → <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.GeneratorNode">Lean.Meta.SynthInstance.GeneratorNode</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.SynthM">Lean.Meta.SynthInstance.SynthM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.generate"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L513-L530">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.generate">Lean.Meta.SynthInstance.generate</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.SynthM">Lean.Meta.SynthInstance.SynthM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Try the next instance in the node on the top of the generator stack.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.getNextToResume"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L532-L535">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.getNextToResume">Lean.Meta.SynthInstance.getNextToResume</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.SynthM">Lean.Meta.SynthInstance.SynthM</a> (<span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.ConsumerNode">Lean.Meta.SynthInstance.ConsumerNode</a> <a href="../.././Init/Prelude.html#Prod">×</a> <a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.Answer">Lean.Meta.SynthInstance.Answer</a></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.resume"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L540-L555">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.resume">Lean.Meta.SynthInstance.resume</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.SynthM">Lean.Meta.SynthInstance.SynthM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Given <code>(cNode, answer)</code> on the top of the resume stack, continue execution by using <code>answer</code> to solve the
next subgoal.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.step"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L557-L567">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.step">Lean.Meta.SynthInstance.step</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.SynthM">Lean.Meta.SynthInstance.SynthM</a> <a href="../.././Init/Prelude.html#Bool">Bool</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.getResult"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L569-L570">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.getResult">Lean.Meta.SynthInstance.getResult</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.SynthM">Lean.Meta.SynthInstance.SynthM</a> (<span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Meta/AbstractMVars.html#Lean.Meta.AbstractMVarsResult">Lean.Meta.AbstractMVarsResult</a></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.getResult">Lean.Meta.SynthInstance.getResult</a> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let __do_lift ← <span class="fn">get</span>
  <span class="fn"><a href="../.././Init/Prelude.html#Pure.pure">pure</a> <span class="fn"><span class="fn">__do_lift</span>.result?</span></span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Meta.SynthInstance.synth"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L572-L578">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.synth">Lean.Meta.SynthInstance.synth</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.SynthM">Lean.Meta.SynthInstance.SynthM</a> (<span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Meta/AbstractMVars.html#Lean.Meta.AbstractMVarsResult">Lean.Meta.AbstractMVarsResult</a></span>)</span></div></div></div></div><div class="decl" id="Lean.Meta.SynthInstance.main"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L580-L593">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.SynthInstance.main">Lean.Meta.SynthInstance.main</a></span><span class="decl_args">
<span class="fn">(type : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(maxResultSize : <a href="../.././Init/Prelude.html#Nat">Nat</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> (<span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Meta/AbstractMVars.html#Lean.Meta.AbstractMVarsResult">Lean.Meta.AbstractMVarsResult</a></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="mod_doc"><p>Type class parameters can be annotated with <code><a href="../.././Init/Prelude.html#outParam">outParam</a></code> annotations.</p><p>Given <code>C a_1 ... a_n</code>, we replace <code>a_i</code> with a fresh metavariable <code>?m_i</code> IF
<code>a_i</code> is an <code><a href="../.././Init/Prelude.html#outParam">outParam</a></code>.
The result is type correct because we reject type class declarations IF
it contains a regular parameter X that depends on an <code>out</code> parameter Y.</p><p>Then, we execute type class resolution as usual.
If it succeeds, and metavariables ?m_i have been assigned, we try to unify
the original type <code>C a_1 ... a_n</code> witht the normalized one.</p></div><div class="mod_doc"><p>Remark: when <code>maxResultSize? == none</code>, the configuration option <code>synthInstance.maxResultSize</code> is used.
Remark: we use a different option for controlling the maximum result size for coercions.</p></div><div class="decl" id="Lean.Meta.synthInstance?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L661-L730">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.synthInstance?">Lean.Meta.synthInstance?</a></span><span class="decl_args">
<span class="fn">(type : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(maxResultSize? : <span class="fn"><a href="../.././Init/Prelude.html#optParam">optParam</a> (<span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Init/Prelude.html#Nat">Nat</a></span>) <span class="fn">none</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> (<span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Meta.trySynthInstance"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L735-L738">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.trySynthInstance">Lean.Meta.trySynthInstance</a></span><span class="decl_args">
<span class="fn">(type : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(maxResultSize? : <span class="fn"><a href="../.././Init/Prelude.html#optParam">optParam</a> (<span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Init/Prelude.html#Nat">Nat</a></span>) <span class="fn">none</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> (<span class="fn"><a href="../.././Lean/Data/LOption.html#Lean.LOption">Lean.LOption</a> <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span>)</span></div></div><p>Return <code>LOption.some r</code> if succeeded, <code>LOption.none</code> if it failed, and <code>LOption.undef</code> if
instance cannot be synthesized right now because <code>type</code> contains metavariables.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Meta.synthInstance"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/23ba495205f8133628d85dde572aad0c1089c094/src/Lean/Meta/SynthInstance.lean#L740-L747">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/SynthInstance.html#Lean.Meta.synthInstance">Lean.Meta.synthInstance</a></span><span class="decl_args">
<span class="fn">(type : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(maxResultSize? : <span class="fn"><a href="../.././Init/Prelude.html#optParam">optParam</a> (<span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Init/Prelude.html#Nat">Nat</a></span>) <span class="fn">none</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div></main>
<nav class="nav"><iframe src="../.././/navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>