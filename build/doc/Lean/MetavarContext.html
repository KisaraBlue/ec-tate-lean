<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href=".././style.css"></link><link rel="stylesheet" href=".././src/pygments.css"></link><link rel="shortcut icon" href=".././favicon.ico"></link><link rel="prefetch" href=".././/declarations/declaration-data.bmp" as="image"></link><title>Lean.MetavarContext</title><script defer="true" src=".././mathjax-config.js"></script><script defer="true" src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT=".././";</script><script>const MODULE_NAME="Lean.MetavarContext";</script><script type="module" src=".././nav.js"></script><script type="module" src=".././search.js"></script><script type="module" src=".././how-about.js"></script><script type="module" src=".././instances.js"></script><script type="module" src=".././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label>Documentation</h1><p class="header_filename break_within">Lean.MetavarContext</p><form action="https://google.com/search" method="get" id="search_form"><input type="hidden" name="sitesearch" value="https://leanprover-community.github.io/mathlib_docs"></input><input type="text" name="q" autocomplete="off"></input><button>Google site search</button></form></header><nav class="internal_nav"><h3><a class="break_within" href="#top">Lean.MetavarContext</a></h3><p class="gh_nav_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href=".././Init.html">Init</a></li><li><a href=".././Lean/LocalContext.html">Lean.LocalContext</a></li><li><a href=".././Lean/Util/MonadCache.html">Lean.Util.MonadCache</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Lean.MetavarContext" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Lean.LocalInstance">Lean.LocalInstance</a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedLocalInstance">Lean.instInhabitedLocalInstance</a></div><div class="nav_link"><a class="break_within" href="#Lean.LocalInstances">Lean.LocalInstances</a></div><div class="nav_link"><a class="break_within" href="#Lean.instBEqLocalInstance">Lean.instBEqLocalInstance</a></div><div class="nav_link"><a class="break_within" href="#Lean.LocalInstances.erase">Lean.LocalInstances.erase</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarKind">Lean.MetavarKind</a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedMetavarKind">Lean.instInhabitedMetavarKind</a></div><div class="nav_link"><a class="break_within" href="#Lean.instReprMetavarKind">Lean.instReprMetavarKind</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarKind.isSyntheticOpaque">Lean.MetavarKind.isSyntheticOpaque</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarKind.isNatural">Lean.MetavarKind.isNatural</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarDecl">Lean.MetavarDecl</a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedMetavarDecl">Lean.instInhabitedMetavarDecl</a></div><div class="nav_link"><a class="break_within" href="#Lean.DelayedMetavarAssignment">Lean.DelayedMetavarAssignment</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext">Lean.MetavarContext</a></div><div class="nav_link"><a class="break_within" href="#Lean.MonadMCtx">Lean.MonadMCtx</a></div><div class="nav_link"><a class="break_within" href="#Lean.instMonadMCtx">Lean.instMonadMCtx</a></div><div class="nav_link"><a class="break_within" href="#Lean.setMCtx">Lean.setMCtx</a></div><div class="nav_link"><a class="break_within" href="#Lean.getLevelMVarAssignment?">Lean.getLevelMVarAssignment?</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.getExprAssignmentCore?">Lean.MetavarContext.getExprAssignmentCore?</a></div><div class="nav_link"><a class="break_within" href="#Lean.getExprMVarAssignment?">Lean.getExprMVarAssignment?</a></div><div class="nav_link"><a class="break_within" href="#Lean.getDelayedMVarAssignment?">Lean.getDelayedMVarAssignment?</a></div><div class="nav_link"><a class="break_within" href="#Lean.getDelayedMVarRoot">Lean.getDelayedMVarRoot</a></div><div class="nav_link"><a class="break_within" href="#Lean.isLevelMVarAssigned">Lean.isLevelMVarAssigned</a></div><div class="nav_link"><a class="break_within" href="#Lean.MVarId.isAssigned">Lean.MVarId.isAssigned</a></div><div class="nav_link"><a class="break_within" href="#Lean.isExprMVarAssigned">Lean.isExprMVarAssigned</a></div><div class="nav_link"><a class="break_within" href="#Lean.MVarId.isDelayedAssigned">Lean.MVarId.isDelayedAssigned</a></div><div class="nav_link"><a class="break_within" href="#Lean.isMVarDelayedAssigned">Lean.isMVarDelayedAssigned</a></div><div class="nav_link"><a class="break_within" href="#Lean.isLevelMVarAssignable">Lean.isLevelMVarAssignable</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.getDecl">Lean.MetavarContext.getDecl</a></div><div class="nav_link"><a class="break_within" href="#Lean.MVarId.isAssignable">Lean.MVarId.isAssignable</a></div><div class="nav_link"><a class="break_within" href="#Lean.isExprMVarAssignable">Lean.isExprMVarAssignable</a></div><div class="nav_link"><a class="break_within" href="#Lean.hasAssignedLevelMVar">Lean.hasAssignedLevelMVar</a></div><div class="nav_link"><a class="break_within" href="#Lean.hasAssignedMVar">Lean.hasAssignedMVar</a></div><div class="nav_link"><a class="break_within" href="#Lean.hasAssignableLevelMVar">Lean.hasAssignableLevelMVar</a></div><div class="nav_link"><a class="break_within" href="#Lean.hasAssignableMVar">Lean.hasAssignableMVar</a></div><div class="nav_link"><a class="break_within" href="#Lean.assignLevelMVar">Lean.assignLevelMVar</a></div><div class="nav_link"><a class="break_within" href="#Lean.MVarId.assign">Lean.MVarId.assign</a></div><div class="nav_link"><a class="break_within" href="#Lean.assignExprMVar">Lean.assignExprMVar</a></div><div class="nav_link"><a class="break_within" href="#Lean.assignDelayedMVar">Lean.assignDelayedMVar</a></div><div class="nav_link"><a class="break_within" href="#Lean.instantiateLevelMVars">Lean.instantiateLevelMVars</a></div><div class="nav_link"><a class="break_within" href="#Lean.instantiateExprMVars">Lean.instantiateExprMVars</a></div><div class="nav_link"><a class="break_within" href="#Lean.instMonadMCtxStateRefT'MetavarContextST">Lean.instMonadMCtxStateRefT'MetavarContextST</a></div><div class="nav_link"><a class="break_within" href="#Lean.instantiateMVarsCore">Lean.instantiateMVarsCore</a></div><div class="nav_link"><a class="break_within" href="#Lean.instantiateMVars">Lean.instantiateMVars</a></div><div class="nav_link"><a class="break_within" href="#Lean.instantiateLCtxMVars">Lean.instantiateLCtxMVars</a></div><div class="nav_link"><a class="break_within" href="#Lean.instantiateMVarDeclMVars">Lean.instantiateMVarDeclMVars</a></div><div class="nav_link"><a class="break_within" href="#Lean.instantiateLocalDeclMVars">Lean.instantiateLocalDeclMVars</a></div><div class="nav_link"><a class="break_within" href="#Lean.DependsOn.State">Lean.DependsOn.State</a></div><div class="nav_link"><a class="break_within" href="#Lean.DependsOn.instMonadMCtxM">Lean.DependsOn.instMonadMCtxM</a></div><div class="nav_link"><a class="break_within" href="#Lean.DependsOn.main">Lean.DependsOn.main</a></div><div class="nav_link"><a class="break_within" href="#Lean.findExprDependsOn">Lean.findExprDependsOn</a></div><div class="nav_link"><a class="break_within" href="#Lean.findLocalDeclDependsOn">Lean.findLocalDeclDependsOn</a></div><div class="nav_link"><a class="break_within" href="#Lean.exprDependsOn">Lean.exprDependsOn</a></div><div class="nav_link"><a class="break_within" href="#Lean.dependsOn">Lean.dependsOn</a></div><div class="nav_link"><a class="break_within" href="#Lean.localDeclDependsOn">Lean.localDeclDependsOn</a></div><div class="nav_link"><a class="break_within" href="#Lean.exprDependsOn'">Lean.exprDependsOn'</a></div><div class="nav_link"><a class="break_within" href="#Lean.localDeclDependsOn'">Lean.localDeclDependsOn'</a></div><div class="nav_link"><a class="break_within" href="#Lean.dependsOnPred">Lean.dependsOnPred</a></div><div class="nav_link"><a class="break_within" href="#Lean.localDeclDependsOnPred">Lean.localDeclDependsOnPred</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.instInhabitedMetavarContext">Lean.MetavarContext.instInhabitedMetavarContext</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.mkMetavarContext">Lean.MetavarContext.mkMetavarContext</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.addExprMVarDecl">Lean.MetavarContext.addExprMVarDecl</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.addExprMVarDeclExp">Lean.MetavarContext.addExprMVarDeclExp</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.addLevelMVarDecl">Lean.MetavarContext.addLevelMVarDecl</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.findDecl?">Lean.MetavarContext.findDecl?</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.findUserName?">Lean.MetavarContext.findUserName?</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.setMVarKind">Lean.MetavarContext.setMVarKind</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.setMVarUserName">Lean.MetavarContext.setMVarUserName</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.setMVarUserNameTemporarily">Lean.MetavarContext.setMVarUserNameTemporarily</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.setMVarType">Lean.MetavarContext.setMVarType</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.findLevelDepth?">Lean.MetavarContext.findLevelDepth?</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.getLevelDepth">Lean.MetavarContext.getLevelDepth</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.isAnonymousMVar">Lean.MetavarContext.isAnonymousMVar</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.incDepth">Lean.MetavarContext.incDepth</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.instMonadMCtxStateRefT'MetavarContextST">Lean.MetavarContext.instMonadMCtxStateRefT'MetavarContextST</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.MkBinding.Exception">Lean.MetavarContext.MkBinding.Exception</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.MkBinding.instToStringException">Lean.MetavarContext.MkBinding.instToStringException</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.MkBinding.State">Lean.MetavarContext.MkBinding.State</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.MkBinding.Context">Lean.MetavarContext.MkBinding.Context</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.MkBinding.MCore">Lean.MetavarContext.MkBinding.MCore</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.MkBinding.M">Lean.MetavarContext.MkBinding.M</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.MkBinding.instMonadMCtxM">Lean.MetavarContext.MkBinding.instMonadMCtxM</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.MkBinding.preserveOrder">Lean.MetavarContext.MkBinding.preserveOrder</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.MkBinding.instMonadHashMapCacheAdapterExprStructEqExprMInstBEqExprStructEqInstHashableExprStructEq">Lean.MetavarContext.MkBinding.instMonadHashMapCacheAdapterExprStructEqExprMInstBEqExprStructEqInstHashableExprStructEq</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.MkBinding.collectForwardDeps">Lean.MetavarContext.MkBinding.collectForwardDeps</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.MkBinding.reduceLocalContext">Lean.MetavarContext.MkBinding.reduceLocalContext</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.MkBinding.elimMVarDeps">Lean.MetavarContext.MkBinding.elimMVarDeps</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.MkBinding.revert">Lean.MetavarContext.MkBinding.revert</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.MkBinding.abstractRange">Lean.MetavarContext.MkBinding.abstractRange</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.MkBinding.mkBinding">Lean.MetavarContext.MkBinding.mkBinding</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.MkBindingM.Context">Lean.MetavarContext.MkBindingM.Context</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.MkBindingM">Lean.MetavarContext.MkBindingM</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.elimMVarDeps">Lean.MetavarContext.elimMVarDeps</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.revert">Lean.MetavarContext.revert</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.mkBinding">Lean.MetavarContext.mkBinding</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.mkLambda">Lean.MetavarContext.mkLambda</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.mkForall">Lean.MetavarContext.mkForall</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.abstractRange">Lean.MetavarContext.abstractRange</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.collectForwardDeps">Lean.MetavarContext.collectForwardDeps</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.isWellFormed">Lean.MetavarContext.isWellFormed</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.LevelMVarToParam.Context">Lean.MetavarContext.LevelMVarToParam.Context</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.LevelMVarToParam.State">Lean.MetavarContext.LevelMVarToParam.State</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.LevelMVarToParam.M">Lean.MetavarContext.LevelMVarToParam.M</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.LevelMVarToParam.instMonadMCtxM">Lean.MetavarContext.LevelMVarToParam.instMonadMCtxM</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.LevelMVarToParam.instMonadCacheExprStructEqExprM">Lean.MetavarContext.LevelMVarToParam.instMonadCacheExprStructEqExprM</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.LevelMVarToParam.mkParamName">Lean.MetavarContext.LevelMVarToParam.mkParamName</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.LevelMVarToParam.visitLevel">Lean.MetavarContext.LevelMVarToParam.visitLevel</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.LevelMVarToParam.main">Lean.MetavarContext.LevelMVarToParam.main</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.LevelMVarToParam.main.visitApp">Lean.MetavarContext.LevelMVarToParam.main.visitApp</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.UnivMVarParamResult">Lean.MetavarContext.UnivMVarParamResult</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.levelMVarToParam">Lean.MetavarContext.levelMVarToParam</a></div><div class="nav_link"><a class="break_within" href="#Lean.MetavarContext.getExprAssignmentDomain">Lean.MetavarContext.getExprAssignmentDomain</a></div></nav><main>
<div class="mod_doc"><p>The metavariable context stores metavariable declarations and their
assignments. It is used in the elaborator, tactic framework, unifier
(aka <code>isDefEq</code>), and type class resolution (TC). First, we list all
the requirements imposed by these modules.</p><ul>
<li>We may invoke TC while executing <code>isDefEq</code>. We need this feature to
be able to solve unification problems such as:</li>
</ul><pre><code>f ?a (ringAdd ?s) ?x ?y =?= f <a href=".././Init/Data/Int/Basic.html#Int">Int</a> intAdd n m
</code></pre><p>where <code>(?a : Type) (?s : Ring ?a) (?x ?y : ?a)</code>
During <code>isDefEq</code> (i.e., unification), it will need to solve the constrain</p><pre><code>ringAdd ?s =?= intAdd
</code></pre><p>We say <code>ringAdd ?s</code> is stuck because it cannot be reduced until we
synthesize the term <code>?s : Ring ?a</code> using TC. This can be done since we
have assigned <code>?a := <a href=".././Init/Data/Int/Basic.html#Int">Int</a></code> when solving <code>?a =?= <a href=".././Init/Data/Int/Basic.html#Int">Int</a></code>.</p><ul>
<li>
<p>TC uses <code>isDefEq</code>, and <code>isDefEq</code> may create TC problems as shown
above. Thus, we may have nested TC problems.</p>
</li>
<li>
<p><code>isDefEq</code> extends the local context when going inside binders. Thus,
the local context for nested TC may be an extension of the local
context for outer TC.</p>
</li>
<li>
<p>TC should not assign metavariables created by the elaborator, simp,
tactic framework, and outer TC problems. Reason: TC commits to the
first solution it finds. Consider the TC problem <code><a href=".././Init/Coe.html#Coe">Coe</a> <a href=".././Init/Prelude.html#Nat">Nat</a> ?x</code>,
where <code>?x</code> is a metavariable created by the caller. There are many
solutions to this problem (e.g., <code>?x := <a href=".././Init/Data/Int/Basic.html#Int">Int</a></code>, <code>?x := Real</code>, ...),
and it doesn’t make sense to commit to the first one since TC does
not know the constraints the caller may impose on <code>?x</code> after the
TC problem is solved.
Remark: we claim it is not feasible to make the whole system backtrackable,
and allow the caller to backtrack back to TC and ask it for another solution
if the first one found did not work. We claim it would be too inefficient.</p>
</li>
<li>
<p>TC metavariables should not leak outside of TC. Reason: we want to
get rid of them after we synthesize the instance.</p>
</li>
<li>
<p><code>simp</code> invokes <code>isDefEq</code> for matching the left-hand-side of
equations to terms in our goal. Thus, it may invoke TC indirectly.</p>
</li>
<li>
<p>In Lean3, we didn’t have to create a fresh pattern for trying to
match the left-hand-side of equations when executing <code>simp</code>. We had a
mechanism called "tmp" metavariables. It avoided this overhead, but it
created many problems since <code>simp</code> may indirectly call TC which may
recursively call TC. Moreover, we may want to allow TC to invoke
tactics in the future. Thus, when <code>simp</code> invokes <code>isDefEq</code>, it may indirectly invoke
a tactic and <code>simp</code> itself.  The Lean3 approach assumed that
metavariables were short-lived, this is not true in Lean4, and to some
extent was also not true in Lean3 since <code>simp</code>, in principle, could
trigger an arbitrary number of nested TC problems.</p>
</li>
<li>
<p>Here are some possible call stack traces we could have in Lean3 (and Lean4).</p>
</li>
</ul><pre><code>Elaborator (-> <a href=".././Init/Core.html#TC">TC</a> -> isDefEq)+
Elaborator -> isDefEq (-> <a href=".././Init/Core.html#TC">TC</a> -> isDefEq)*
Elaborator -> simp -> isDefEq (-> <a href=".././Init/Core.html#TC">TC</a> -> isDefEq)*
</code></pre><p>In Lean4, TC may also invoke tactics in the future.</p><ul>
<li>
<p>In Lean3 and Lean4, TC metavariables are not really short-lived. We
solve an arbitrary number of unification problems, and we may have
nested TC invocations.</p>
</li>
<li>
<p>TC metavariables do not share the same local context even in the
same invocation. In the C++ and Lean implementations we use a trick to
ensure they do:
https://github.com/leanprover/lean/blob/92826917a252a6092cffaf5fc5f1acb1f8cef379/src/library/type_context.cpp#L3583-L3594</p>
</li>
<li>
<p>Metavariables may be natural, synthetic or syntheticOpaque.
a) Natural metavariables may be assigned by unification (i.e., <code>isDefEq</code>).</p>
<p>b) Synthetic metavariables may still be assigned by unification,
but whenever possible <code>isDefEq</code> will avoid the assignment. For example,
if we have the unification constraint <code>?m =?= ?n</code>, where <code>?m</code> is synthetic,
but <code>?n</code> is not, <code>isDefEq</code> solves it by using the assignment <code>?n := ?m</code>.
We use synthetic metavariables for type class resolution.
Any module that creates synthetic metavariables, must also check
whether they have been assigned by <code>isDefEq</code>, and then still synthesize
them, and check whether the synthesized result is compatible with the one
assigned by <code>isDefEq</code>.</p>
<p>c) SyntheticOpaque metavariables are never assigned by <code>isDefEq</code>.
That is, the constraint <code>?n =?= <a href=".././Init/Prelude.html#Nat.succ">Nat.succ</a> <a href=".././Init/Prelude.html#Nat.zero">Nat.zero</a></code> always fail
if <code>?n</code> is a syntheticOpaque metavariable. This kind of metavariable
is created by tactics such as <code>intro</code>. Reason: in the tactic framework,
subgoals as represented as metavariables, and a subgoal <code>?n</code> is considered
as solved whenever the metavariable is assigned.</p>
<p>This distinction was not precise in Lean3 and produced
counterintuitive behavior. For example, the following hack was added
in Lean3 to work around one of these issues:
https://github.com/leanprover/lean/blob/92826917a252a6092cffaf5fc5f1acb1f8cef379/src/library/type_context.cpp#L2751</p>
</li>
<li>
<p>When creating lambda/forall expressions, we need to convert/abstract
free variables and convert them to bound variables. Now, suppose we a
trying to create a lambda/forall expression by abstracting free
variable <code>xs</code> and a term <code>t[?m]</code> which contains a metavariable <code>?m</code>,
and the local context of <code>?m</code> contains <code>xs</code>. The term</p>
</li>
</ul><pre><code>fun xs => t[?m]
</code></pre><p>will be ill-formed if we later assign a term <code>s</code> to <code>?m</code>, and
<code>s</code> contains free variables in <code>xs</code>. We address this issue by changing
the free variable abstraction procedure. We consider two cases: <code>?m</code>
is natural, <code>?m</code> is synthetic. Assume the type of <code>?m</code> is
<code>A[xs]</code>. Then, in both cases we create an auxiliary metavariable <code>?n</code> with
type <code>forall xs => A[xs]</code>, and local context := local context of <code>?m</code> - <code>xs</code>.
In both cases, we produce the term <code>fun xs => t[?n xs]</code></p><p>1- If <code>?m</code> is natural or synthetic, then we assign <code>?m := ?n xs</code>, and we produce
the term <code>fun xs => t[?n xs]</code></p><p>2- If <code>?m</code> is syntheticOpaque, then we mark <code>?n</code> as a syntheticOpaque variable.
However, <code>?n</code> is managed by the metavariable context itself.
We say we have a "delayed assignment" <code>?n xs := ?m</code>.
That is, after a term <code>s</code> is assigned to <code>?m</code>, and <code>s</code>
does not contain metavariables, we replace any occurrence
<code>?n ts</code> with <code>s[xs := ts]</code>.</p><p>Gruesome details:</p><ul>
<li>
<p>When we create the type <code>forall xs => A</code> for <code>?n</code>, we may
encounter the same issue if <code>A</code> contains metavariables. So, the
process above is recursive. We claim it terminates because we keep
creating new metavariables with smaller local contexts.</p>
</li>
<li>
<p>Suppose, we have <code>t[?m]</code> and we want to create a let-expression by
abstracting a let-decl free variable <code>x</code>, and the local context of
<code>?m</code> contains <code>x</code>. Similarly to the previous case</p>
</li>
</ul><pre><code>let x : T := v; t[?m]
</code></pre><p>will be ill-formed if we later assign a term <code>s</code> to <code>?m</code>, and
<code>s</code> contains free variable <code>x</code>. Again, assume the type of <code>?m</code> is <code>A[x]</code>.</p><pre><code>1- If `?m` is natural <a href=".././Init/Prelude.html#or">or</a> synthetic, then we create `?n : (let x : T := v; A[x])` with
<a href=".././Init/Prelude.html#and">and</a> local context := local context of `?m` - `x`, we <a href=".././Lean/MetavarContext.html#Lean.MVarId.assign">assign</a> `?m := ?n`,
<a href=".././Init/Prelude.html#and">and</a> produce the term `let x : T := v; t[?n]`. That is, we are just making
sure `?n` must never be assigned to a term containing `x`.

2- If `?m` is syntheticOpaque, we create a fresh syntheticOpaque `?n`
with type `?n : T -> (let x : T := v; A[x])` <a href=".././Init/Prelude.html#and">and</a> local context := local context of `?m` - `x`,
create the delayed assignment `?n #[x] := ?m`, <a href=".././Init/Prelude.html#and">and</a> produce the term `let x : T := v; t[?n x]`.
Now suppose we <a href=".././Lean/MetavarContext.html#Lean.MVarId.assign">assign</a> `s` to `?m`. We do <a href=".././Init/Prelude.html#not">not</a> <a href=".././Lean/MetavarContext.html#Lean.MVarId.assign">assign</a> the term `fun (x : T) => s` to `?n`, since
`fun (x : T) => s` may <a href=".././Init/Prelude.html#not">not</a> even be type correct. Instead, we just replace applications `?n r`
with `s[x/r]`. The term `r` may <a href=".././Init/Prelude.html#not">not</a> necessarily be a bound variable. For example, a tactic
may have reduced `let x : T := v; t[?n x]` into `t[?n v]`.
We are essentially using the pair "delayed assignment + application" to implement a delayed
substitution.
</code></pre><ul>
<li>We use TC for implementing coercions. Both Joe Hendrix and Reid Barton
reported a nasty limitation. In Lean3, TC will not be used if there are
metavariables in the TC problem. For example, the elaborator will not try
to synthesize <code><a href=".././Init/Coe.html#Coe">Coe</a> <a href=".././Init/Prelude.html#Nat">Nat</a> ?x</code>. This is good, but this constraint is too
strict for problems such as <code><a href=".././Init/Coe.html#Coe">Coe</a> (Vector <a href=".././Init/Prelude.html#Bool">Bool</a> ?n) (BV ?n)</code>. The coercion
exists independently of <code>?n</code>. Thus, during TC, we want <code>isDefEq</code> to throw
an exception instead of return <code>false</code> whenever it tries to assign
a metavariable owned by its caller. The idea is to sign to the caller that
it cannot solve the TC problem at this point, and more information is needed.
That is, the caller must make progress an assign its metavariables before
trying to invoke TC again.</li>
</ul><p>In Lean4, we are using a simpler design for the <code><a href=".././Lean/MetavarContext.html#Lean.MetavarContext">MetavarContext</a></code>.</p><ul>
<li>
<p>No distinction between temporary and regular metavariables.</p>
</li>
<li>
<p>Metavariables have a <code>depth</code> Nat field.</p>
</li>
<li>
<p>MetavarContext also has a <code>depth</code> field.</p>
</li>
<li>
<p>We bump the <code><a href=".././Lean/MetavarContext.html#Lean.MetavarContext">MetavarContext</a></code> depth when we create a nested problem.
Example: Elaborator (depth = 0) -> Simplifier matcher (depth = 1) -> TC (level = 2) -> TC (level = 3) -> ...</p>
</li>
<li>
<p>When <code><a href=".././Lean/MetavarContext.html#Lean.MetavarContext">MetavarContext</a></code> is at depth N, <code>isDefEq</code> does not assign variables from <code>depth < N</code>.</p>
</li>
<li>
<p>Metavariables from depth N+1 must be fully assigned before we return to level N.</p>
</li>
<li>
<p>New design even allows us to invoke tactics from TC.</p>
</li>
</ul><ul>
<li>
<p>Main concern
We don't have tmp metavariables anymore in Lean4. Thus, before trying to match
the left-hand-side of an equation in <code>simp</code>. We first must bump the level of the <code><a href=".././Lean/MetavarContext.html#Lean.MetavarContext">MetavarContext</a></code>,
create fresh metavariables, then create a new pattern by replacing the free variable on the left-hand-side with
these metavariables. We are hoping to minimize this overhead by</p>
<ul>
<li>
<p>Using better indexing data structures in <code>simp</code>. They should reduce the number of time <code>simp</code> must invoke <code>isDefEq</code>.</p>
</li>
<li>
<p>Implementing <code>isDefEqApprox</code> which ignores metavariables and returns only <code>false</code> or <code>undef</code>.
It is a quick filter that allows us to fail quickly and avoid the creation of new fresh metavariables,
and a new pattern.</p>
</li>
<li>
<p>Adding built-in support for arithmetic, Logical connectives, etc. Thus, we avoid a bunch of lemmas in the simp set.</p>
</li>
<li>
<p>Adding support for AC-rewriting. In Lean3, users use AC lemmas as
rewriting rules for "sorting" terms. This is inefficient, requires
a quadratic number of rewrite steps, and does not preserve the
structure of the goal.</p>
</li>
</ul>
</li>
</ul><p>The temporary metavariables were also used in the "app builder" module used in Lean3. The app builder uses
<code>isDefEq</code>. So, it could, in principle, invoke an arbitrary number of nested TC problems. However, in Lean3,
all app builder uses are controlled. That is, it is mainly used to synthesize implicit arguments using
very simple unification and/or non-nested TC. So, if the "app builder" becomes a bottleneck without tmp metavars,
we may solve the issue by implementing <code>isDefEqCheap</code> that never invokes TC and uses tmp metavars.</p></div><div class="decl" id="Lean.LocalInstance"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L227-L230">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.LocalInstance">Lean.LocalInstance</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.LocalInstance.mk"><li id="Lean.LocalInstance.className" class="structure_field"><div class="structure_field_info">className : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a></div></li><li id="Lean.LocalInstance.fvar" class="structure_field"><div class="structure_field_info">fvar : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></div></li></ul><p><code><a href=".././Lean/MetavarContext.html#Lean.LocalInstance">LocalInstance</a></code> represents a local typeclass instance registered by and for
the elaborator. It stores the name of the typeclass in <code>className</code>, and the
concrete typeclass instance in <code>fvar</code>. Note that the kernel does not care about
this information, since typeclasses are entirely eliminated during elaboration.</p><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.LocalInstance" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.instInhabitedLocalInstance"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L230-L230">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.instInhabitedLocalInstance">Lean.instInhabitedLocalInstance</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/MetavarContext.html#Lean.LocalInstance">Lean.LocalInstance</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.instInhabitedLocalInstance">Lean.instInhabitedLocalInstance</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">default</span> := <span class="fn">{ <span class="fn">className</span> := <span class="fn">default</span>, <span class="fn">fvar</span> := <span class="fn">default</span> }</span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.LocalInstances"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L232-L232">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.LocalInstances">Lean.LocalInstances</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.LocalInstances">Lean.LocalInstances</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/MetavarContext.html#Lean.LocalInstance">Lean.LocalInstance</a></span></span></li></ul></details></div></div><div class="decl" id="Lean.instBEqLocalInstance"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L234-L235">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.instBEqLocalInstance">Lean.instBEqLocalInstance</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#BEq">BEq</a> <a href=".././Lean/MetavarContext.html#Lean.LocalInstance">Lean.LocalInstance</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.instBEqLocalInstance">Lean.instBEqLocalInstance</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">beq</span> := <span class="fn">fun <span class="fn">i₁</span> <span class="fn">i₂</span> =&gt <span class="fn"><span class="fn"><span class="fn">i₁</span>.fvar</span> <a href=".././Init/Prelude.html#BEq.beq">==</a> <span class="fn"><span class="fn">i₂</span>.fvar</span></span></span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.LocalInstances.erase"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L238-L241">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.LocalInstances.erase">Lean.LocalInstances.erase</a></span><span class="decl_args">
<span class="fn">(localInsts : <a href=".././Lean/MetavarContext.html#Lean.LocalInstances">Lean.LocalInstances</a>)</span></span>
<span class="decl_args">
<span class="fn">(fvarId : <a href=".././Lean/Expr.html#Lean.FVarId">Lean.FVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/MetavarContext.html#Lean.LocalInstances">Lean.LocalInstances</a></div></div><p>Remove local instance with the given <code>fvarId</code>. Do nothing if <code>localInsts</code> does not contain any free variable with id <code>fvarId</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MetavarKind"><div class="inductive"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L245-L252">source</a></div><div class="decl_header"><span class="decl_kind">inductive</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarKind">Lean.MetavarKind</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="constructors"><li class="constructor" id="Lean.MetavarKind.natural"><div class="inductive_ctor_doc"><p>Normal unification behaviour</p></div>natural: <a href=".././Lean/MetavarContext.html#Lean.MetavarKind">Lean.MetavarKind</a></li><li class="constructor" id="Lean.MetavarKind.synthetic"><div class="inductive_ctor_doc"><p><code>isDefEq</code> avoids assignment</p></div>synthetic: <a href=".././Lean/MetavarContext.html#Lean.MetavarKind">Lean.MetavarKind</a></li><li class="constructor" id="Lean.MetavarKind.syntheticOpaque"><div class="inductive_ctor_doc"><p>Never assigned by isDefEq</p></div>syntheticOpaque: <a href=".././Lean/MetavarContext.html#Lean.MetavarKind">Lean.MetavarKind</a></li></ul><p>A kind for the metavariable that determines its unification behaviour.
For more information see the large comment at the beginning of this file.</p><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.MetavarKind" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.instInhabitedMetavarKind"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L252-L252">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.instInhabitedMetavarKind">Lean.instInhabitedMetavarKind</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/MetavarContext.html#Lean.MetavarKind">Lean.MetavarKind</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.instInhabitedMetavarKind">Lean.instInhabitedMetavarKind</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">default</span> := <a href=".././Lean/MetavarContext.html#Lean.MetavarKind.natural">Lean.MetavarKind.natural</a> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.instReprMetavarKind"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L252-L252">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.instReprMetavarKind">Lean.instReprMetavarKind</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Data/Repr.html#Repr">Repr</a> <a href=".././Lean/MetavarContext.html#Lean.MetavarKind">Lean.MetavarKind</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.instReprMetavarKind">Lean.instReprMetavarKind</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">reprPrec</span> := <a href=".././Lean/MetavarContext.html#_private.Lean.MetavarContext.0.Lean.reprMetavarKind._@.Lean.MetavarContext._hyg.130">Lean.reprMetavarKind✝</a> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.MetavarKind.isSyntheticOpaque"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L254-L256">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarKind.isSyntheticOpaque">Lean.MetavarKind.isSyntheticOpaque</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarKind">Lean.MetavarKind</a> → <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarKind.isSyntheticOpaque">Lean.MetavarKind.isSyntheticOpaque</a> <span class="fn">x</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn">match <span class="fn">x</span> with
  | <span class="fn">Lean.MetavarKind.syntheticOpaque</span> =&gt <a href=".././Init/Prelude.html#Bool.true">true</a>
  | <span class="fn">x</span> =&gt <span class="fn">false</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.MetavarKind.isNatural"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L258-L260">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarKind.isNatural">Lean.MetavarKind.isNatural</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarKind">Lean.MetavarKind</a> → <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarKind.isNatural">Lean.MetavarKind.isNatural</a> <span class="fn">x</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn">match <span class="fn">x</span> with
  | <span class="fn">Lean.MetavarKind.natural</span> =&gt <a href=".././Init/Prelude.html#Bool.true">true</a>
  | <span class="fn">x</span> =&gt <span class="fn">false</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.MetavarDecl"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L263-L284">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarDecl">Lean.MetavarDecl</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.MetavarDecl.mk"><li id="Lean.MetavarDecl.userName" class="structure_field"><div class="structure_field_doc"><p>A user-friendly name for the metavariable. If anonymous then there is no such name.</p></div><div class="structure_field_info">userName : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a></div></li><li id="Lean.MetavarDecl.lctx" class="structure_field"><div class="structure_field_doc"><p>The local context containing the free variables that the mvar is permitted to depend upon.</p></div><div class="structure_field_info">lctx : <a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a></div></li><li id="Lean.MetavarDecl.type" class="structure_field"><div class="structure_field_doc"><p>The type of the metavarible, in the given <code>lctx</code>.</p></div><div class="structure_field_info">type : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></div></li><li id="Lean.MetavarDecl.depth" class="structure_field"><div class="structure_field_doc"><p>The nesting depth of this metavariable. We do not want
unification subproblems to influence the results of parent
problems. The depth keeps track of this information and ensures
that unification subproblems cannot leak information out, by unifying
based on depth.</p></div><div class="structure_field_info">depth : <a href=".././Init/Prelude.html#Nat">Nat</a></div></li><li id="Lean.MetavarDecl.localInstances" class="structure_field"><div class="structure_field_info">localInstances : <a href=".././Lean/MetavarContext.html#Lean.LocalInstances">Lean.LocalInstances</a></div></li><li id="Lean.MetavarDecl.kind" class="structure_field"><div class="structure_field_info">kind : <a href=".././Lean/MetavarContext.html#Lean.MetavarKind">Lean.MetavarKind</a></div></li><li id="Lean.MetavarDecl.numScopeArgs" class="structure_field"><div class="structure_field_doc"><p>See comment at <code>CheckAssignment</code> <code>Meta/ExprDefEq.lean</code></p></div><div class="structure_field_info">numScopeArgs : <a href=".././Init/Prelude.html#Nat">Nat</a></div></li><li id="Lean.MetavarDecl.index" class="structure_field"><div class="structure_field_doc"><p>We use this field to track how old a metavariable is. It is set using a counter at <code><a href=".././Lean/MetavarContext.html#Lean.MetavarContext">MetavarContext</a></code></p></div><div class="structure_field_info">index : <a href=".././Init/Prelude.html#Nat">Nat</a></div></li></ul><p>Information about a metavariable.</p><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.MetavarDecl" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.instInhabitedMetavarDecl"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L284-L284">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.instInhabitedMetavarDecl">Lean.instInhabitedMetavarDecl</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/MetavarContext.html#Lean.MetavarDecl">Lean.MetavarDecl</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.DelayedMetavarAssignment"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L300-L302">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.DelayedMetavarAssignment">Lean.DelayedMetavarAssignment</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.DelayedMetavarAssignment.mk"><li id="Lean.DelayedMetavarAssignment.fvars" class="structure_field"><div class="structure_field_info">fvars : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></div></li><li id="Lean.DelayedMetavarAssignment.mvarIdPending" class="structure_field"><div class="structure_field_info">mvarIdPending : <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a></div></li></ul><p>A delayed assignment for a metavariable <code>?m</code>. It represents an assignment of the form <code>?m := (fun fvars => (mkMVar mvarIdPending))</code>.
<code>mvarIdPending</code> is a <code>syntheticOpaque</code> metavariable that has not been synthesized yet. The delayed assignment becomes a real one
as soon as <code>mvarIdPending</code> has been fully synthesized.
<code>fvars</code> are variables in the <code>mvarIdPending</code> local context.</p><p>See the comment below <code><a href=".././Lean/MetavarContext.html#Lean.assignDelayedMVar">assignDelayedMVar</a> </code> for the rationale of delayed assignments.</p><p>Recall that we use a locally nameless approach when dealing with binders. Suppose we are
trying to synthesize <code>?n</code> in the expression <code>e</code>, in the context of <code>(fun x => e)</code>.
The metavariable <code>?n</code> might depend on the bound variable <code>x</code>. However, since we are locally nameless,
the bound variable <code>x</code> is in fact represented by some free variable <code>fvar_x</code>. Thus, when we exit
the scope, we must rebind the value of <code>fvar_x</code> in <code>?n</code> to the de-bruijn index of the bound variable <code>x</code>.</p><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.DelayedMetavarAssignment" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.MetavarContext"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L308-L324">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.MetavarContext.mk"><li id="Lean.MetavarContext.depth" class="structure_field"><div class="structure_field_doc"><p>Depth is used to control whether an mvar can be assigned in unification.</p></div><div class="structure_field_info">depth : <a href=".././Init/Prelude.html#Nat">Nat</a></div></li><li id="Lean.MetavarContext.mvarCounter" class="structure_field"><div class="structure_field_doc"><p>Counter for setting the field <code>index</code> at <code><a href=".././Lean/MetavarContext.html#Lean.MetavarDecl">MetavarDecl</a></code></p></div><div class="structure_field_info">mvarCounter : <a href=".././Init/Prelude.html#Nat">Nat</a></div></li><li id="Lean.MetavarContext.lDepth" class="structure_field"><div class="structure_field_info">lDepth : <span class="fn"><a href=".././Lean/Data/PersistentHashMap.html#Lean.PersistentHashMap">Lean.PersistentHashMap</a> <a href=".././Lean/Level.html#Lean.LMVarId">Lean.LMVarId</a> <a href=".././Init/Prelude.html#Nat">Nat</a></span></div></li><li id="Lean.MetavarContext.decls" class="structure_field"><div class="structure_field_doc"><p>Metavariable declarations.</p></div><div class="structure_field_info">decls : <span class="fn"><a href=".././Lean/Data/PersistentHashMap.html#Lean.PersistentHashMap">Lean.PersistentHashMap</a> <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a> <a href=".././Lean/MetavarContext.html#Lean.MetavarDecl">Lean.MetavarDecl</a></span></div></li><li id="Lean.MetavarContext.userNames" class="structure_field"><div class="structure_field_doc"><p>Index mapping user-friendly names to ids.</p></div><div class="structure_field_info">userNames : <span class="fn"><a href=".././Lean/Data/PersistentHashMap.html#Lean.PersistentHashMap">Lean.PersistentHashMap</a> <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a> <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a></span></div></li><li id="Lean.MetavarContext.lAssignment" class="structure_field"><div class="structure_field_doc"><p>Assignment table for universe level metavariables.</p></div><div class="structure_field_info">lAssignment : <span class="fn"><a href=".././Lean/Data/PersistentHashMap.html#Lean.PersistentHashMap">Lean.PersistentHashMap</a> <a href=".././Lean/Level.html#Lean.LMVarId">Lean.LMVarId</a> <a href=".././Lean/Level.html#Lean.Level">Lean.Level</a></span></div></li><li id="Lean.MetavarContext.eAssignment" class="structure_field"><div class="structure_field_doc"><p>Assignment table for expression metavariables.</p></div><div class="structure_field_info">eAssignment : <span class="fn"><a href=".././Lean/Data/PersistentHashMap.html#Lean.PersistentHashMap">Lean.PersistentHashMap</a> <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></div></li><li id="Lean.MetavarContext.dAssignment" class="structure_field"><div class="structure_field_doc"><p>Assignment table for delayed abstraction metavariables.
For more information about delayed abstraction, see the docstring for <code><a href=".././Lean/MetavarContext.html#Lean.DelayedMetavarAssignment">DelayedMetavarAssignment</a></code>.</p></div><div class="structure_field_info">dAssignment : <span class="fn"><a href=".././Lean/Data/PersistentHashMap.html#Lean.PersistentHashMap">Lean.PersistentHashMap</a> <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a> <a href=".././Lean/MetavarContext.html#Lean.DelayedMetavarAssignment">Lean.DelayedMetavarAssignment</a></span></div></li></ul><p>The metavariable context is a set of metavariable declarations and their assignments.</p><p>For more information on specifics see the comment in the file that <code><a href=".././Lean/MetavarContext.html#Lean.MetavarContext">MetavarContext</a></code> is defined in.</p><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.MetavarContext" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.MonadMCtx"><div class="class"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L327-L329">source</a></div><div class="decl_header"><span class="decl_kind">class</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a></span><span class="decl_args">
<span class="fn">(m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.MonadMCtx.mk"><li id="Lean.MonadMCtx.getMCtx" class="structure_field"><div class="structure_field_info">getMCtx : <span class="fn"><span class="fn">m</span> <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a></span></div></li><li id="Lean.MonadMCtx.modifyMCtx" class="structure_field"><div class="structure_field_info">modifyMCtx : <span class="fn">(<span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a> → <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a></span>) → <span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Unit">Unit</a></span></span></div></li></ul><p>A monad with a stateful metavariable context, defining <code>getMCtx</code> and <code>modifyMCtx</code>.</p><details class="instances"><summary>Instances</summary><ul id="instances-list-Lean.MonadMCtx" class="instances-list"></ul></details></div></div><div class="decl" id="Lean.instMonadMCtx"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L334-L336">source</a></div><div class="attributes">@[always_inline]</div>
<div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.instMonadMCtx">Lean.instMonadMCtx</a></span><span class="decl_args">
<span class="fn">(m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(n : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>)</span></span>
<span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#MonadLift">MonadLift</a> <span class="fn">m</span> <span class="fn">n</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">n</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.instMonadMCtx">Lean.instMonadMCtx</a> <span class="fn">m</span> <span class="fn">n</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">getMCtx</span> := <span class="fn"><a href=".././Init/Prelude.html#liftM">liftM</a> <span class="fn">Lean.getMCtx</span></span>, <span class="fn">modifyMCtx</span> := <span class="fn">fun <span class="fn">f</span> =&gt <span class="fn"><a href=".././Init/Prelude.html#liftM">liftM</a> (<span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx.modifyMCtx">Lean.modifyMCtx</a> <span class="fn">f</span></span>)</span></span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.setMCtx"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L338-L339">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.setMCtx">Lean.setMCtx</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(mctx : <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.setMCtx">Lean.setMCtx</a> <span class="fn">mctx</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx.modifyMCtx">Lean.modifyMCtx</a> <span class="fn">fun <span class="fn">x</span> =&gt <span class="fn">mctx</span></span></span></span></li></ul></details></div></div><div class="decl" id="Lean.getLevelMVarAssignment?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L341-L342">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.getLevelMVarAssignment?">Lean.getLevelMVarAssignment?</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Level.html#Lean.LMVarId">Lean.LMVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> (<span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Lean/Level.html#Lean.Level">Lean.Level</a></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.getLevelMVarAssignment?">Lean.getLevelMVarAssignment?</a> <span class="fn">mvarId</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let __do_lift ← <span class="fn">Lean.getMCtx</span>
  <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> (<span class="fn"><a href=".././Lean/Data/PersistentHashMap.html#Lean.PersistentHashMap.find?">Lean.PersistentHashMap.find?</a> <span class="fn"><span class="fn">__do_lift</span>.lAssignment</span> <span class="fn">mvarId</span></span>)</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.getExprAssignmentCore?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L344-L345">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.getExprAssignmentCore?">Lean.MetavarContext.getExprAssignmentCore?</a></span><span class="decl_args">
<span class="fn">(m : <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.getExprAssignmentCore?">Lean.MetavarContext.getExprAssignmentCore?</a> <span class="fn">m</span> <span class="fn">mvarId</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Data/PersistentHashMap.html#Lean.PersistentHashMap.find?">Lean.PersistentHashMap.find?</a> <span class="fn"><span class="fn">m</span>.eAssignment</span> <span class="fn">mvarId</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.getExprMVarAssignment?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L347-L348">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.getExprMVarAssignment?">Lean.getExprMVarAssignment?</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> (<span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.getExprMVarAssignment?">Lean.getExprMVarAssignment?</a> <span class="fn">mvarId</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let __do_lift ← <span class="fn">Lean.getMCtx</span>
  <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> (<span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.getExprAssignmentCore?">Lean.MetavarContext.getExprAssignmentCore?</a> <span class="fn">__do_lift</span> <span class="fn">mvarId</span></span>)</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.getDelayedMVarAssignment?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L350-L351">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.getDelayedMVarAssignment?">Lean.getDelayedMVarAssignment?</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> (<span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Lean/MetavarContext.html#Lean.DelayedMetavarAssignment">Lean.DelayedMetavarAssignment</a></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.getDelayedMVarAssignment?">Lean.getDelayedMVarAssignment?</a> <span class="fn">mvarId</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let __do_lift ← <span class="fn">Lean.getMCtx</span>
  <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> (<span class="fn"><a href=".././Lean/Data/PersistentHashMap.html#Lean.PersistentHashMap.find?">Lean.PersistentHashMap.find?</a> <span class="fn"><span class="fn">__do_lift</span>.dAssignment</span> <span class="fn">mvarId</span></span>)</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.getDelayedMVarRoot"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L361-L364">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.getDelayedMVarRoot">Lean.getDelayedMVarRoot</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a></span></div></div><p>Given a sequence of delayed assignments</p><pre><code>mvarId₁ := mvarId₂ ...;
...
mvarIdₙ := mvarId_root ...  -- where `mvarId_root` is <a href=".././Init/Prelude.html#not">not</a> delayed assigned
</code></pre><p>in <code>mctx</code>, <code>getDelayedRoot mctx mvarId₁</code> return <code>mvarId_root</code>.
If <code>mvarId₁</code> is not delayed assigned then return <code>mvarId₁</code></p></div></div><div class="decl" id="Lean.isLevelMVarAssigned"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L366-L367">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.isLevelMVarAssigned">Lean.isLevelMVarAssigned</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Level.html#Lean.LMVarId">Lean.LMVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.isLevelMVarAssigned">Lean.isLevelMVarAssigned</a> <span class="fn">mvarId</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let __do_lift ← <span class="fn">Lean.getMCtx</span>
  <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> (<span class="fn"><a href=".././Lean/Data/PersistentHashMap.html#Lean.PersistentHashMap.contains">Lean.PersistentHashMap.contains</a> <span class="fn"><span class="fn">__do_lift</span>.lAssignment</span> <span class="fn">mvarId</span></span>)</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.MVarId.isAssigned"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L370-L371">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MVarId.isAssigned">Lean.MVarId.isAssigned</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><p>Return <code>true</code> if the give metavariable is already assigned.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MVarId.isAssigned">Lean.MVarId.isAssigned</a> <span class="fn">mvarId</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let __do_lift ← <span class="fn">Lean.getMCtx</span>
  <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> (<span class="fn"><a href=".././Lean/Data/PersistentHashMap.html#Lean.PersistentHashMap.contains">Lean.PersistentHashMap.contains</a> <span class="fn"><span class="fn">__do_lift</span>.eAssignment</span> <span class="fn">mvarId</span></span>)</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.isExprMVarAssigned"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L374-L375">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.isExprMVarAssigned">Lean.isExprMVarAssigned</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.isExprMVarAssigned">Lean.isExprMVarAssigned</a> <span class="fn">mvarId</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MVarId.isAssigned">Lean.MVarId.isAssigned</a> <span class="fn">mvarId</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.MVarId.isDelayedAssigned"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L377-L378">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MVarId.isDelayedAssigned">Lean.MVarId.isDelayedAssigned</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MVarId.isDelayedAssigned">Lean.MVarId.isDelayedAssigned</a> <span class="fn">mvarId</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let __do_lift ← <span class="fn">Lean.getMCtx</span>
  <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> (<span class="fn"><a href=".././Lean/Data/PersistentHashMap.html#Lean.PersistentHashMap.contains">Lean.PersistentHashMap.contains</a> <span class="fn"><span class="fn">__do_lift</span>.dAssignment</span> <span class="fn">mvarId</span></span>)</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.isMVarDelayedAssigned"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L381-L382">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.isMVarDelayedAssigned">Lean.isMVarDelayedAssigned</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.isMVarDelayedAssigned">Lean.isMVarDelayedAssigned</a> <span class="fn">mvarId</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MVarId.isDelayedAssigned">Lean.MVarId.isDelayedAssigned</a> <span class="fn">mvarId</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.isLevelMVarAssignable"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L384-L388">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.isLevelMVarAssignable">Lean.isLevelMVarAssignable</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Level.html#Lean.LMVarId">Lean.LMVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.getDecl"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L390-L393">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.getDecl">Lean.MetavarContext.getDecl</a></span><span class="decl_args">
<span class="fn">(mctx : <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/MetavarContext.html#Lean.MetavarDecl">Lean.MetavarDecl</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MVarId.isAssignable"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L395-L398">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MVarId.isAssignable">Lean.MVarId.isAssignable</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MVarId.isAssignable">Lean.MVarId.isAssignable</a> <span class="fn">mvarId</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let mctx ← <span class="fn">Lean.getMCtx</span>
  let decl : <a href=".././Lean/MetavarContext.html#Lean.MetavarDecl">Lean.MetavarDecl</a> := <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.getDecl">Lean.MetavarContext.getDecl</a> <span class="fn">mctx</span> <span class="fn">mvarId</span></span>
  <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> (<span class="fn"><span class="fn"><span class="fn">decl</span>.depth</span> <a href=".././Init/Prelude.html#BEq.beq">==</a> <span class="fn"><span class="fn">mctx</span>.depth</span></span>)</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.isExprMVarAssignable"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L401-L402">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.isExprMVarAssignable">Lean.isExprMVarAssignable</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.isExprMVarAssignable">Lean.isExprMVarAssignable</a> <span class="fn">mvarId</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MVarId.isAssignable">Lean.MVarId.isAssignable</a> <span class="fn">mvarId</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.hasAssignedLevelMVar"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L405-L411">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.hasAssignedLevelMVar">Lean.hasAssignedLevelMVar</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Level.html#Lean.Level">Lean.Level</a> → <span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Bool">Bool</a></span></span></div></div><p>Return true iff the given level contains an assigned metavariable.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignedLevelMVar">Lean.hasAssignedLevelMVar</a> (<span class="fn"><a href=".././Lean/Level.html#Lean.Level.succ">Lean.Level.succ</a> <span class="fn">lvl</span></span>)</span> <a href=".././Init/Prelude.html#Eq">=</a> (<span class="fn"><span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> (<span class="fn"><a href=".././Lean/Level.html#Lean.Level.hasMVar">Lean.Level.hasMVar</a> <span class="fn">lvl</span></span>)</span> <a href=".././Init/Control/Basic.html#andM">&lt&amp&amp&gt</a> <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignedLevelMVar">Lean.hasAssignedLevelMVar</a> <span class="fn">lvl</span></span></span>)</span></li><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignedLevelMVar">Lean.hasAssignedLevelMVar</a> (<span class="fn"><a href=".././Lean/Level.html#Lean.Level.mvar">Lean.Level.mvar</a> <span class="fn">mvarId</span></span>)</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.isLevelMVarAssigned">Lean.isLevelMVarAssigned</a> <span class="fn">mvarId</span></span></span></li><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignedLevelMVar">Lean.hasAssignedLevelMVar</a> <a href=".././Lean/Level.html#Lean.Level.zero">Lean.Level.zero</a></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> <a href=".././Init/Prelude.html#Bool.false">false</a></span></span></li><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignedLevelMVar">Lean.hasAssignedLevelMVar</a> (<span class="fn"><a href=".././Lean/Level.html#Lean.Level.param">Lean.Level.param</a> <span class="fn">a</span></span>)</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> <a href=".././Init/Prelude.html#Bool.false">false</a></span></span></li></ul></details></div></div><div class="decl" id="Lean.hasAssignedMVar"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L414-L426">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.hasAssignedMVar">Lean.hasAssignedMVar</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Bool">Bool</a></span></span></div></div><p>Return <code>true</code> iff expression contains assigned (level/expr) metavariables or delayed assigned mvars</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignedMVar">Lean.hasAssignedMVar</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.const">Lean.Expr.const</a> <span class="fn">declName</span> <span class="fn">lvls</span></span>)</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Data/List/Control.html#List.anyM">List.anyM</a> <span class="fn">Lean.hasAssignedLevelMVar</span> <span class="fn">lvls</span></span></span></li><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignedMVar">Lean.hasAssignedMVar</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.sort">Lean.Expr.sort</a> <span class="fn">lvl</span></span>)</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignedLevelMVar">Lean.hasAssignedLevelMVar</a> <span class="fn">lvl</span></span></span></li><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignedMVar">Lean.hasAssignedMVar</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.app">Lean.Expr.app</a> <span class="fn">f</span> <span class="fn">a</span></span>)</span> <a href=".././Init/Prelude.html#Eq">=</a>   (<span class="fn"><span class="fn"><span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.hasMVar">Lean.Expr.hasMVar</a> <span class="fn">f</span></span>)</span> <a href=".././Init/Control/Basic.html#andM">&lt&amp&amp&gt</a> <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignedMVar">Lean.hasAssignedMVar</a> <span class="fn">f</span></span></span> <a href=".././Init/Control/Basic.html#orM">&lt||&gt</a> <span class="fn"><span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.hasMVar">Lean.Expr.hasMVar</a> <span class="fn">a</span></span>)</span> <a href=".././Init/Control/Basic.html#andM">&lt&amp&amp&gt</a> <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignedMVar">Lean.hasAssignedMVar</a> <span class="fn">a</span></span></span></span>)</span></li><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignedMVar">Lean.hasAssignedMVar</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.fvar">Lean.Expr.fvar</a> <span class="fn">fvarId</span></span>)</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> <a href=".././Init/Prelude.html#Bool.false">false</a></span></span></li><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignedMVar">Lean.hasAssignedMVar</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.bvar">Lean.Expr.bvar</a> <span class="fn">deBruijnIndex</span></span>)</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> <a href=".././Init/Prelude.html#Bool.false">false</a></span></span></li><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignedMVar">Lean.hasAssignedMVar</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.lit">Lean.Expr.lit</a> <span class="fn">a</span></span>)</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> <a href=".././Init/Prelude.html#Bool.false">false</a></span></span></li><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignedMVar">Lean.hasAssignedMVar</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.mdata">Lean.Expr.mdata</a> <span class="fn">data</span> <span class="fn">e</span></span>)</span> <a href=".././Init/Prelude.html#Eq">=</a> (<span class="fn"><span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.hasMVar">Lean.Expr.hasMVar</a> <span class="fn">e</span></span>)</span> <a href=".././Init/Control/Basic.html#andM">&lt&amp&amp&gt</a> <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignedMVar">Lean.hasAssignedMVar</a> <span class="fn">e</span></span></span>)</span></li><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignedMVar">Lean.hasAssignedMVar</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.proj">Lean.Expr.proj</a> <span class="fn">typeName</span> <span class="fn">idx</span> <span class="fn">e</span></span>)</span> <a href=".././Init/Prelude.html#Eq">=</a> (<span class="fn"><span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.hasMVar">Lean.Expr.hasMVar</a> <span class="fn">e</span></span>)</span> <a href=".././Init/Control/Basic.html#andM">&lt&amp&amp&gt</a> <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignedMVar">Lean.hasAssignedMVar</a> <span class="fn">e</span></span></span>)</span></li><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignedMVar">Lean.hasAssignedMVar</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.mvar">Lean.Expr.mvar</a> <span class="fn">mvarId</span></span>)</span> <a href=".././Init/Prelude.html#Eq">=</a> (<span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MVarId.isAssigned">Lean.MVarId.isAssigned</a> <span class="fn">mvarId</span></span> <a href=".././Init/Control/Basic.html#orM">&lt||&gt</a> <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MVarId.isDelayedAssigned">Lean.MVarId.isDelayedAssigned</a> <span class="fn">mvarId</span></span></span>)</span></li></ul></details></div></div><div class="decl" id="Lean.hasAssignableLevelMVar"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L429-L435">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.hasAssignableLevelMVar">Lean.hasAssignableLevelMVar</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Level.html#Lean.Level">Lean.Level</a> → <span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Bool">Bool</a></span></span></div></div><p>Return true iff the given level contains a metavariable that can be assigned.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignableLevelMVar">Lean.hasAssignableLevelMVar</a> (<span class="fn"><a href=".././Lean/Level.html#Lean.Level.succ">Lean.Level.succ</a> <span class="fn">lvl</span></span>)</span> <a href=".././Init/Prelude.html#Eq">=</a> (<span class="fn"><span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> (<span class="fn"><a href=".././Lean/Level.html#Lean.Level.hasMVar">Lean.Level.hasMVar</a> <span class="fn">lvl</span></span>)</span> <a href=".././Init/Control/Basic.html#andM">&lt&amp&amp&gt</a> <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignableLevelMVar">Lean.hasAssignableLevelMVar</a> <span class="fn">lvl</span></span></span>)</span></li><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignableLevelMVar">Lean.hasAssignableLevelMVar</a> (<span class="fn"><a href=".././Lean/Level.html#Lean.Level.mvar">Lean.Level.mvar</a> <span class="fn">mvarId</span></span>)</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.isLevelMVarAssignable">Lean.isLevelMVarAssignable</a> <span class="fn">mvarId</span></span></span></li><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignableLevelMVar">Lean.hasAssignableLevelMVar</a> <a href=".././Lean/Level.html#Lean.Level.zero">Lean.Level.zero</a></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> <a href=".././Init/Prelude.html#Bool.false">false</a></span></span></li><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignableLevelMVar">Lean.hasAssignableLevelMVar</a> (<span class="fn"><a href=".././Lean/Level.html#Lean.Level.param">Lean.Level.param</a> <span class="fn">a</span></span>)</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> <a href=".././Init/Prelude.html#Bool.false">false</a></span></span></li></ul></details></div></div><div class="decl" id="Lean.hasAssignableMVar"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L438-L450">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.hasAssignableMVar">Lean.hasAssignableMVar</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Bool">Bool</a></span></span></div></div><p>Return <code>true</code> iff expression contains a metavariable that can be assigned.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignableMVar">Lean.hasAssignableMVar</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.const">Lean.Expr.const</a> <span class="fn">declName</span> <span class="fn">lvls</span></span>)</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Data/List/Control.html#List.anyM">List.anyM</a> <span class="fn">Lean.hasAssignableLevelMVar</span> <span class="fn">lvls</span></span></span></li><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignableMVar">Lean.hasAssignableMVar</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.sort">Lean.Expr.sort</a> <span class="fn">lvl</span></span>)</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignableLevelMVar">Lean.hasAssignableLevelMVar</a> <span class="fn">lvl</span></span></span></li><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignableMVar">Lean.hasAssignableMVar</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.app">Lean.Expr.app</a> <span class="fn">f</span> <span class="fn">a</span></span>)</span> <a href=".././Init/Prelude.html#Eq">=</a>   (<span class="fn"><span class="fn"><span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.hasMVar">Lean.Expr.hasMVar</a> <span class="fn">f</span></span>)</span> <a href=".././Init/Control/Basic.html#andM">&lt&amp&amp&gt</a> <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignableMVar">Lean.hasAssignableMVar</a> <span class="fn">f</span></span></span> <a href=".././Init/Control/Basic.html#orM">&lt||&gt</a>     <span class="fn"><span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.hasMVar">Lean.Expr.hasMVar</a> <span class="fn">a</span></span>)</span> <a href=".././Init/Control/Basic.html#andM">&lt&amp&amp&gt</a> <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignableMVar">Lean.hasAssignableMVar</a> <span class="fn">a</span></span></span></span>)</span></li><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignableMVar">Lean.hasAssignableMVar</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.fvar">Lean.Expr.fvar</a> <span class="fn">fvarId</span></span>)</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> <a href=".././Init/Prelude.html#Bool.false">false</a></span></span></li><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignableMVar">Lean.hasAssignableMVar</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.bvar">Lean.Expr.bvar</a> <span class="fn">deBruijnIndex</span></span>)</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> <a href=".././Init/Prelude.html#Bool.false">false</a></span></span></li><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignableMVar">Lean.hasAssignableMVar</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.lit">Lean.Expr.lit</a> <span class="fn">a</span></span>)</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> <a href=".././Init/Prelude.html#Bool.false">false</a></span></span></li><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignableMVar">Lean.hasAssignableMVar</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.mdata">Lean.Expr.mdata</a> <span class="fn">data</span> <span class="fn">e</span></span>)</span> <a href=".././Init/Prelude.html#Eq">=</a> (<span class="fn"><span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.hasMVar">Lean.Expr.hasMVar</a> <span class="fn">e</span></span>)</span> <a href=".././Init/Control/Basic.html#andM">&lt&amp&amp&gt</a> <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignableMVar">Lean.hasAssignableMVar</a> <span class="fn">e</span></span></span>)</span></li><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignableMVar">Lean.hasAssignableMVar</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.proj">Lean.Expr.proj</a> <span class="fn">typeName</span> <span class="fn">idx</span> <span class="fn">e</span></span>)</span> <a href=".././Init/Prelude.html#Eq">=</a> (<span class="fn"><span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.hasMVar">Lean.Expr.hasMVar</a> <span class="fn">e</span></span>)</span> <a href=".././Init/Control/Basic.html#andM">&lt&amp&amp&gt</a> <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignableMVar">Lean.hasAssignableMVar</a> <span class="fn">e</span></span></span>)</span></li><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.hasAssignableMVar">Lean.hasAssignableMVar</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.mvar">Lean.Expr.mvar</a> <span class="fn">mvarId</span></span>)</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MVarId.isAssignable">Lean.MVarId.isAssignable</a> <span class="fn">mvarId</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.assignLevelMVar"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L458-L459">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.assignLevelMVar">Lean.assignLevelMVar</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Level.html#Lean.LMVarId">Lean.LMVarId</a>)</span></span>
<span class="decl_args">
<span class="fn">(val : <a href=".././Lean/Level.html#Lean.Level">Lean.Level</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Add <code>mvarId := u</code> to the universe metavariable assignment.
This method does not check whether <code>mvarId</code> is already assigned, nor it checks whether
a cycle is being introduced.
This is a low-level API, and it is safer to use <code>isLevelDefEq (mkLevelMVar mvarId) u</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MVarId.assign"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L467-L468">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MVarId.assign">Lean.MVarId.assign</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args">
<span class="fn">(val : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Add <code>mvarId := x</code> to the metavariable assignment.
This method does not check whether <code>mvarId</code> is already assigned, nor it checks whether
a cycle is being introduced, or whether the expression has the right type.
This is a low-level API, and it is safer to use <code>isDefEq (mkMVar mvarId) x</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.assignExprMVar"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L471-L472">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.assignExprMVar">Lean.assignExprMVar</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args">
<span class="fn">(val : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.assignExprMVar">Lean.assignExprMVar</a> <span class="fn">mvarId</span> <span class="fn">val</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MVarId.assign">Lean.MVarId.assign</a> <span class="fn">mvarId</span> <span class="fn">val</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.assignDelayedMVar"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L474-L475">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.assignDelayedMVar">Lean.assignDelayedMVar</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args">
<span class="fn">(fvars : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(mvarIdPending : <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="mod_doc"><p>Notes on artificial eta-expanded terms due to metavariables.
We try avoid synthetic terms such as <code>((fun x y => t) a b)</code> in the output produced by the elaborator.
This kind of term may be generated when instantiating metavariable assignments.
This module tries to avoid their generation because they often introduce unnecessary dependencies and
may affect automation.</p><p>When elaborating terms, we use metavariables to represent "holes". Each hole has a context which includes
all free variables that may be used to "fill" the hole. Suppose, we create a metavariable (hole) <code>?m : <a href=".././Init/Prelude.html#Nat">Nat</a></code> in a context
containing <code>(x : Nat) (y : Nat) (b : Bool)</code>, then we can assign terms such as <code>x + y</code> to <code>?m</code> since <code>x</code> and <code>y</code>
are in the context used to create <code>?m</code>. Now, suppose we have the term <code>?m + 1</code> and we want to create the lambda expression
<code>fun x => ?m + 1</code>. This term is not correct since we may assign to <code>?m</code> a term containing <code>x</code>.
We address this issue by create a synthetic metavariable <code>?n : <a href=".././Init/Prelude.html#Nat">Nat</a> → <a href=".././Init/Prelude.html#Nat">Nat</a></code> and adding the delayed assignment
<code>?n #[x] := ?m</code>, and the term <code>fun x => ?n x + 1</code>. When we later assign a term <code>t[x]</code> to <code>?m</code>, <code>fun x => t[x]</code> is assigned to
<code>?n</code>, and if we substitute it at <code>fun x => ?n x + 1</code>, we produce <code>fun x => ((fun x => t[x]) x) + 1</code>.
To avoid this term eta-expanded term, we apply beta-reduction when instantiating metavariable assignments in this module.
This operation is performed at <code><a href=".././Lean/MetavarContext.html#Lean.instantiateExprMVars">instantiateExprMVars</a></code>, <code><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.elimMVarDeps">elimMVarDeps</a></code>, and <code><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.levelMVarToParam">levelMVarToParam</a></code>.</p></div><div class="decl" id="Lean.instantiateLevelMVars"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L496-L509">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.instantiateLevelMVars">Lean.instantiateLevelMVars</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Level.html#Lean.Level">Lean.Level</a> → <span class="fn"><span class="fn">m</span> <a href=".././Lean/Level.html#Lean.Level">Lean.Level</a></span></span></div></div></div></div><div class="decl" id="Lean.instantiateExprMVars"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L512-L580">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.instantiateExprMVars">Lean.instantiateExprMVars</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{ω : <span class="fn">Type</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/System/ST.html#STWorld">STWorld</a> <span class="fn">ω</span> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#MonadLiftT">MonadLiftT</a> (<span class="fn"><a href=".././Init/System/ST.html#ST">ST</a> <span class="fn">ω</span></span>) <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(e : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Util/MonadCache.html#Lean.MonadCacheT">Lean.MonadCacheT</a> <a href=".././Lean/Expr.html#Lean.ExprStructEq">Lean.ExprStructEq</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> <span class="fn">m</span> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></div></div><p>instantiateExprMVars main function</p></div></div><div class="decl" id="Lean.instMonadMCtxStateRefT'MetavarContextST"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L582-L584">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.instMonadMCtxStateRefT'MetavarContextST">Lean.instMonadMCtxStateRefT'MetavarContextST</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{ω : <span class="fn">Type</span>}</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> (<span class="fn"><a href=".././Init/Control/StateRef.html#StateRefT'">StateRefT'</a> <span class="fn">ω</span> <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a> (<span class="fn"><a href=".././Init/System/ST.html#ST">ST</a> <span class="fn">ω</span></span>)</span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">Lean.instMonadMCtxStateRefT'MetavarContextST</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">getMCtx</span> := <span class="fn">get</span>, <span class="fn">modifyMCtx</span> := <span class="fn">modify</span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.instantiateMVarsCore"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L586-L589">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.instantiateMVarsCore">Lean.instantiateMVarsCore</a></span><span class="decl_args">
<span class="fn">(mctx : <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(e : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> <a href=".././Init/Prelude.html#Prod">×</a> <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.instantiateMVarsCore">Lean.instantiateMVarsCore</a> <span class="fn">mctx</span> <span class="fn">e</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn">let instantiate := <span class="fn">fun {<span class="fn">ω</span>} <span class="fn">e</span> =&gt <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.instantiateExprMVars">Lean.instantiateExprMVars</a> <span class="fn">e</span></span></span>;
  <span class="fn"><a href=".././Init/System/ST.html#runST">runST</a> <span class="fn">fun <span class="fn">x</span> =&gt <span class="fn"><a href=".././Init/Control/StateRef.html#StateRefT'.run">StateRefT'.run</a> (<span class="fn"><a href=".././Lean/Util/MonadCache.html#Lean.MonadCacheT.run">Lean.MonadCacheT.run</a> (<span class="fn"><span class="fn">instantiate</span> <span class="fn">e</span></span>)</span>) <span class="fn">mctx</span></span></span></span></span></span></li></ul></details></div></div><div class="decl" id="Lean.instantiateMVars"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L591-L597">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.instantiateMVars">Lean.instantiateMVars</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(e : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.instantiateLCtxMVars"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L599-L608">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.instantiateLCtxMVars">Lean.instantiateLCtxMVars</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(lctx : <a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.instantiateMVarDeclMVars"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L610-L614">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.instantiateMVarDeclMVars">Lean.instantiateMVarDeclMVars</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.instantiateLocalDeclMVars"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L616-L621">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.instantiateLocalDeclMVars">Lean.instantiateLocalDeclMVars</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(localDecl : <a href=".././Lean/LocalContext.html#Lean.LocalDecl">Lean.LocalDecl</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Lean/LocalContext.html#Lean.LocalDecl">Lean.LocalDecl</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.DependsOn.State"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L625-L627">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.DependsOn.State">Lean.DependsOn.State</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.DependsOn.State.mk"><li id="Lean.DependsOn.State.visited" class="structure_field"><div class="structure_field_info">visited : <a href=".././Lean/Expr.html#Lean.ExprSet">Lean.ExprSet</a></div></li><li id="Lean.DependsOn.State.mctx" class="structure_field"><div class="structure_field_info">mctx : <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a></div></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.DependsOn.State" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.DependsOn.instMonadMCtxM"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L631-L633">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.DependsOn.instMonadMCtxM">Lean.DependsOn.instMonadMCtxM</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <a href=".././Lean/MetavarContext.html#_private.Lean.MetavarContext.0.Lean.DependsOn.M">Lean.DependsOn.M</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.DependsOn.instMonadMCtxM">Lean.DependsOn.instMonadMCtxM</a> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn">{ <span class="fn">getMCtx</span> := <span class="fn">do
      let __do_lift ← <span class="fn">get</span>
      <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> <span class="fn"><span class="fn">__do_lift</span>.mctx</span></span></span>,
    <span class="fn">modifyMCtx</span> := <span class="fn">fun <span class="fn">f</span> =&gt <span class="fn"><a href=".././Init/Prelude.html#modify">modify</a> <span class="fn">fun <span class="fn">s</span> =&gt <span class="fn">{ <span class="fn">visited</span> := <span class="fn"><span class="fn">s</span>.visited</span>, <span class="fn">mctx</span> := <span class="fn"><span class="fn">f</span> <span class="fn"><span class="fn">s</span>.mctx</span></span> }</span></span></span></span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.DependsOn.main"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L685-L686">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.DependsOn.main">Lean.DependsOn.main</a></span><span class="decl_args">
<span class="fn">(pf : <span class="fn"><a href=".././Lean/Expr.html#Lean.FVarId">Lean.FVarId</a> → <a href=".././Init/Prelude.html#Bool">Bool</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(pm : <span class="fn"><a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a> → <a href=".././Init/Prelude.html#Bool">Bool</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(e : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/MetavarContext.html#_private.Lean.MetavarContext.0.Lean.DependsOn.M">Lean.DependsOn.M</a> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.DependsOn.main">Lean.DependsOn.main</a> <span class="fn">pf</span> <span class="fn">pm</span> <span class="fn">e</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn">if <span class="fn">(<span class="fn"><span class="fn"><a href=".././Init/Prelude.html#not">!</a><span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.hasFVar">Lean.Expr.hasFVar</a> <span class="fn">e</span></span></span> <a href=".././Init/Prelude.html#and">&amp&amp</a> <span class="fn"><a href=".././Init/Prelude.html#not">!</a><span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.hasMVar">Lean.Expr.hasMVar</a> <span class="fn">e</span></span></span></span>) <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Prelude.html#Bool.true">true</a></span> then <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> <a href=".././Init/Prelude.html#Bool.false">false</a></span> else <span class="fn"><a href=".././Lean/MetavarContext.html#_private.Lean.MetavarContext.0.Lean.DependsOn.dep">Lean.DependsOn.dep</a> <span class="fn">pf</span> <span class="fn">pm</span> <span class="fn">e</span></span></span></span></li></ul></details></div></div><div class="decl" id="Lean.findExprDependsOn"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L696-L699">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.findExprDependsOn">Lean.findExprDependsOn</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(e : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(pf : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.FVarId">Lean.FVarId</a> → <a href=".././Init/Prelude.html#Bool">Bool</a></span>) <span class="fn">fun <span class="fn">x</span> =&gt <a href=".././Init/Prelude.html#Bool.false">false</a></span></span>)</span></span>
<span class="decl_args">
<span class="fn">(pm : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a> → <a href=".././Init/Prelude.html#Bool">Bool</a></span>) <span class="fn">fun <span class="fn">x</span> =&gt <a href=".././Init/Prelude.html#Bool.false">false</a></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><p>Return <code>true</code> iff <code>e</code> depends on a free variable <code>x</code> s.t. <code>pf x</code> is <code>true</code>, or an unassigned metavariable <code>?m</code> s.t. <code>pm ?m</code> is true.
For each metavariable <code>?m</code> (that does not satisfy <code>pm</code> occurring in <code>x</code>
1- If <code>?m := t</code>, then we visit <code>t</code> looking for <code>x</code>
2- If <code>?m</code> is unassigned, then we consider the worst case and check whether <code>x</code> is in the local context of <code>?m</code>.
This case is a "may dependency". That is, we may assign a term <code>t</code> to <code>?m</code> s.t. <code>t</code> contains <code>x</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.findLocalDeclDependsOn"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L704-L710">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.findLocalDeclDependsOn">Lean.findLocalDeclDependsOn</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(localDecl : <a href=".././Lean/LocalContext.html#Lean.LocalDecl">Lean.LocalDecl</a>)</span></span>
<span class="decl_args">
<span class="fn">(pf : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.FVarId">Lean.FVarId</a> → <a href=".././Init/Prelude.html#Bool">Bool</a></span>) <span class="fn">fun <span class="fn">x</span> =&gt <a href=".././Init/Prelude.html#Bool.false">false</a></span></span>)</span></span>
<span class="decl_args">
<span class="fn">(pm : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a> → <a href=".././Init/Prelude.html#Bool">Bool</a></span>) <span class="fn">fun <span class="fn">x</span> =&gt <a href=".././Init/Prelude.html#Bool.false">false</a></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><p>Similar to <code><a href=".././Lean/MetavarContext.html#Lean.findExprDependsOn">findExprDependsOn</a></code>, but checks the expressions in the given local declaration
depends on a free variable <code>x</code> s.t. <code>pf x</code> is <code>true</code> or an unassigned metavariable <code>?m</code> s.t. <code>pm ?m</code> is true.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.exprDependsOn"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L712-L713">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.exprDependsOn">Lean.exprDependsOn</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(e : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(fvarId : <a href=".././Lean/Expr.html#Lean.FVarId">Lean.FVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.exprDependsOn">Lean.exprDependsOn</a> <span class="fn">e</span> <span class="fn">fvarId</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.findExprDependsOn">Lean.findExprDependsOn</a> <span class="fn">e</span> <span class="fn">fun <span class="fn">x</span> =&gt <span class="fn"><span class="fn">fvarId</span> <a href=".././Init/Prelude.html#BEq.beq">==</a> <span class="fn">x</span></span></span></span></span></li></ul></details></div></div><div class="decl" id="Lean.dependsOn"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L716-L717">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.dependsOn">Lean.dependsOn</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(e : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(fvarId : <a href=".././Lean/Expr.html#Lean.FVarId">Lean.FVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><p>Return true iff <code>e</code> depends on the free variable <code>fvarId</code></p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.dependsOn">Lean.dependsOn</a> <span class="fn">e</span> <span class="fn">fvarId</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.exprDependsOn">Lean.exprDependsOn</a> <span class="fn">e</span> <span class="fn">fvarId</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.localDeclDependsOn"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L720-L721">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.localDeclDependsOn">Lean.localDeclDependsOn</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(localDecl : <a href=".././Lean/LocalContext.html#Lean.LocalDecl">Lean.LocalDecl</a>)</span></span>
<span class="decl_args">
<span class="fn">(fvarId : <a href=".././Lean/Expr.html#Lean.FVarId">Lean.FVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><p>Return true iff <code>e</code> depends on the free variable <code>fvarId</code></p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.localDeclDependsOn">Lean.localDeclDependsOn</a> <span class="fn">localDecl</span> <span class="fn">fvarId</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.findLocalDeclDependsOn">Lean.findLocalDeclDependsOn</a> <span class="fn">localDecl</span> <span class="fn">fun <span class="fn">x</span> =&gt <span class="fn"><span class="fn">fvarId</span> <a href=".././Init/Prelude.html#BEq.beq">==</a> <span class="fn">x</span></span></span></span></span></li></ul></details></div></div><div class="decl" id="Lean.exprDependsOn'"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L724-L730">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.exprDependsOn'">Lean.exprDependsOn'</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(e : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(x : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><p>Similar to <code><a href=".././Lean/MetavarContext.html#Lean.exprDependsOn">exprDependsOn</a></code>, but <code>x</code> can be a free variable or an unassigned metavariable.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.localDeclDependsOn'"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L733-L739">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.localDeclDependsOn'">Lean.localDeclDependsOn'</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(localDecl : <a href=".././Lean/LocalContext.html#Lean.LocalDecl">Lean.LocalDecl</a>)</span></span>
<span class="decl_args">
<span class="fn">(x : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><p>Similar to <code><a href=".././Lean/MetavarContext.html#Lean.localDeclDependsOn">localDeclDependsOn</a></code>, but <code>x</code> can be a free variable or an unassigned metavariable.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.dependsOnPred"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L742-L743">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.dependsOnPred">Lean.dependsOnPred</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(e : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(pf : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.FVarId">Lean.FVarId</a> → <a href=".././Init/Prelude.html#Bool">Bool</a></span>) <span class="fn">fun <span class="fn">x</span> =&gt <a href=".././Init/Prelude.html#Bool.false">false</a></span></span>)</span></span>
<span class="decl_args">
<span class="fn">(pm : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a> → <a href=".././Init/Prelude.html#Bool">Bool</a></span>) <span class="fn">fun <span class="fn">x</span> =&gt <a href=".././Init/Prelude.html#Bool.false">false</a></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><p>Return true iff <code>e</code> depends on a free variable <code>x</code> s.t. <code>pf x</code>, or an unassigned metavariable <code>?m</code> s.t. <code>pm ?m</code> is true.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.dependsOnPred">Lean.dependsOnPred</a> <span class="fn">e</span> <span class="fn">pf</span> <span class="fn">pm</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.findExprDependsOn">Lean.findExprDependsOn</a> <span class="fn">e</span> <span class="fn">pf</span> <span class="fn">pm</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.localDeclDependsOnPred"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L746-L747">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.localDeclDependsOnPred">Lean.localDeclDependsOnPred</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(localDecl : <a href=".././Lean/LocalContext.html#Lean.LocalDecl">Lean.LocalDecl</a>)</span></span>
<span class="decl_args">
<span class="fn">(pf : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.FVarId">Lean.FVarId</a> → <a href=".././Init/Prelude.html#Bool">Bool</a></span>) <span class="fn">fun <span class="fn">x</span> =&gt <a href=".././Init/Prelude.html#Bool.false">false</a></span></span>)</span></span>
<span class="decl_args">
<span class="fn">(pm : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a> → <a href=".././Init/Prelude.html#Bool">Bool</a></span>) <span class="fn">fun <span class="fn">x</span> =&gt <a href=".././Init/Prelude.html#Bool.false">false</a></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><p>Return true iff the local declaration <code>localDecl</code> depends on a free variable <code>x</code> s.t. <code>pf x</code>, an unassigned metavariable <code>?m</code> s.t. <code>pm ?m</code> is true.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.localDeclDependsOnPred">Lean.localDeclDependsOnPred</a> <span class="fn">localDecl</span> <span class="fn">pf</span> <span class="fn">pm</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.findLocalDeclDependsOn">Lean.findLocalDeclDependsOn</a> <span class="fn">localDecl</span> <span class="fn">pf</span> <span class="fn">pm</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.instInhabitedMetavarContext"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L752-L752">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.instInhabitedMetavarContext">Lean.MetavarContext.instInhabitedMetavarContext</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.mkMetavarContext"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L755-L755">source</a></div><div class="attributes">@[export lean_mk_metavar_ctx]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.mkMetavarContext">Lean.MetavarContext.mkMetavarContext</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Unit">Unit</a> → <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.addExprMVarDecl"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L760-L779">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.addExprMVarDecl">Lean.MetavarContext.addExprMVarDecl</a></span><span class="decl_args">
<span class="fn">(mctx : <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args">
<span class="fn">(userName : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a>)</span></span>
<span class="decl_args">
<span class="fn">(lctx : <a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(localInstances : <a href=".././Lean/MetavarContext.html#Lean.LocalInstances">Lean.LocalInstances</a>)</span></span>
<span class="decl_args">
<span class="fn">(type : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(kind : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> <a href=".././Lean/MetavarContext.html#Lean.MetavarKind">Lean.MetavarKind</a> <a href=".././Lean/MetavarContext.html#Lean.MetavarKind.natural">Lean.MetavarKind.natural</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(numScopeArgs : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> <a href=".././Init/Prelude.html#Nat">Nat</a> <span class="fn">0</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a></div></div><p>Low level API for adding/declaring metavariable declarations.
It is used to implement actions in the monads <code>MetaM</code>, <code>ElabM</code> and <code>TacticM</code>.
It should not be used directly since the argument <code>(mvarId : MVarId)</code> is assumed to be "unique".</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.addExprMVarDeclExp"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L781-L783">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.addExprMVarDeclExp">Lean.MetavarContext.addExprMVarDeclExp</a></span><span class="decl_args">
<span class="fn">(mctx : <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args">
<span class="fn">(userName : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a>)</span></span>
<span class="decl_args">
<span class="fn">(lctx : <a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(localInstances : <a href=".././Lean/MetavarContext.html#Lean.LocalInstances">Lean.LocalInstances</a>)</span></span>
<span class="decl_args">
<span class="fn">(type : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(kind : <a href=".././Lean/MetavarContext.html#Lean.MetavarKind">Lean.MetavarKind</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.addExprMVarDeclExp">Lean.MetavarContext.addExprMVarDeclExp</a> <span class="fn">mctx</span> <span class="fn">mvarId</span> <span class="fn">userName</span> <span class="fn">lctx</span> <span class="fn">localInstances</span> <span class="fn">type</span> <span class="fn">kind</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.addExprMVarDecl">Lean.MetavarContext.addExprMVarDecl</a> <span class="fn">mctx</span> <span class="fn">mvarId</span> <span class="fn">userName</span> <span class="fn">lctx</span> <span class="fn">localInstances</span> <span class="fn">type</span> <span class="fn">kind</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.addLevelMVarDecl"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L788-L789">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.addLevelMVarDecl">Lean.MetavarContext.addLevelMVarDecl</a></span><span class="decl_args">
<span class="fn">(mctx : <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Level.html#Lean.LMVarId">Lean.LMVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a></div></div><p>Low level API for adding/declaring universe level metavariable declarations.
It is used to implement actions in the monads <code>MetaM</code>, <code>ElabM</code> and <code>TacticM</code>.
It should not be used directly since the argument <code>(mvarId : MVarId)</code> is assumed to be "unique".</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.findDecl?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L791-L792">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.findDecl?">Lean.MetavarContext.findDecl?</a></span><span class="decl_args">
<span class="fn">(mctx : <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Lean/MetavarContext.html#Lean.MetavarDecl">Lean.MetavarDecl</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.findDecl?">Lean.MetavarContext.findDecl?</a> <span class="fn">mctx</span> <span class="fn">mvarId</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Data/PersistentHashMap.html#Lean.PersistentHashMap.find?">Lean.PersistentHashMap.find?</a> <span class="fn"><span class="fn">mctx</span>.decls</span> <span class="fn">mvarId</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.findUserName?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L794-L795">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.findUserName?">Lean.MetavarContext.findUserName?</a></span><span class="decl_args">
<span class="fn">(mctx : <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(userName : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.findUserName?">Lean.MetavarContext.findUserName?</a> <span class="fn">mctx</span> <span class="fn">userName</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Data/PersistentHashMap.html#Lean.PersistentHashMap.find?">Lean.PersistentHashMap.find?</a> <span class="fn"><span class="fn">mctx</span>.userNames</span> <span class="fn">userName</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.setMVarKind"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L797-L799">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.setMVarKind">Lean.MetavarContext.setMVarKind</a></span><span class="decl_args">
<span class="fn">(mctx : <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args">
<span class="fn">(kind : <a href=".././Lean/MetavarContext.html#Lean.MetavarKind">Lean.MetavarKind</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.setMVarUserName"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L804-L810">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.setMVarUserName">Lean.MetavarContext.setMVarUserName</a></span><span class="decl_args">
<span class="fn">(mctx : <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args">
<span class="fn">(userName : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a></div></div><p>Set the metavariable user facing name.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.setMVarUserNameTemporarily"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L818-L820">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.setMVarUserNameTemporarily">Lean.MetavarContext.setMVarUserNameTemporarily</a></span><span class="decl_args">
<span class="fn">(mctx : <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args">
<span class="fn">(userName : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a></div></div><p>Low-level version of <code><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.setMVarUserName">setMVarUserName</a></code>.
It does not update the table <code>userNames</code>. Thus, <code><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.findUserName?">findUserName?</a></code> cannot see the modification.
It is meant for <code>mkForallFVars'</code> where we temporarily set the user facing name of metavariables to get more
meaningful binder names.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.setMVarType"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L824-L826">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.setMVarType">Lean.MetavarContext.setMVarType</a></span><span class="decl_args">
<span class="fn">(mctx : <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args">
<span class="fn">(type : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a></div></div><p>Update the type of the given metavariable. This function assumes the new type is
definitionally equal to the current one</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.findLevelDepth?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L828-L829">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.findLevelDepth?">Lean.MetavarContext.findLevelDepth?</a></span><span class="decl_args">
<span class="fn">(mctx : <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Level.html#Lean.LMVarId">Lean.LMVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Init/Prelude.html#Nat">Nat</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.findLevelDepth?">Lean.MetavarContext.findLevelDepth?</a> <span class="fn">mctx</span> <span class="fn">mvarId</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Data/PersistentHashMap.html#Lean.PersistentHashMap.find?">Lean.PersistentHashMap.find?</a> <span class="fn"><span class="fn">mctx</span>.lDepth</span> <span class="fn">mvarId</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.getLevelDepth"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L831-L834">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.getLevelDepth">Lean.MetavarContext.getLevelDepth</a></span><span class="decl_args">
<span class="fn">(mctx : <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Level.html#Lean.LMVarId">Lean.LMVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Nat">Nat</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.isAnonymousMVar"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L836-L839">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.isAnonymousMVar">Lean.MetavarContext.isAnonymousMVar</a></span><span class="decl_args">
<span class="fn">(mctx : <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.isAnonymousMVar">Lean.MetavarContext.isAnonymousMVar</a> <span class="fn">mctx</span> <span class="fn">mvarId</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn">match <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.findDecl?">Lean.MetavarContext.findDecl?</a> <span class="fn">mctx</span> <span class="fn">mvarId</span></span> with
  | <span class="fn">none</span> =&gt <a href=".././Init/Prelude.html#Bool.false">false</a>
  | <span class="fn"><a href=".././Init/Prelude.html#Option.some">some</a> <span class="fn">mvarDecl</span></span> =&gt <span class="fn"><a href=".././Init/Prelude.html#Option.none">Lean.Name.isAnonymous</a> <span class="fn"><span class="fn">mvarDecl</span>.userName</span></span></span></span></li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.incDepth"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L841-L842">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.incDepth">Lean.MetavarContext.incDepth</a></span><span class="decl_args">
<span class="fn">(mctx : <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.instMonadMCtxStateRefT'MetavarContextST"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L844-L846">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.instMonadMCtxStateRefT'MetavarContextST">Lean.MetavarContext.instMonadMCtxStateRefT'MetavarContextST</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{ω : <span class="fn">Type</span>}</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> (<span class="fn"><a href=".././Init/Control/StateRef.html#StateRefT'">StateRefT'</a> <span class="fn">ω</span> <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a> (<span class="fn"><a href=".././Init/System/ST.html#ST">ST</a> <span class="fn">ω</span></span>)</span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">Lean.MetavarContext.instMonadMCtxStateRefT'MetavarContextST</span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">getMCtx</span> := <span class="fn">get</span>, <span class="fn">modifyMCtx</span> := <span class="fn">modify</span> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.MkBinding.Exception"><div class="inductive"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L850-L851">source</a></div><div class="decl_header"><span class="decl_kind">inductive</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.Exception">Lean.MetavarContext.MkBinding.Exception</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="constructors"><li class="constructor" id="Lean.MetavarContext.MkBinding.Exception.revertFailure">revertFailure: <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a> → <span class="fn"><a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a> → <span class="fn"><span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span> → <span class="fn"><a href=".././Init/Prelude.html#String">String</a> → <a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.Exception">Lean.MetavarContext.MkBinding.Exception</a></span></span></span></span></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.MetavarContext.MkBinding.Exception" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.MetavarContext.MkBinding.instToStringException"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L853-L859">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.instToStringException">Lean.MetavarContext.MkBinding.instToStringException</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Data/ToString/Basic.html#ToString">ToString</a> <a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.Exception">Lean.MetavarContext.MkBinding.Exception</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.MkBinding.State"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L866-L870">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.State">Lean.MetavarContext.MkBinding.State</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.MetavarContext.MkBinding.State.mk"><li id="Lean.MetavarContext.MkBinding.State.mctx" class="structure_field"><div class="structure_field_info">mctx : <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a></div></li><li id="Lean.MetavarContext.MkBinding.State.nextMacroScope" class="structure_field"><div class="structure_field_info">nextMacroScope : <a href=".././Init/Prelude.html#Lean.MacroScope">Lean.MacroScope</a></div></li><li id="Lean.MetavarContext.MkBinding.State.ngen" class="structure_field"><div class="structure_field_info">ngen : <a href=".././Init/Meta.html#Lean.NameGenerator">Lean.NameGenerator</a></div></li><li id="Lean.MetavarContext.MkBinding.State.cache" class="structure_field"><div class="structure_field_info">cache : <span class="fn"><a href=".././Lean/Data/HashMap.html#Lean.HashMap">Lean.HashMap</a> <a href=".././Lean/Expr.html#Lean.ExprStructEq">Lean.ExprStructEq</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></div></li></ul><p><code>MkBinding</code> and <code>elimMVarDepsAux</code> are mutually recursive, but <code>cache</code> is only used at <code>elimMVarDepsAux</code>.
We use a single state object for convenience.</p><p>We have a <code>NameGenerator</code> because we need to generate fresh auxiliary metavariables.</p><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.MetavarContext.MkBinding.State" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.MetavarContext.MkBinding.Context"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L872-L878">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.Context">Lean.MetavarContext.MkBinding.Context</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.MetavarContext.MkBinding.Context.mk"><li id="Lean.MetavarContext.MkBinding.Context.mainModule" class="structure_field"><div class="structure_field_info">mainModule : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a></div></li><li id="Lean.MetavarContext.MkBinding.Context.preserveOrder" class="structure_field"><div class="structure_field_info">preserveOrder : <a href=".././Init/Prelude.html#Bool">Bool</a></div></li><li id="Lean.MetavarContext.MkBinding.Context.binderInfoForMVars" class="structure_field"><div class="structure_field_doc"><p>When creating binders for abstracted metavariables, we use the following <code>BinderInfo</code>.</p></div><div class="structure_field_info">binderInfoForMVars : <a href=".././Lean/Expr.html#Lean.BinderInfo">Lean.BinderInfo</a></div></li><li id="Lean.MetavarContext.MkBinding.Context.mvarIdsToAbstract" class="structure_field"><div class="structure_field_doc"><p>Set of unassigned metavariables being abstracted.</p></div><div class="structure_field_info">mvarIdsToAbstract : <a href=".././Lean/Expr.html#Lean.MVarIdSet">Lean.MVarIdSet</a></div></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.MetavarContext.MkBinding.Context" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.MetavarContext.MkBinding.MCore"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L880-L880">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.MCore">Lean.MetavarContext.MkBinding.MCore</a></span><span class="decl_args">
<span class="fn">(α : <span class="fn">Type</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.MCore">Lean.MetavarContext.MkBinding.MCore</a> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Init/Prelude.html#EStateM">EStateM</a> <a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.Exception">Lean.MetavarContext.MkBinding.Exception</a> <a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.State">Lean.MetavarContext.MkBinding.State</a></span></span></li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.MkBinding.M"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L881-L881">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.M">Lean.MetavarContext.MkBinding.M</a></span><span class="decl_args">
<span class="fn">(α : <span class="fn">Type</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.M">Lean.MetavarContext.MkBinding.M</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Prelude.html#ReaderT">ReaderT</a> <a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.Context">Lean.MetavarContext.MkBinding.Context</a> <a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.MCore">Lean.MetavarContext.MkBinding.MCore</a></span></span></li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.MkBinding.instMonadMCtxM"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L883-L885">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.instMonadMCtxM">Lean.MetavarContext.MkBinding.instMonadMCtxM</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.M">Lean.MetavarContext.MkBinding.M</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.MkBinding.preserveOrder"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L891-L892">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.preserveOrder">Lean.MetavarContext.MkBinding.preserveOrder</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.M">Lean.MetavarContext.MkBinding.M</a> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.preserveOrder">Lean.MetavarContext.MkBinding.preserveOrder</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let __do_lift ← <span class="fn">read</span>
  <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> <span class="fn"><span class="fn">__do_lift</span>.preserveOrder</span></span></span></span></li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.MkBinding.instMonadHashMapCacheAdapterExprStructEqExprMInstBEqExprStructEqInstHashableExprStructEq"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L894-L896">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.instMonadHashMapCacheAdapterExprStructEqExprMInstBEqExprStructEqInstHashableExprStructEq">Lean.MetavarContext.MkBinding.instMonadHashMapCacheAdapterExprStructEqExprMInstBEqExprStructEqInstHashableExprStructEq</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Util/MonadCache.html#Lean.MonadHashMapCacheAdapter">Lean.MonadHashMapCacheAdapter</a> <a href=".././Lean/Expr.html#Lean.ExprStructEq">Lean.ExprStructEq</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> <a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.M">Lean.MetavarContext.MkBinding.M</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.MkBinding.collectForwardDeps"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L941-L965">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.collectForwardDeps">Lean.MetavarContext.MkBinding.collectForwardDeps</a></span><span class="decl_args">
<span class="fn">(lctx : <a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(toRevert : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.M">Lean.MetavarContext.MkBinding.M</a> (<span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span>)</span></div></div><p>Given <code>toRevert</code> an array of free variables s.t. <code>lctx</code> contains their declarations,
return a new array of free variables that contains <code>toRevert</code> and all free variables
in <code>lctx</code> that may depend on <code>toRevert</code>.</p><p>Remark: the result is sorted by <code>LocalDecl</code> indices.</p><p>Remark: We used to throw an <code>Exception.revertFailure</code> exception when an auxiliary declaration
had to be reversed. Recall that auxiliary declarations are created when compiling (mutually)
recursive definitions. The <code>revertFailure</code> due to auxiliary declaration dependency was originally
introduced in Lean3 to address issue https://github.com/leanprover/lean/issues/1258.
In Lean4, this solution is not satisfactory because all definitions/theorems are potentially
recursive. So, even an simple (incomplete) definition such as</p><pre><code>variables {α : Type} in
def f (a : α) : <a href=".././Init/Prelude.html#List">List</a> α :=
_
</code></pre><p>would trigger the <code>Exception.revertFailure</code> exception. In the definition above,
the elaborator creates the auxiliary definition <code>f : {α : Type} → <a href=".././Init/Prelude.html#List">List</a> α</code>.
The <code>_</code> is elaborated as a new fresh variable <code>?m</code> that contains <code>α : Type</code>, <code>a : α</code>, and <code>f : α → <a href=".././Init/Prelude.html#List">List</a> α</code> in its context,
When we try to create the lambda <code>fun {α : Type} (a : α) => ?m</code>, we first need to create
an auxiliary <code>?n</code> which do not contain <code>α</code> and <code>a</code> in its context. That is,
we create the metavariable <code>?n : {α : Type} → (a : α) → (f : α → <a href=".././Init/Prelude.html#List">List</a> α) → <a href=".././Init/Prelude.html#List">List</a> α</code>,
add the delayed assignment <code>?n #[α, a, f] := ?m α a f</code>, and create the lambda
<code>fun {α : Type} (a : α) => ?n α a f</code>.
See <code><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.elimMVarDeps">elimMVarDeps</a></code> for more information.
If we kept using the Lean3 approach, we would get the <code>Exception.revertFailure</code> exception because we are
reverting the auxiliary definition <code>f</code>.</p><p>Note that https://github.com/leanprover/lean/issues/1258 is not an issue in Lean4 because
we have changed how we compile recursive definitions.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.MkBinding.reduceLocalContext"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L969-L971">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.reduceLocalContext">Lean.MetavarContext.MkBinding.reduceLocalContext</a></span><span class="decl_args">
<span class="fn">(lctx : <a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(toRevert : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a></div></div><p>Create a new <code>LocalContext</code> by removing the free variables in <code>toRevert</code> from <code>lctx</code>.
We use this function when we create auxiliary metavariables at <code>elimMVarDepsAux</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.MkBinding.elimMVarDeps"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L1123-L1128">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.elimMVarDeps">Lean.MetavarContext.MkBinding.elimMVarDeps</a></span><span class="decl_args">
<span class="fn">(xs : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(e : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.M">Lean.MetavarContext.MkBinding.M</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.elimMVarDeps">Lean.MetavarContext.MkBinding.elimMVarDeps</a> <span class="fn">xs</span> <span class="fn">e</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn">if <span class="fn">(<span class="fn"><a href=".././Init/Prelude.html#not">!</a><span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.hasMVar">Lean.Expr.hasMVar</a> <span class="fn">e</span></span></span>) <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Prelude.html#Bool.true">true</a></span> then <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> <span class="fn">e</span></span>
  else <span class="fn"><a href=".././Lean/MetavarContext.html#_private.Lean.MetavarContext.0.Lean.MetavarContext.MkBinding.withFreshCache">Lean.MetavarContext.MkBinding.withFreshCache</a> (<span class="fn"><a href=".././Lean/MetavarContext.html#_private.Lean.MetavarContext.0.Lean.MetavarContext.MkBinding.elim">Lean.MetavarContext.MkBinding.elim</a> <span class="fn">xs</span> <span class="fn">e</span></span>)</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.MkBinding.revert"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L1130-L1132">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.revert">Lean.MetavarContext.MkBinding.revert</a></span><span class="decl_args">
<span class="fn">(xs : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.M">Lean.MetavarContext.MkBinding.M</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> <a href=".././Init/Prelude.html#Prod">×</a> <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.revert">Lean.MetavarContext.MkBinding.revert</a> <span class="fn">xs</span> <span class="fn">mvarId</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Lean/MetavarContext.html#_private.Lean.MetavarContext.0.Lean.MetavarContext.MkBinding.withFreshCache">Lean.MetavarContext.MkBinding.withFreshCache</a> (<span class="fn"><a href=".././Lean/MetavarContext.html#_private.Lean.MetavarContext.0.Lean.MetavarContext.MkBinding.elimMVar">Lean.MetavarContext.MkBinding.elimMVar</a> <span class="fn">xs</span> <span class="fn">mvarId</span> <span class="fn">#[]</span></span>)</span></span></li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.MkBinding.abstractRange"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L1140-L1142">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.abstractRange">Lean.MetavarContext.MkBinding.abstractRange</a></span><span class="decl_args">
<span class="fn">(xs : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(i : <a href=".././Init/Prelude.html#Nat">Nat</a>)</span></span>
<span class="decl_args">
<span class="fn">(e : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.M">Lean.MetavarContext.MkBinding.M</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></div></div><p>Similar to <code>Expr.<a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.abstractRange">abstractRange</a></code>, but handles metavariables correctly.
It uses <code><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.elimMVarDeps">elimMVarDeps</a></code> to ensure <code>e</code> and the type of the free variables <code>xs</code> do not
contain a metavariable <code>?m</code> s.t. local context of <code>?m</code> contains a free variable in <code>xs</code>.</p><p><code><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.elimMVarDeps">elimMVarDeps</a></code> is defined later in this file.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.abstractRange">Lean.MetavarContext.MkBinding.abstractRange</a> <span class="fn">xs</span> <span class="fn">i</span> <span class="fn">e</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let e ← <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.elimMVarDeps">Lean.MetavarContext.MkBinding.elimMVarDeps</a> <span class="fn">xs</span> <span class="fn">e</span></span>
  <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr.abstractRange">Lean.Expr.abstractRange</a> <span class="fn">e</span> <span class="fn">i</span> <span class="fn">xs</span></span>)</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.MkBinding.mkBinding"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L1148-L1179">source</a></div><div class="attributes">@[specialize #[]]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.mkBinding">Lean.MetavarContext.MkBinding.mkBinding</a></span><span class="decl_args">
<span class="fn">(isLambda : <a href=".././Init/Prelude.html#Bool">Bool</a>)</span></span>
<span class="decl_args">
<span class="fn">(lctx : <a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(xs : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(e : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(usedOnly : <a href=".././Init/Prelude.html#Bool">Bool</a>)</span></span>
<span class="decl_args">
<span class="fn">(usedLetOnly : <a href=".././Init/Prelude.html#Bool">Bool</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.M">Lean.MetavarContext.MkBinding.M</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> <a href=".././Init/Prelude.html#Prod">×</a> <a href=".././Init/Prelude.html#Nat">Nat</a></span>)</span></div></div><p>Similar to <code>LocalContext.<a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.mkBinding">mkBinding</a></code>, but handles metavariables correctly.
If <code>usedOnly == false</code> then <code>forall</code> and <code>lambda</code> expressions are created only for used variables.
If <code>usedLetOnly == false</code> then <code>let</code> expressions are created only for used (let-) variables.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.MkBindingM.Context"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L1183-L1185">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBindingM.Context">Lean.MetavarContext.MkBindingM.Context</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.MetavarContext.MkBindingM.Context.mk"><li id="Lean.MetavarContext.MkBindingM.Context.mainModule" class="structure_field"><div class="structure_field_info">mainModule : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a></div></li><li id="Lean.MetavarContext.MkBindingM.Context.lctx" class="structure_field"><div class="structure_field_info">lctx : <a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a></div></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.MetavarContext.MkBindingM.Context" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.MetavarContext.MkBindingM"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L1187-L1187">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBindingM">Lean.MetavarContext.MkBindingM</a></span><span class="decl_args">
<span class="fn">(α : <span class="fn">Type</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBindingM">Lean.MetavarContext.MkBindingM</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Prelude.html#ReaderT">ReaderT</a> <a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBindingM.Context">Lean.MetavarContext.MkBindingM.Context</a> <a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBinding.MCore">Lean.MetavarContext.MkBinding.MCore</a></span></span></li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.elimMVarDeps"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L1189-L1190">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.elimMVarDeps">Lean.MetavarContext.elimMVarDeps</a></span><span class="decl_args">
<span class="fn">(xs : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(e : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(preserveOrder : <a href=".././Init/Prelude.html#Bool">Bool</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBindingM">Lean.MetavarContext.MkBindingM</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.revert"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L1192-L1193">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.revert">Lean.MetavarContext.revert</a></span><span class="decl_args">
<span class="fn">(xs : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(mvarId : <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args">
<span class="fn">(preserveOrder : <a href=".././Init/Prelude.html#Bool">Bool</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBindingM">Lean.MetavarContext.MkBindingM</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> <a href=".././Init/Prelude.html#Prod">×</a> <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.mkBinding"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L1195-L1197">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.mkBinding">Lean.MetavarContext.mkBinding</a></span><span class="decl_args">
<span class="fn">(isLambda : <a href=".././Init/Prelude.html#Bool">Bool</a>)</span></span>
<span class="decl_args">
<span class="fn">(xs : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(e : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(usedOnly : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> <a href=".././Init/Prelude.html#Bool">Bool</a> <a href=".././Init/Prelude.html#Bool.false">false</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(usedLetOnly : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> <a href=".././Init/Prelude.html#Bool">Bool</a> <a href=".././Init/Prelude.html#Bool.true">true</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(binderInfoForMVars : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> <a href=".././Lean/Expr.html#Lean.BinderInfo">Lean.BinderInfo</a> <a href=".././Lean/Expr.html#Lean.BinderInfo.implicit">Lean.BinderInfo.implicit</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBindingM">Lean.MetavarContext.MkBindingM</a> (<span class="fn"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> <a href=".././Init/Prelude.html#Prod">×</a> <a href=".././Init/Prelude.html#Nat">Nat</a></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.mkLambda"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L1199-L1200">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.mkLambda">Lean.MetavarContext.mkLambda</a></span><span class="decl_args">
<span class="fn">(xs : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(e : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(usedOnly : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> <a href=".././Init/Prelude.html#Bool">Bool</a> <a href=".././Init/Prelude.html#Bool.false">false</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(usedLetOnly : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> <a href=".././Init/Prelude.html#Bool">Bool</a> <a href=".././Init/Prelude.html#Bool.true">true</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(binderInfoForMVars : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> <a href=".././Lean/Expr.html#Lean.BinderInfo">Lean.BinderInfo</a> <a href=".././Lean/Expr.html#Lean.BinderInfo.implicit">Lean.BinderInfo.implicit</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBindingM">Lean.MetavarContext.MkBindingM</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.mkLambda">Lean.MetavarContext.mkLambda</a> <span class="fn">xs</span> <span class="fn">e</span> <span class="fn">usedOnly</span> <span class="fn">usedLetOnly</span> <span class="fn">binderInfoForMVars</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let __do_lift ← <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.mkBinding">Lean.MetavarContext.mkBinding</a> <a href=".././Init/Prelude.html#Bool.true">true</a> <span class="fn">xs</span> <span class="fn">e</span> <span class="fn">usedOnly</span> <span class="fn">usedLetOnly</span> <span class="fn">binderInfoForMVars</span></span>
  <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> <span class="fn"><span class="fn">__do_lift</span>.fst</span></span></span></span></li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.mkForall"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L1202-L1203">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.mkForall">Lean.MetavarContext.mkForall</a></span><span class="decl_args">
<span class="fn">(xs : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(e : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(usedOnly : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> <a href=".././Init/Prelude.html#Bool">Bool</a> <a href=".././Init/Prelude.html#Bool.false">false</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(usedLetOnly : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> <a href=".././Init/Prelude.html#Bool">Bool</a> <a href=".././Init/Prelude.html#Bool.true">true</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(binderInfoForMVars : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> <a href=".././Lean/Expr.html#Lean.BinderInfo">Lean.BinderInfo</a> <a href=".././Lean/Expr.html#Lean.BinderInfo.implicit">Lean.BinderInfo.implicit</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBindingM">Lean.MetavarContext.MkBindingM</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.mkForall">Lean.MetavarContext.mkForall</a> <span class="fn">xs</span> <span class="fn">e</span> <span class="fn">usedOnly</span> <span class="fn">usedLetOnly</span> <span class="fn">binderInfoForMVars</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let __do_lift ← <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.mkBinding">Lean.MetavarContext.mkBinding</a> <a href=".././Init/Prelude.html#Bool.false">false</a> <span class="fn">xs</span> <span class="fn">e</span> <span class="fn">usedOnly</span> <span class="fn">usedLetOnly</span> <span class="fn">binderInfoForMVars</span></span>
  <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> <span class="fn"><span class="fn">__do_lift</span>.fst</span></span></span></span></li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.abstractRange"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L1205-L1206">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.abstractRange">Lean.MetavarContext.abstractRange</a></span><span class="decl_args">
<span class="fn">(e : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(n : <a href=".././Init/Prelude.html#Nat">Nat</a>)</span></span>
<span class="decl_args">
<span class="fn">(xs : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBindingM">Lean.MetavarContext.MkBindingM</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.collectForwardDeps"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L1208-L1209">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.collectForwardDeps">Lean.MetavarContext.collectForwardDeps</a></span><span class="decl_args">
<span class="fn">(toRevert : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(preserveOrder : <a href=".././Init/Prelude.html#Bool">Bool</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.MkBindingM">Lean.MetavarContext.MkBindingM</a> (<span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.isWellFormed"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L1215-L1233">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.isWellFormed">Lean.MetavarContext.isWellFormed</a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><span class="fn">Type</span> → <span class="fn">Type</span></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(lctx : <a href=".././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> → <span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Bool">Bool</a></span></span></div></div><p><code><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.isWellFormed">isWellFormed</a> mctx lctx e</code> return true if</p><ul>
<li>All locals in <code>e</code> are declared in <code>lctx</code></li>
<li>All metavariables <code>?m</code> in <code>e</code> have a local context which is a subprefix of <code>lctx</code> or are assigned, and the assignment is well-formed.</li>
</ul></div></div><div class="decl" id="Lean.MetavarContext.LevelMVarToParam.Context"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L1237-L1240">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.LevelMVarToParam.Context">Lean.MetavarContext.LevelMVarToParam.Context</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.MetavarContext.LevelMVarToParam.Context.mk"><li id="Lean.MetavarContext.LevelMVarToParam.Context.paramNamePrefix" class="structure_field"><div class="structure_field_info">paramNamePrefix : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a></div></li><li id="Lean.MetavarContext.LevelMVarToParam.Context.alreadyUsedPred" class="structure_field"><div class="structure_field_info">alreadyUsedPred : <span class="fn"><a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a> → <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></li><li id="Lean.MetavarContext.LevelMVarToParam.Context.except" class="structure_field"><div class="structure_field_info">except : <span class="fn"><a href=".././Lean/Level.html#Lean.LMVarId">Lean.LMVarId</a> → <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.MetavarContext.LevelMVarToParam.Context" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.MetavarContext.LevelMVarToParam.State"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L1242-L1246">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.LevelMVarToParam.State">Lean.MetavarContext.LevelMVarToParam.State</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.MetavarContext.LevelMVarToParam.State.mk"><li id="Lean.MetavarContext.LevelMVarToParam.State.mctx" class="structure_field"><div class="structure_field_info">mctx : <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a></div></li><li id="Lean.MetavarContext.LevelMVarToParam.State.paramNames" class="structure_field"><div class="structure_field_info">paramNames : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a></span></div></li><li id="Lean.MetavarContext.LevelMVarToParam.State.nextParamIdx" class="structure_field"><div class="structure_field_info">nextParamIdx : <a href=".././Init/Prelude.html#Nat">Nat</a></div></li><li id="Lean.MetavarContext.LevelMVarToParam.State.cache" class="structure_field"><div class="structure_field_info">cache : <span class="fn"><a href=".././Lean/Data/HashMap.html#Lean.HashMap">Lean.HashMap</a> <a href=".././Lean/Expr.html#Lean.ExprStructEq">Lean.ExprStructEq</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></div></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.MetavarContext.LevelMVarToParam.State" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.MetavarContext.LevelMVarToParam.M"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L1248-L1248">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.LevelMVarToParam.M">Lean.MetavarContext.LevelMVarToParam.M</a></span><span class="decl_args">
<span class="fn">(α : <span class="fn">Type</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.LevelMVarToParam.M">Lean.MetavarContext.LevelMVarToParam.M</a> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Init/Prelude.html#ReaderT">ReaderT</a> <a href=".././Lean/MetavarContext.html#Lean.MetavarContext.LevelMVarToParam.Context">Lean.MetavarContext.LevelMVarToParam.Context</a> (<span class="fn"><a href=".././Init/Control/State.html#StateM">StateM</a> <a href=".././Lean/MetavarContext.html#Lean.MetavarContext.LevelMVarToParam.State">Lean.MetavarContext.LevelMVarToParam.State</a></span>)</span></span></li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.LevelMVarToParam.instMonadMCtxM"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L1250-L1252">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.LevelMVarToParam.instMonadMCtxM">Lean.MetavarContext.LevelMVarToParam.instMonadMCtxM</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MonadMCtx">Lean.MonadMCtx</a> <a href=".././Lean/MetavarContext.html#Lean.MetavarContext.LevelMVarToParam.M">Lean.MetavarContext.LevelMVarToParam.M</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.LevelMVarToParam.instMonadCacheExprStructEqExprM"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L1254-L1256">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.LevelMVarToParam.instMonadCacheExprStructEqExprM">Lean.MetavarContext.LevelMVarToParam.instMonadCacheExprStructEqExprM</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Util/MonadCache.html#Lean.MonadCache">Lean.MonadCache</a> <a href=".././Lean/Expr.html#Lean.ExprStructEq">Lean.ExprStructEq</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a> <a href=".././Lean/MetavarContext.html#Lean.MetavarContext.LevelMVarToParam.M">Lean.MetavarContext.LevelMVarToParam.M</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.LevelMVarToParam.mkParamName"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L1258-L1267">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.LevelMVarToParam.mkParamName">Lean.MetavarContext.LevelMVarToParam.mkParamName</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.LevelMVarToParam.M">Lean.MetavarContext.LevelMVarToParam.M</a> <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a></span></div></div></div></div><div class="decl" id="Lean.MetavarContext.LevelMVarToParam.visitLevel"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L1269-L1286">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.LevelMVarToParam.visitLevel">Lean.MetavarContext.LevelMVarToParam.visitLevel</a></span><span class="decl_args">
<span class="fn">(u : <a href=".././Lean/Level.html#Lean.Level">Lean.Level</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.LevelMVarToParam.M">Lean.MetavarContext.LevelMVarToParam.M</a> <a href=".././Lean/Level.html#Lean.Level">Lean.Level</a></span></div></div></div></div><div class="decl" id="Lean.MetavarContext.LevelMVarToParam.main"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L1288-L1311">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.LevelMVarToParam.main">Lean.MetavarContext.LevelMVarToParam.main</a></span><span class="decl_args">
<span class="fn">(e : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.LevelMVarToParam.M">Lean.MetavarContext.LevelMVarToParam.M</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></div></div></div></div><div class="decl" id="Lean.MetavarContext.LevelMVarToParam.main.visitApp"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L1305-L1311">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.LevelMVarToParam.main.visitApp">Lean.MetavarContext.LevelMVarToParam.main.visitApp</a></span><span class="decl_args">
<span class="fn">(f : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(args : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.LevelMVarToParam.M">Lean.MetavarContext.LevelMVarToParam.M</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></span></div></div></div></div><div class="decl" id="Lean.MetavarContext.UnivMVarParamResult"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L1315-L1319">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.UnivMVarParamResult">Lean.MetavarContext.UnivMVarParamResult</a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">Type</span></div></div><ul class="structure_fields" id="Lean.MetavarContext.UnivMVarParamResult.mk"><li id="Lean.MetavarContext.UnivMVarParamResult.mctx" class="structure_field"><div class="structure_field_info">mctx : <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a></div></li><li id="Lean.MetavarContext.UnivMVarParamResult.newParamNames" class="structure_field"><div class="structure_field_info">newParamNames : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a></span></div></li><li id="Lean.MetavarContext.UnivMVarParamResult.nextParamIdx" class="structure_field"><div class="structure_field_info">nextParamIdx : <a href=".././Init/Prelude.html#Nat">Nat</a></div></li><li id="Lean.MetavarContext.UnivMVarParamResult.expr" class="structure_field"><div class="structure_field_info">expr : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a></div></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.MetavarContext.UnivMVarParamResult" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.MetavarContext.levelMVarToParam"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L1321-L1327">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.levelMVarToParam">Lean.MetavarContext.levelMVarToParam</a></span><span class="decl_args">
<span class="fn">(mctx : <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(alreadyUsedPred : <span class="fn"><a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a> → <a href=".././Init/Prelude.html#Bool">Bool</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(except : <span class="fn"><a href=".././Lean/Level.html#Lean.LMVarId">Lean.LMVarId</a> → <a href=".././Init/Prelude.html#Bool">Bool</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(e : <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(paramNamePrefix : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a> <span class="fn">`u</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(nextParamIdx : <span class="fn"><a href=".././Init/Prelude.html#optParam">optParam</a> <a href=".././Init/Prelude.html#Nat">Nat</a> <span class="fn">1</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.UnivMVarParamResult">Lean.MetavarContext.UnivMVarParamResult</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.MetavarContext.getExprAssignmentDomain"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/9b406132070ba483ba6b7c698b8d76b59a67a16a/src/Lean/MetavarContext.lean#L1329-L1330">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/MetavarContext.html#Lean.MetavarContext.getExprAssignmentDomain">Lean.MetavarContext.getExprAssignmentDomain</a></span><span class="decl_args">
<span class="fn">(mctx : <a href=".././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href=".././Lean/MetavarContext.html#Lean.MetavarContext.getExprAssignmentDomain">Lean.MetavarContext.getExprAssignmentDomain</a> <span class="fn">mctx</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Lean/Data/PersistentHashMap.html#Lean.PersistentHashMap.foldl">Lean.PersistentHashMap.foldl</a> <span class="fn"><span class="fn">mctx</span>.eAssignment</span> (<span class="fn">fun <span class="fn">a</span> <span class="fn">mvarId</span> <span class="fn">x</span> =&gt <span class="fn"><a href=".././Init/Prelude.html#Array.push">Array.push</a> <span class="fn">a</span> <span class="fn">mvarId</span></span></span>) <span class="fn">#[]</span></span></span></li></ul></details></div></div></main>
<nav class="nav"><iframe src=".././/navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>